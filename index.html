<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Journal Intime</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Kalam:wght@300;400;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
     body {
    background-color: #fff5f7;
    color: #333;
    line-height: 1.4;
    padding: 10px;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    
    /* PHOTO DE FOND - AJOUTEZ CES LIGNES */
    background-image: url('https://lh3.googleusercontent.com/d/1wOQdg0g9v4PWfiWV-5sFR3aIQW9Szzcq=s1000');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    background-repeat: no-repeat;
    position: relative;
}

/* Ajoutez cette couche semi-transparente après le body */
body::before {
    content: '';
    position: fixed; /* Changé à 'fixed' pour couvrir tout l'écran */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 245, 247, 0.85); /* Rose très léger */
    z-index: -1;
}
        
        .container {
    max-width: 1400px;
    margin: 0 auto;
    background-color: rgba(255, 255, 255, 0.92); /* Presque blanc, légèrement transparent */
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
    overflow: hidden;
    backdrop-filter: blur(2px); /* Léger flou pour faire ressortir la photo */
}
        
        header {
    background: linear-gradient(135deg, #e91e63 0%, #f8bbd9 100%);
    color: white;
    padding: 20px 25px;
}

.header-content {
    display: flex;
    align-items: center;
    gap: 35px;
}

.header-photo {
    width: 140px;
    height: 160px;
    background: white;
    padding: 10px 10px 30px 10px;
    border-radius: 3px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    transform: rotate(-2deg);
    transition: transform 0.3s ease;
}

.header-photo:hover {
    transform: rotate(0deg) scale(1.05);
}

.profile-photo-header {
    width: 100%;
    height: 120px;
    object-fit: cover;
    border: 1px solid #eee;
}

/* Légende style polaroid */
.header-photo::after {
    content: 'Mon Journal';
    position: absolute;
    bottom: 10px;
    left: 0;
    right: 0;
    text-align: center;
    color: #666;
    font-size: 0.8rem;
    font-family: 'Dancing Script', cursive;
}

h1 {
    font-size: 2.2rem;
    margin-bottom: 10px;
    font-weight: 600;
    letter-spacing: 1px;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
}

.subtitle {
    font-size: 1rem;
    opacity: 0.95;
    font-weight: 300;
    max-width: 600px;
}
        
        h1 {
            font-size: 2.3rem;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            min-height: 550px;
        }
        
        .calendar-section {
            flex: 1;
            min-width: 280px;
            padding: 25px;
            background-color: #fff9fb;
            border-right: 1px solid #f0f0f0;
        }
        
       .journal-section {
    flex: 2;
    min-width: 480px;
    padding: 25px;
    max-height: 750px;
    overflow-y: auto;
    position: relative;
    
    /* SUPPRIMEZ le fond ligné et ajoutez la photo */
    background-image: 
        linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)),
        url('https://drive.google.com/thumbnail?id=1s6f1gTMjejn51gy5mqpQ0QbgCKOG2yJx&sz=w2000');
    background-size: cover;
    background-position: center;
    background-attachment: local;
    background-repeat: no-repeat;
    border-radius: 8px;
}

/* Gardez l'effet de lignes POUR LE TEXTE seulement */
.journal-section::before {
    content: '';
    position: absolute;
    top: 25px;
    left: 25px;
    right: 25px;
    bottom: 25px;
    background-image: repeating-linear-gradient(
        transparent,
        transparent 27px,
        rgba(233, 30, 99, 0.05) 27px,
        rgba(233, 30, 99, 0.05) 28px
    );
    background-position: 0 0;
    pointer-events: none;
    z-index: 1;
}

/* Conteneur pour le contenu */
.entry-content {
    position: relative;
    z-index: 2;
}
        
        h2 {
            color: #e91e63;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #fce4ec;
            font-size: 1.6rem;
        }
        
      .calendar-section {
    flex: 1;
    min-width: 280px;
    padding: 25px;
    background-color: transparent; /* Supprime le fond */
    border-right: 1px solid rgba(240, 240, 240, 0.6);
    
    /* PHOTO EN FOND DE TOUTE LA SECTION CALENDRIER */
    background-image: url('https://lh3.googleusercontent.com/d/1wOQdg0g9v4PWfiWV-5sFR3aIQW9Szzcq=s800');
    background-size: cover;
    background-position: center;
    background-attachment: local;
    position: relative;
}

/* Couche semi-transparente */
.calendar-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 249, 251, 0.7);
    z-index: 1;
}

/* Le calendrier au-dessus */
.calendar-section > * {
    position: relative;
    z-index: 2;
}
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .month-year {
            font-size: 1.4rem;
            font-weight: 600;
            color: #e91e63;
        }
        
        .calendar-nav {
            display: flex;
            gap: 8px;
        }
        
        .nav-btn {
            background-color: #fce4ec;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #e91e63;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background-color: #f8bbd9;
            color: white;
        }
        
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 8px;
            text-align: center;
            font-weight: 600;
            color: #e91e63;
            font-size: 0.9rem;
        }
        
        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        
        .day {
            height: 42px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
            padding-top: 4px;
        }
        
        .day:hover {
            background-color: #fce4ec;
        }
        
        .day.empty {
            background-color: transparent;
            cursor: default;
        }
        
        .day.today {
            background-color: #f8bbd9;
            color: white;
            font-weight: 700;
        }
        
        .day.has-entry {
            background-color: #e91e63;
            color: white;
            position: relative;
        }
        
        .day.has-entry::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 5px;
            height: 5px;
            background-color: #ffeb3b;
            border-radius: 50%;
        }
        
        .day.selected {
            border: 2px solid #e91e63;
            background-color: #fff9fb;
            color: #e91e63;
            font-weight: 700;
        }
        
        .day-weight {
            font-size: 0.7rem;
            font-weight: bold;
            margin-top: 2px;
            color: #ffeb3b !important;
            background-color: rgba(255, 235, 59, 0.2) !important;
            padding: 1px 4px;
            border-radius: 3px;
            display: inline-block;
            min-width: 30px;
            text-align: center;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
        }
        
        .day-menstruation {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
            color: #ff4081;
        }
        
        .day-menstruation-indicator {
            width: 6px;
            height: 6px;
            background-color: #ff4081;
            border-radius: 50%;
            position: absolute;
            top: 3px;
            right: 3px;
        }
        
        .loading {
            text-align: center;
            padding: 35px;
            color: #e91e63;
            font-size: 1.1rem;
        }
        
        .loading i {
            margin-right: 8px;
        }
        
        .journal-entry {
    background-color: rgba(255, 255, 255, 0.8); /* Plus transparent */
    border-radius: 8px;
    padding: 20px 25px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border-left: 6px solid rgba(248, 187, 217, 0.9);
    margin-bottom: 15px;
    position: relative;
    backdrop-filter: blur(2px);
}
        
        .journal-entry::before {
            content: "";
            position: absolute;
            left: -6px;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(to bottom, #f8bbd9, #e91e63);
            border-radius: 6px 0 0 6px;
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #f0f0f0;
        }
        
        .entry-date {
            font-size: 1.3rem;
            font-weight: 700;
            color: #e91e63;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .entry-mood {
            font-size: 1.8rem;
        }
        
        .entry-content {
            font-size: 0.9rem;
            line-height: 1.3;
            color: #444;
        }
        
        /* Navigation interne - boutons de section */
        .section-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .section-nav-btn {
            background: linear-gradient(135deg, var(--color1, #4CAF50), var(--color2, #2196F3));
            border: none;
            border-radius: 12px;
            padding: 6px 10px;
            font-size: 0.75rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            max-width: 150px;
            text-align: center;
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .section-nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .section-nav-end {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #f0f0f0;
        }
        
        /* Navigation précédent/suivant */
        .entry-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #f0f0f0;
        }
        
        .nav-prev-next {
            background: linear-gradient(135deg, #e91e63, #f8bbd9);
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.85rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 5px rgba(233, 30, 99, 0.2);
        }
        
        .nav-prev-next:hover:not(.disabled) {
            background: linear-gradient(135deg, #f8bbd9, #e91e63);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(233, 30, 99, 0.3);
        }
        
        .nav-prev-next.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #ccc;
        }
        
        /* Titres de section centrés avec couleurs harmonisées */
        .section-title {
            background: linear-gradient(90deg, rgba(233, 30, 99, 0.15), rgba(255, 255, 255, 0.2));
            padding: 8px 12px;
            margin: 12px 0 8px 0;
            border-radius: 6px;
            color: #e91e63;
            font-weight: 700;
            font-size: 1rem;
            border-left: 4px solid #e91e63;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .section-title i {
            font-size: 1.2rem;
            color: inherit !important;
        }
        
        /* COULEURS MULTICOLORES POUR LES SECTIONS */
        .section-sommeil {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(156, 39, 176, 0.3);
        }
        
        .section-sommeil .section-title {
            background: linear-gradient(90deg, rgba(156, 39, 176, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #9c27b0 !important;
            border-left-color: #9c27b0 !important;
        }
        
        .section-matin {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(255, 152, 0, 0.3);
        }
        
        .section-matin .section-title {
            background: linear-gradient(90deg, rgba(255, 152, 0, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #ff9800 !important;
            border-left-color: #ff9800 !important;
        }
        
        .section-spirituel {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(33, 150, 243, 0.3);
        }
        
        .section-spirituel .section-title {
            background: linear-gradient(90deg, rgba(33, 150, 243, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #2196f3 !important;
            border-left-color: #2196f3 !important;
        }
        
        .section-alimentation {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(244, 67, 54, 0.3);
        }
        
        .section-alimentation .section-title {
            background: linear-gradient(90deg, rgba(244, 67, 54, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #f44336 !important;
            border-left-color: #f44336 !important;
        }
        
        .section-travail {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }
        
        .section-travail .section-title {
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #4caf50 !important;
            border-left-color: #4caf50 !important;
        }
        
        .section-lecture {
            background: linear-gradient(135deg, rgba(121, 85, 72, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(121, 85, 72, 0.3);
        }
        
        .section-lecture .section-title {
            background: linear-gradient(90deg, rgba(121, 85, 72, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #795548 !important;
            border-left-color: #795548 !important;
        }
        
        .section-activites {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(255, 193, 7, 0.3);
        }
        
        .section-activites .section-title {
            background: linear-gradient(90deg, rgba(255, 193, 7, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #ffc107 !important;
            border-left-color: #ffc107 !important;
        }
        
        .section-physique {
            background: linear-gradient(135deg, rgba(0, 150, 136, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(0, 150, 136, 0.3);
        }
        
        .section-physique .section-title {
            background: linear-gradient(90deg, rgba(0, 150, 136, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #009688 !important;
            border-left-color: #009688 !important;
        }
        
        .section-menagere {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(156, 39, 176, 0.3);
        }
        
        .section-menagere .section-title {
            background: linear-gradient(90deg, rgba(156, 39, 176, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #9c27b0 !important;
            border-left-color: #9c27b0 !important;
        }
        
        .section-programme {
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(255, 87, 34, 0.3);
        }
        
        .section-programme .section-title {
            background: linear-gradient(90deg, rgba(255, 87, 34, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #ff5722 !important;
            border-left-color: #ff5722 !important;
        }
        
        .section-nyako {
            background: linear-gradient(135deg, rgba(103, 58, 183, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(103, 58, 183, 0.3);
        }
        
        .section-nyako .section-title {
            background: linear-gradient(90deg, rgba(103, 58, 183, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #673ab7 !important;
            border-left-color: #673ab7 !important;
        }
        
        .section-finance {
            background: linear-gradient(135deg, rgba(139, 195, 74, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(139, 195, 74, 0.3);
        }
        
        .section-finance .section-title {
            background: linear-gradient(90deg, rgba(139, 195, 74, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #8bc34a !important;
            border-left-color: #8bc34a !important;
        }
        
        .section-deplacement {
            background: linear-gradient(135deg, rgba(0, 188, 212, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(0, 188, 212, 0.3);
        }
        
        .section-deplacement .section-title {
            background: linear-gradient(90deg, rgba(0, 188, 212, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #00bcd4 !important;
            border-left-color: #00bcd4 !important;
        }
        
        .section-relation {
            background: linear-gradient(135deg, rgba(255, 64, 129, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(255, 64, 129, 0.3);
        }
        
        .section-relation .section-title {
            background: linear-gradient(90deg, rgba(255, 64, 129, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #ff4081 !important;
            border-left-color: #ff4081 !important;
        }
        
        .section-periodique {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(233, 30, 99, 0.3);
        }
        
        .section-periodique .section-title {
            background: linear-gradient(90deg, rgba(233, 30, 99, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #e91e63 !important;
            border-left-color: #e91e63 !important;
        }
        
        .section-sante {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }
        
        .section-sante .section-title {
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #4caf50 !important;
            border-left-color: #4caf50 !important;
        }
        
        .section-poids {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(255, 152, 0, 0.3);
        }
        
        .section-poids .section-title {
            background: linear-gradient(90deg, rgba(255, 152, 0, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #ff9800 !important;
            border-left-color: #ff9800 !important;
        }
        
        .section-bilan {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(255, 255, 255, 0.2)) !important;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 18px;
            border: 2px solid rgba(33, 150, 243, 0.3);
        }
        
        .section-bilan .section-title {
            background: linear-gradient(90deg, rgba(33, 150, 243, 0.3), rgba(255, 255, 255, 0.2)) !important;
            color: #2196f3 !important;
            border-left-color: #2196f3 !important;
        }
        
        .entry-row {
            display: flex;
            margin-bottom: 4px;
            padding: 4px 0;
            align-items: flex-start;
            min-height: 26px;
        }
        
        .entry-row:last-child {
            border-bottom: none;
        }
        
        .entry-label {
            flex: 0 0 170px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            padding-right: 8px;
            font-size: 0.9rem;
        }
        
        .entry-label i {
            font-size: 0.9rem;
            min-width: 18px;
            text-align: center;
        }
        
        /* COULEURS DES LABELS PAR SECTION - CORRIGÉ */
        .section-sommeil .entry-label {
            color: #9c27b0 !important;
        }
        
        .section-matin .entry-label {
            color: #ff9800 !important;
        }
        
        .section-spirituel .entry-label {
            color: #2196f3 !important;
        }
        
        .section-alimentation .entry-label {
            color: #f44336 !important;
        }
        
        .section-travail .entry-label {
            color: #4caf50 !important;
        }
        
        .section-lecture .entry-label {
            color: #795548 !important;
        }
        
        .section-activites .entry-label {
            color: #ffc107 !important;
        }
        
        .section-physique .entry-label {
            color: #009688 !important;
        }
        
        .section-menagere .entry-label {
            color: #9c27b0 !important;
        }
        
        .section-programme .entry-label {
            color: #ff5722 !important;
        }
        
        .section-nyako .entry-label {
            color: #673ab7 !important;
        }
        
        .section-finance .entry-label {
            color: #8bc34a !important;
        }
        
        .section-deplacement .entry-label {
            color: #00bcd4 !important;
        }
        
        .section-relation .entry-label {
            color: #ff4081 !important;
        }
        
        .section-periodique .entry-label {
            color: #e91e63 !important;
        }
        
        .section-sante .entry-label {
            color: #4caf50 !important;
        }
        
        .section-poids .entry-label {
            color: #ff9800 !important;
        }
        
        .section-bilan .entry-label {
            color: #2196f3 !important;
        }
        
        /* Texte handwriting plus léger */
        .entry-value {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #fce4ec;
            white-space: pre-line;
            line-height: 1.3;
            font-family: 'Pacifico', cursive;
            font-weight: 300 !important;
            font-size: 0.95rem;
            color: #666;
        }
        
        /* NOUVELLE COULEUR VERT POMME pour cadeau reçu, texte médité et retenu */
        .cadeau-recu {
            color: #4CAF50 !important; /* Vert pomme */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-weight: 500 !important;
            background-color: rgba(76, 175, 80, 0.1) !important;
            padding: 6px 10px !important;
            border-radius: 5px !important;
            border: 1px solid rgba(76, 175, 80, 0.3) !important;
        }
        
        .texte-medite {
            color: #4CAF50 !important; /* Vert pomme */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-weight: 500 !important;
            background-color: rgba(76, 175, 80, 0.1) !important;
            padding: 6px 10px !important;
            border-radius: 5px !important;
            border: 1px solid rgba(76, 175, 80, 0.3) !important;
        }
        
        .retenu-meditation {
            color: #4CAF50 !important; /* Vert pomme */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-weight: 500 !important;
            background-color: rgba(76, 175, 80, 0.1) !important;
            padding: 6px 10px !important;
            border-radius: 5px !important;
            border: 1px solid rgba(76, 175, 80, 0.3) !important;
        }
        
        /* Couleurs spécifiques pour les autres éléments */
        .pensees-analyse {
            color: #ff9800 !important;
        }
        
        .occupation {
            color: #2196f3 !important;
        }
        
        .maladie-sante {
            color: #f44336 !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-weight: 400 !important;
        }
        
        .resolution-du-jour {
            color: #ff9800 !important;
        }
        
        .deroulement-journee {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-weight: 400 !important;
            color: #666 !important;
            background-color: rgba(255, 255, 255, 0.8) !important;
            padding: 6px 10px !important;
            border-radius: 5px !important;
            border: 1px solid #e0e0e0 !important;
        }
        
        .entry-value a {
            color: #e91e63;
            text-decoration: underline;
            font-weight: 600;
        }
        
        .entry-value a:hover {
            color: #f8bbd9;
        }
        
        /* COULEURS MODIFIÉES - Heures en vert, durées en bleu */
        .time-value {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-weight: 600 !important;
            color: #2E7D32 !important;
            font-size: 0.95rem !important;
            background-color: rgba(46, 125, 50, 0.1) !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
            border: 1px solid rgba(46, 125, 50, 0.3) !important;
        }
        
        .duration-value {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-weight: 600 !important;
            color: #1565C0 !important;
            font-size: 0.95rem !important;
            background-color: rgba(21, 101, 192, 0.1) !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
            border: 1px solid rgba(21, 101, 192, 0.3) !important;
        }
        
        /* Texte repas en violet - TAILLE RÉDUITE */
        .meal-text {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-weight: 500 !important;
            color: #7B1FA2 !important;
            font-size: 0.85rem !important;
            line-height: 1.4 !important;
        }
        
        /* Réduire largeur des cartes réveil/coucher */
        .compact-row-sommeil {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
            justify-content: space-between;
        }
        
        .compact-item-sommeil {
            flex: 1;
            min-width: 0;
            max-width: 32%;
            background-color: #f5f5f5;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            min-height: 36px;
            display: flex;
            align-items: center;
        }
        
        .compact-label-sommeil {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 70px;
            font-size: 0.85rem;
        }
        
        .compact-label-sommeil i {
            font-size: 0.8rem;
        }
        
        .compact-value-sommeil {
            flex: 1;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            color: #666;
            text-align: center;
        }
        
        /* Style pour éléments "Au réveil" */
        .aureveil-item {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-size: 0.85rem !important;
            line-height: 1.2;
            margin-bottom: 2px;
        }
        
        .compact-row {
            display: flex;
            gap: 12px;
            margin-bottom: 6px;
        }
        
        .compact-item {
            flex: 1;
            background-color: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            min-height: 32px;
            display: flex;
            align-items: center;
        }
        
        .compact-label {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 110px;
            font-size: 0.9rem;
        }
        
        .compact-label i {
            font-size: 0.85rem;
        }
        
        .compact-value {
            flex: 1;
            font-family: 'Pacifico', cursive;
            font-weight: 300 !important;
            font-size: 0.95rem;
            color: #666;
        }
        
        /* Style pour activités spirituelles */
        .spiritual-item {
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .spiritual-time {
            font-family: 'Segoe UI', sans-serif;
            color: #2e7d32;
            font-size: 0.8rem;
            background-color: rgba(46, 125, 50, 0.1);
            padding: 1px 6px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .spiritual-time::before {
            content: "⏰";
            font-size: 0.9rem;
        }
        
        /* Étoiles pour qualité de sommeil et fatigue */
        .stars-container {
            display: flex;
            gap: 2px;
            justify-content: center;
            margin-top: 2px;
        }
        
        .star {
            font-size: 1.1rem;
            color: #ddd;
        }
        
        .star.filled {
            color: #ffc107;
        }
        
        .prayer-status {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 9px;
            margin-left: 4px;
        }
        
        .prayer-ok {
            background-color: #28a745;
            color: white;
        }
        
        .prayer-no {
            background-color: #dc3545;
            color: white;
        }
        
        .prayer-inprogress {
            background-color: #ffc107;
            color: black;
        }
        
        .no-entry {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 350px;
            color: #aaa;
            text-align: center;
        }
        
        .no-entry i {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: #fce4ec;
        }
        
        .no-entry p {
            font-size: 1.1rem;
            max-width: 280px;
        }
        
        .data-source {
            margin-top: 15px;
            font-size: 0.85rem;
            color: #999;
            text-align: center;
            padding: 8px;
            background-color: #fff9fb;
            border-radius: 6px;
        }
        
        .data-source a {
            color: #e91e63;
            text-decoration: none;
            font-weight: 600;
        }
        
        .data-source a:hover {
            text-decoration: underline;
        }
        
        .stats {
            margin-top: 15px;
            padding: 10px;
            background-color: #fff9fb;
            border-radius: 6px;
            font-size: 0.8rem;
        }
        
        .stats span {
            font-weight: 600;
            color: #e91e63;
        }
        
        /* Style pour menstruation */
        .menstruation-display {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-top: 5px;
        }
        
        .menstruation-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #ffcdd2;
        }
        
        .menstruation-emoji {
            font-size: 1rem;
        }
        
        /* Emoji menstruation */
        .emoji-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }
        
        .emoji-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.8);
            padding: 3px 6px;
            border-radius: 4px;
            border: 1px solid #fce4ec;
        }
        
        .emoji-icon {
            font-size: 1rem;
        }
        
        .cycle-header {
            font-weight: bold;
            margin-bottom: 3px;
            color: #ff4081;
            font-size: 0.85rem;
        }
        
        .cycle-line {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
            flex-wrap: wrap;
        }
        
        .cycle-title {
            font-weight: bold;
            color: #ff4081;
            font-size: 0.85rem;
        }
        
        .cycle-emojis {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .cycle-emojis span {
            font-size: 0.9rem;
        }
        
        .water-calculation {
            margin-top: 3px;
            padding: 3px 6px;
            background-color: rgba(0, 188, 212, 0.1);
            border-radius: 3px;
            font-size: 0.8rem;
            color: #0097a7;
            border-left: 2px solid #00bcd4;
        }
        
        /* Style pour Finance report */
        .finance-report {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.85rem;
        }
        
        .finance-report th {
            background-color: rgba(139, 195, 74, 0.2);
            color: #e91e63;
            font-weight: 600;
            padding: 8px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }
        
        .finance-report td {
            padding: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .finance-report tr:nth-child(even) {
            background-color: rgba(139, 195, 74, 0.05);
        }
        
        .finance-total {
            background-color: rgba(139, 195, 74, 0.3) !important;
            font-weight: 700;
            color: #2E7D32;
        }
        
        .finance-category {
            font-weight: 600;
            color: #795548;
        }
        
        .finance-amount {
            text-align: right;
            font-family: 'Segoe UI', sans-serif;
            font-weight: 600;
            color: #333;
        }
        
        .finance-detail {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
            padding: 2px 0;
        }
        
        .finance-summary {
            background-color: rgba(46, 125, 50, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid rgba(46, 125, 50, 0.3);
        }
        
        .finance-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px dashed #ccc;
        }
        
        .finance-summary-row:last-child {
            border-bottom: none;
            font-weight: 700;
            color: #2E7D32;
        }
        
        .finance-summary-label {
            font-weight: 600;
            color: #e91e63;
        }
        
        .finance-summary-value {
            font-weight: 700;
            font-family: 'Segoe UI', sans-serif;
        }
        
        /* Icônes de décoration pour les sections */
        .section-decoration {
            position: absolute;
            opacity: 0.1;
            z-index: 0;
            pointer-events: none;
        }
        
        .decoration-sommeil {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #9c27b0;
        }
        
        .decoration-matin {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #ff9800;
        }
        
        .decoration-spirituel {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #2196f3;
        }
        
        .decoration-alimentation {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #f44336;
        }
        
        .decoration-travail {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #4caf50;
        }
        
        .decoration-lecture {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #795548;
        }
        
        .decoration-activites {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #ffc107;
        }
        
        .decoration-physique {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #009688;
        }
        
        .decoration-menagere {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #9c27b0;
        }
        
        .decoration-programme {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #ff5722;
        }
        
        .decoration-nyako {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #673ab7;
        }
        
        .decoration-finance {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #8bc34a;
        }
        
        .decoration-deplacement {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #00bcd4;
        }
        
        .decoration-relation {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #ff4081;
        }
        
        .decoration-periodique {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #e91e63;
        }
        
        .decoration-sante {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #4caf50;
        }
        
        .decoration-poids {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #ff9800;
        }
        
        .decoration-bilan {
            top: 5px;
            right: 10px;
            font-size: 3.5rem;
            color: #2196f3;
        }
        
        /* Labels ménagers */
        .menagere-label {
            font-size: 0.85rem !important;
            font-weight: 500 !important;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .menagere-time {
            font-size: 0.75rem;
            color: #795548;
            margin-left: 5px;
            font-weight: normal;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }
        
        .menagere-value {
            font-size: 0.9rem;
            color: #555;
            font-weight: 300;
            margin-left: 15px;
        }
        
        /* Tableau pour poids et mensuration */
        .measurement-table {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .measurement-item {
            background-color: #f5f5f5;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }
        
        .measurement-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #e91e63;
            margin-bottom: 4px;
        }
        
        .measurement-value {
            font-size: 1rem;
            font-weight: 700;
            color: #333;
        }
        
        /* Style pour repas - MODIFIÉ POUR MOBILE */
        .meal-container {
            border: 2px solid #fce4ec;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            background-color: #f5f5f5;
        }
        
        .meal-title {
            font-weight: 600;
            color: #e91e63;
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* MODIFICATIONS POUR LES REPAS - Sur une seule ligne en desktop */
        .meal-line-single {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: nowrap;
        }
        
        .meal-line-double {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: nowrap;
        }
        
        .meal-compact-item {
            flex: 1;
            background-color: #f5f5f5;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            min-height: 40px;
        }
        
        .meal-compact-label {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 40px;
            font-size: 0.85rem;
        }
        
        .meal-compact-label i {
            font-size: 0.8rem;
        }
        
        .meal-compact-value {
            flex: 1;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .meal-content {
            background-color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #fce4ec;
            margin-top: 8px;
        }
        
        .meal-content-label {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .meal-content-value {
            font-family: 'Pacifico', cursive;
            font-weight: 300 !important;
            font-size: 0.85rem !important;
            color: #666;
        }
        
        /* Nouveau style pour travail */
        .travail-header {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .travail-type {
            flex: 1;
            font-weight: 600;
            color: #795548;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }
        
        /* Heure et durée travail */
        .travail-time-container {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .travail-time-card {
            flex: 1;
            background-color: #f5f5f5;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
        }
        
        .travail-content-row {
            display: flex;
            gap: 12px;
            margin-top: 10px;
        }
        
        .travail-content-item {
            flex: 1;
            background-color: #f5f5f5;
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        
        /* Emojis pour menstruation */
        .menstruation-emojis {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 5px;
        }
        
        .menstruation-emoji {
            font-size: 1.2rem;
            margin-right: 5px;
        }
        
        .menstruation-item {
            display: inline-flex;
            align-items: center;
            margin-right: 8px;
            margin-bottom: 5px;
            padding: 2px 8px;
            background: #f5f5f5;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            font-size: 0.85rem;
        }
        
        /* Interface d'accueil - nouvelles sections */
        .home-interface {
            padding: 20px;
            background-color: #fff9fb;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 2px solid #f8bbd9;
        }
        
        .home-section {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0;
        }
        
        .home-section-title {
            color: #e91e63;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #fce4ec;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .field-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .field-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            background-color: #fce4ec;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .field-checkbox:hover {
            background-color: #f8bbd9;
            color: white;
        }
        
        .field-checkbox.selected {
            background-color: #e91e63;
            color: white;
        }
        
        .date-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .date-option {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .date-input {
            padding: 8px 12px;
            border: 1px solid #f8bbd9;
            border-radius: 6px;
            font-size: 0.9rem;
            background-color: white;
            color: #333;
        }
        
        .date-input:focus {
            outline: none;
            border-color: #e91e63;
            box-shadow: 0 0 0 2px rgba(233, 30, 99, 0.2);
        }
        
        .action-button {
            background: linear-gradient(135deg, #e91e63 0%, #f8bbd9 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-button:hover {
            background: linear-gradient(135deg, #f8bbd9 0%, #e91e63 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .results-container {
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
            background-color: white;
        }
        
        .result-item-home {
            padding: 12px 15px;
            border-bottom: 1px solid #fce4ec;
        }
        
        .result-item-home:last-child {
            border-bottom: none;
        }
        
        .result-date-home {
            font-weight: 700;
            color: #e91e63;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }
        
        .result-content-home {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.4;
        }
        
        .no-results-home {
            padding: 30px;
            text-align: center;
            color: #e91e63;
            font-size: 0.95rem;
        }
        
        .loading-home {
            text-align: center;
            padding: 30px;
            color: #e91e63;
        }
        
        /* COULEURS DES ÉMOJIS DANS LES FICHES - MODIFIÉ: les émojis gardent leur couleur d'origine */
        .section-nav-btn i,
        .section-title i,
        .entry-label i,
        .compact-label i,
        .meal-title i,
        .meal-content-label i,
        .compact-label-sommeil i,
        .compact-label-sommeil,
        .menstruation-emoji,
        .emoji-icon,
        .spiritual-time::before,
        .menagere-time i,
        .finance-report i,
        .prayer-status,
        .star {
            color: inherit !important;
        }
        
        /* LES BOUTONS DE NAVIGATION GARDENT LEURS ÉMOJIS NOIRS */
        .section-nav-btn i {
            color: black !important;
        }
        
        @media (max-width: 768px) {
            * {
                box-sizing: border-box;
            }
            
             body {
        padding: 3px;
        font-size: 14px;
        line-height: 1.3;
    }
    
    /* Ajoutez cette ligne pour le fond mobile */
    body::after {
        opacity: 0.07; /* Encore plus transparent sur mobile */
        background-attachment: scroll; /* Meilleure performance mobile */
    }
            
            .container {
                margin-top: 70px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            }
            
            header {
                padding: 12px 15px;
            }
            
            h1 {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }
            
            .subtitle {
                font-size: 0.85rem;
            }
            
            .main-content {
                flex-direction: column;
                min-height: auto;
            }
            
            .calendar-section, .journal-section {
                width: 100%;
                padding: 12px 10px;
                min-width: 100%;
            }
            
           .calendar-section {
    flex: 1;
    min-width: 280px;
    padding: 25px;
    background-color: rgba(255, 249, 251, 0.8);
    border-right: 1px solid rgba(240, 240, 240, 0.9);
}
            
            h2 {
                font-size: 1.2rem;
                margin-bottom: 8px;
                padding-bottom: 5px;
            }
            
            .journal-entry::before {
                display: none;
            }
            
            .journal-entry {
                border-left: 2px solid #f8bbd9;
                padding: 10px 8px;
                margin-bottom: 10px;
            }
            
            .entry-header {
                margin-bottom: 8px;
                padding-bottom: 6px;
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .entry-date {
                font-size: 1rem;
                line-height: 1.2;
            }
            
            [class*="section-"] {
                padding: 8px !important;
                margin-bottom: 10px !important;
                border-width: 1px !important;
                border-radius: 6px !important;
            }
            
            .section-title {
                font-size: 0.85rem !important;
                padding: 5px 6px !important;
                margin: 8px 0 6px 0 !important;
                gap: 5px;
            }
            
            .section-title i {
                font-size: 0.9rem;
            }
            
            .section-decoration {
                display: none;
            }
            
            .section-nav {
                gap: 4px;
                margin: 10px 0;
            }
            
            .section-nav-btn {
                font-size: 0.65rem;
                padding: 4px 6px;
                max-width: 120px;
            }
            
            .nav-prev-next {
                padding: 6px 10px;
                font-size: 0.75rem;
            }
            
            .entry-row {
                display: flex;
                flex-direction: column;
                margin-bottom: 6px;
                padding: 0;
                align-items: stretch;
                gap: 3px;
            }
            
            .entry-label {
                flex: 0 0 auto !important;
                width: 100% !important;
                min-width: 100% !important;
                max-width: 100% !important;
                padding: 4px 0 2px 0;
                font-size: 0.8rem !important;
                border-bottom: 1px dashed #fce4ec;
                margin-bottom: 3px;
            }
            
            .entry-label i {
                font-size: 0.75rem;
                min-width: 16px;
            }
            
            .entry-value {
                flex: 1 1 auto !important;
                width: 100% !important;
                font-size: 0.85rem !important;
                padding: 5px 6px !important;
                line-height: 1.3 !important;
                min-height: auto;
            }
            
            /* MODIFICATIONS POUR REPAS EN MOBILE */
            .meal-line-single,
            .meal-line-double {
                flex-direction: column !important;
                gap: 5px !important;
            }
            
            .meal-line-single .meal-compact-item,
            .meal-line-double .meal-compact-item {
                width: 100% !important;
                max-width: 100% !important;
                padding: 5px 6px !important;
                min-height: 32px;
            }
            
            /* Heure et durée sur une ligne en mobile */
            .meal-compact-item:nth-child(1),
            .meal-compact-item:nth-child(2) {
                display: inline-flex !important;
                width: 48% !important;
                margin-right: 4% !important;
            }
            
            .meal-compact-item:nth-child(2) {
                margin-right: 0 !important;
            }
            
            /* Lieu et avec sur une ligne en mobile */
            .meal-compact-item:nth-child(3),
            .meal-compact-item:nth-child(4) {
                display: inline-flex !important;
                width: 48% !important;
                margin-right: 4% !important;
            }
            
            .meal-compact-item:nth-child(4) {
                margin-right: 0 !important;
            }
            
            .meal-content {
                padding: 5px 6px;
                margin-top: 6px;
            }
            
            .meal-content-value {
                font-size: 0.8rem !important;
            }
            
            .compact-row-sommeil,
            .travail-time-container,
            .travail-content-row {
                flex-direction: column;
                gap: 5px;
                margin-bottom: 5px;
            }
            
            .compact-item-sommeil,
            .compact-item,
            .double-item,
            .triple-item,
            .travail-time-card,
            .travail-content-item {
                width: 100% !important;
                max-width: 100% !important;
                padding: 5px 6px !important;
                min-height: 32px;
            }
            
            .compact-label-sommeil,
            .meal-compact-label,
            .compact-label {
                min-width: 85px !important;
                font-size: 0.8rem !important;
            }
            
            .compact-value-sommeil,
            .meal-compact-value,
            .compact-value {
                font-size: 0.85rem !important;
            }
            
            .meal-container {
                padding: 8px;
                margin-bottom: 10px;
            }
            
            .meal-title {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }
            
            .calendar {
                padding: 10px;
            }
            
            .calendar-header {
                margin-bottom: 10px;
            }
            
            .month-year {
                font-size: 1.1rem;
            }
            
            .nav-btn {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
            
            .weekdays {
                font-size: 0.8rem;
                margin-bottom: 5px;
            }
            
            .day {
                height: 36px;
                font-size: 0.85rem;
                padding-top: 3px;
            }
            
            .day-weight {
                font-size: 0.6rem;
                min-width: 25px;
                padding: 1px 2px;
                margin-top: 1px;
            }
            
            .day-menstruation {
                font-size: 0.7rem;
                top: 1px;
                right: 1px;
            }
            
            .search-container {
                top: 8px;
                width: calc(100% - 16px);
                left: 8px;
                transform: none;
            }
            
            .search-box {
                border-radius: 20px;
            }
            
            #search-input {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .search-btn {
                width: 45px;
                font-size: 16px;
            }
            
            .search-results {
                top: 55px;
                left: 8px;
                width: calc(100% - 16px);
                transform: none;
                max-height: 70vh;
            }
            
            .results-header {
                padding: 10px 12px;
            }
            
            .results-header h3 {
                font-size: 16px;
            }
            
            .results-list {
                padding: 12px;
                max-height: calc(70vh - 50px);
            }
            
            .result-item {
                padding: 8px;
                margin-bottom: 10px;
            }
            
            .result-date {
                font-size: 0.95rem;
            }
            
            .result-snippet {
                font-size: 0.85rem;
            }
            
            .floating-buttons {
                right: 8px;
                bottom: 8px;
            }
            
            .floating-btn {
                width: 38px;
                height: 38px;
                font-size: 16px;
            }
            
            .stats {
                font-size: 0.75rem;
                padding: 8px;
                margin-top: 10px;
            }
            
            .measurement-table {
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
            }
            
            .measurement-item {
                padding: 6px;
            }
            
            .measurement-label {
                font-size: 0.75rem;
            }
            
            .measurement-value {
                font-size: 0.9rem;
            }
            
            .menstruation-item {
                font-size: 0.75rem;
                padding: 1px 4px;
                margin-right: 3px;
                margin-bottom: 3px;
            }
            
            .spiritual-item {
                font-size: 0.8rem;
                margin-bottom: 2px;
            }
            
            .aureveil-item {
                font-size: 0.78rem !important;
                line-height: 1.2 !important;
                margin-bottom: 2px !important;
            }
            
            .entry-value,
            .compact-value,
            .meal-content-value,
            .travail-content-item .compact-value {
                white-space: normal !important;
                word-break: break-word !important;
                overflow-wrap: break-word !important;
                line-height: 1.3 !important;
                max-width: 100%;
                overflow: hidden;
            }
            
            .entry-label, .entry-value,
            .compact-label, .compact-value,
            .meal-title, .meal-content-value,
            .section-title, .result-date {
                word-wrap: break-word;
                word-break: break-word;
                hyphens: auto;
            }
            
            .time-value {
                font-size: 0.82rem !important;
            }
            
            .duration-value {
                font-size: 0.82rem !important;
            }
            
            .stars-container {
                transform: scale(0.9);
            }
            
            .star {
                font-size: 1rem;
            }
            
            @media (max-height: 500px) and (orientation: landscape) {
                .journal-section {
                    max-height: 65vh;
                    overflow-y: auto;
                }
                
                .search-results {
                    max-height: 50vh;
                }
                
                .results-list {
                    max-height: calc(50vh - 50px);
                }
            }
            
            .finance-report {
                font-size: 0.75rem;
            }
            
            .finance-report th,
            .finance-report td {
                padding: 4px 6px;
            }
            
            /* Interface d'accueil mobile */
            .home-interface {
                padding: 12px;
                margin-bottom: 15px;
            }
            
            .home-section {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .home-section-title {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .field-selector {
                gap: 6px;
            }
            
            .field-checkbox {
                padding: 4px 8px;
                font-size: 0.8rem;
            }
            
            .date-selector {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .date-input {
                width: 100%;
                padding: 6px 10px;
            }
            
            .action-button {
                width: 100%;
                justify-content: center;
                padding: 8px 16px;
            }
            
            .results-container {
                max-height: 400px;
            }
            
            /* Message et appel sur une même ligne en mobile */
            .section-relation .triple-row {
                flex-direction: column !important;
            }
            
            .section-relation .triple-item {
                width: 100% !important;
                margin-bottom: 5px !important;
            }
            
            /* Détails comm sur une ligne en dessous */
            .relation-message-appel {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }
            
            .relation-message-appel > div {
                width: 100%;
            }
            
            .relation-details-comm {
                margin-top: 5px;
                width: 100%;
            }
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
            font-size: 0.9rem;
        }
        
        .triple-row {
            display: flex;
            gap: 12px;
            margin-bottom: 6px;
        }
        
        .triple-item {
            flex: 1;
            background-color: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            min-height: 32px;
            display: flex;
            align-items: center;
        }
        
        .double-row {
            display: flex;
            gap: 12px;
            margin-bottom: 6px;
        }
        
        .double-item {
            flex: 1;
            background-color: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            min-height: 32px;
            display: flex;
            align-items: center;
        }
        
        .handwriting {
            font-family: 'Pacifico', cursive;
            font-weight: 300 !important;
        }
        
        /* Icônes de couleur - COULEUR NOIRE POUR LES ÉMOJIS DES BOUTONS */
        .section-nav-btn i {
            color: black !important;
        }
        
        /* COULEURS DES BOUTONS FLOTTANTS - ICÔNES BLANCHES */
        .floating-btn i {
            color: white !important;
        }
        
        /* Boutons flottants */
        .floating-buttons {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .floating-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .floating-btn.tooltip {
            position: relative;
        }
        
        .floating-btn.tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 1001;
            pointer-events: none;
        }
        
        .floating-btn.tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* COULEURS DES BOUTONS FLOTTANTS */
        #search-access-btn {
            background: linear-gradient(135deg, #2196F3, #64B5F6);
            color: white;
        }
        
        #calendar-access-btn {
            background: linear-gradient(135deg, #4CAF50, #81C784);
            color: white;
        }
        
        #home-access-btn {
            background: linear-gradient(135deg, #FF9800, #FFB74D);
            color: white;
        }
        
        #form-btn {
            background: linear-gradient(135deg, #E91E63, #F48FB1);
            color: white;
        }
        
        #sheet-btn {
            background: linear-gradient(135deg, #9C27B0, #CE93D8);
            color: white;
        }
        
        #search-access-btn:hover {
            background: linear-gradient(135deg, #64B5F6, #2196F3);
        }
        
        #calendar-access-btn:hover {
            background: linear-gradient(135deg, #81C784, #4CAF50);
        }
        
        #home-access-btn:hover {
            background: linear-gradient(135deg, #FFB74D, #FF9800);
        }
        
        #form-btn:hover {
            background: linear-gradient(135deg, #F48FB1, #E91E63);
        }
        
        #sheet-btn:hover {
            background: linear-gradient(135deg, #CE93D8, #9C27B0);
        }
        
        /* Barre de recherche */
        .search-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            width: 90%;
            max-width: 600px;
            transition: all 0.3s ease;
        }
        
        .search-box {
            position: relative;
            display: flex;
            background: white;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            border: 2px solid #f8bbd9;
        }
        
        #search-input {
            flex: 1;
            padding: 14px 20px;
            border: none;
            outline: none;
            font-size: 16px;
            background: transparent;
            color: #333;
        }
        
        .search-btn {
            width: 60px;
            background: linear-gradient(135deg, #e91e63 0%, #f8bbd9 100%);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .search-btn:hover {
            background: linear-gradient(135deg, #f8bbd9 0%, #e91e63 100%);
        }
        
        /* Suggestions */
        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1002;
            border-top: 1px solid #eee;
        }
        
        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s;
        }
        
        .suggestion-item:hover {
            background-color: #fff9fb;
        }
        
        .suggestion-item i {
            color: #e91e63;
            font-size: 14px;
        }
        
        .suggestion-text {
            flex: 1;
            font-size: 14px;
            color: #333;
        }
        
        .suggestion-date {
            font-size: 12px;
            color: #e91e63;
            background: #fce4ec;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        /* Résultats de recherche */
        .search-results {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 800px;
            max-height: 70vh;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            z-index: 1003;
            display: none;
            overflow: hidden;
            border: 2px solid #f8bbd9;
        }
        
        .results-header {
            background: linear-gradient(135deg, #e91e63 0%, #f8bbd9 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .results-header h3 {
            margin: 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-results {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s;
        }
        
        .close-results:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .results-list {
            padding: 20px;
            max-height: calc(70vh - 60px);
            overflow-y: auto;
        }
        
        .result-item {
            background: #fff9fb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #f8bbd9;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .result-item:hover {
            background: #fce4ec;
            transform: translateX(5px);
        }
        
        .result-date {
            font-weight: 700;
            color: #e91e63;
            font-size: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .result-snippet {
            color: #555;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .result-highlight {
            background-color: #ffecb3;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
            color: #e91e63;
        }
        
        .result-matches {
            font-size: 12px;
            color: #e91e63;
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(233, 30, 99, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            width: fit-content;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #e91e63;
        }
        
        .no-results i {
            font-size: 40px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Bouton pour remonter en haut de la fiche - À GAUCHE */
        .back-to-top-btn {
            position: fixed;
            left: 20px;
            bottom: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e91e63 0%, #f8bbd9 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all 0.3s ease;
            z-index: 999;
            opacity: 1;
            visibility: visible;
        }
        
        .back-to-top-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #f8bbd9 0%, #e91e63 100%);
        }
        
        .back-to-top-btn i {
            color: white !important;
        }
        
        /* Nouvelles classes pour les modifications demandées */
        .compact-row-quadruple {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
        }
        
        .compact-row-quadruple .compact-item {
            min-width: 0;
            flex: 1;
        }
        
        .collation-section {
            background-color: rgba(255, 152, 0, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 152, 0, 0.3);
        }
        
        .collation-title {
            font-weight: 600;
            color: #ff9800;
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        /* Nouvelles icônes */
        .fa-hands-praying { color: #9c27b0; }
        .fa-comment-medical { color: #f44336; }
        .fa-sms { color: #4caf50; }
        .fa-phone { color: #2196f3; }
        .fa-money-check-alt { color: #8bc34a; }
        .fa-ear { color: #ff9800; }
        .fa-teeth { color: #00bcd4; }
        .fa-stethoscope { color: #795548; }
        .fa-thought-bubble { color: #673ab7; }
        .fa-utensils-alt { color: #f44336; }
        .fa-stopwatch { color: #607d8b; }
        .fa-walking { color: #4caf50; }
        .fa-standing { color: #ffc107; }
        .fa-home-alt { color: #795548; }
        .fa-money-bill-alt { color: #8bc34a; }
        .fa-shopping-bag { color: #ff9800; }
        .fa-bus-alt { color: #ffc107; }
        .fa-car-side { color: #2196f3; }
        .fa-motorcycle { color: #ff5722; }
        .fa-comments-alt { color: #00bcd4; }
        .fa-envelope { color: #9c27b0; }
        .fa-toothbrush { color: #00bcd4; }
        .fa-brain-circuit { color: #673ab7; }
        
        /* Cacher le message d'erreur CORS */
        .hidden {
            display: none !important;
        }
        
        @media (max-width: 768px) {
            .back-to-top-btn {
                left: 15px;
                bottom: 15px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .search-container {
                top: 15px;
                width: 95%;
            }
            
            #search-input {
                padding: 12px 15px;
                font-size: 15px;
            }
            
            .search-btn {
                width: 50px;
            }
            
            .search-results {
                top: 70px;
                max-height: 80vh;
            }
            
            .results-list {
                max-height: calc(80vh - 60px);
            }
            
            .result-item {
                padding: 12px;
            }
            
            .floating-buttons {
                right: 15px;
                bottom: 15px;
            }
            
            .floating-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .floating-btn.tooltip::after {
                font-size: 12px;
                padding: 6px 10px;
                right: 55px;
            }
            
            /* NOUVEAU STYLE POUR RELATION EN MOBILE - chaque champ sur sa propre ligne */
            .section-relation .compact-row {
                flex-direction: column !important;
            }
            
            .section-relation .triple-item,
            .section-relation .double-item {
                width: 100% !important;
                max-width: 100% !important;
                margin-bottom: 5px;
            }
        }
        
        .container {
            margin-top: 80px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin-top: 70px;
            }
        }
        
     /* Écran de mot de passe - VERSION CORRIGÉE */
.password-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #e91e63 0%, #f8bbd9 100%);
    z-index: 9999;
    color: white;
    text-align: center;
    padding: 20px;
    overflow-y: auto; /* Permet le défilement si le contenu est trop long */
    display: block; /* Changé de flex à block pour le défilement */
}

/* Conteneur principal centré */
.password-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start; /* Commence en haut */
    min-height: 100vh;
    padding: 40px 20px;
    max-width: 1200px;
    margin: 0 auto;
}

/* Photo de profil au-dessus de la boîte de mot de passe */
.profile-photo-container {
    margin-bottom: 30px;
    text-align: center;
    max-width: 12cm;
}

.profile-photo-link {
    display: block;
    width: 10cm; /* Réduit de 12cm à 10cm pour mieux rentrer */
    height: 10cm;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    border: 5px solid #FFD700;
    position: relative;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    text-decoration: none;
    margin: 0 auto;
}

.profile-photo-link:hover {
    transform: translateY(-5px) scale(1.03);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
    border-color: #FFA500;
}

.profile-photo {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease;
}

.profile-photo-link:hover .profile-photo {
    transform: scale(1.08);
}

.profile-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
    color: white;
    padding: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    opacity: 0;
    transform: translateY(100%);
    transition: all 0.4s ease;
    text-align: center;
    backdrop-filter: blur(2px);
}

.profile-photo-link:hover .profile-overlay {
    opacity: 1;
    transform: translateY(0);
}

.profile-info {
    margin-top: 15px;
    font-size: 0.9rem;
    color: white;
    font-weight: 500;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px 15px;
    border-radius: 20px;
    display: inline-block;
}

.password-box {
    background: rgba(255, 255, 255, 0.95);
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    max-width: 400px;
    width: 90%;
    margin-top: 10px;
}

.password-box h2 {
    color: #e91e63;
    margin-bottom: 15px;
    font-size: 1.5rem;
}

.password-input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #f8bbd9;
    border-radius: 8px;
    font-size: 16px;
    margin-bottom: 15px;
    text-align: center;
}

.password-input:focus {
    outline: none;
    border-color: #e91e63;
}

.password-btn {
    background: linear-gradient(135deg, #e91e63 0%, #f8bbd9 100%);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    width: 100%;
}

.password-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.password-error {
    color: #f44336;
    margin-top: 10px;
    font-size: 14px;
    display: none;
}

/* Responsive pour mobile */
@media (max-width: 768px) {
    .password-content {
        padding: 20px 15px;
        justify-content: center;
    }
    
    .profile-photo-container {
        margin-bottom: 20px;
    }
    
    .profile-photo-link {
        width: 8cm;
        height: 8cm;
        border: 4px solid #FFD700;
    }
    
    .profile-photo-link:hover {
        transform: translateY(-3px) scale(1.02);
    }
    
    .profile-info {
        font-size: 0.8rem;
        padding: 6px 12px;
    }
    
    .password-box {
        padding: 20px;
        margin-top: 0;
    }
    
    .password-box h2 {
        font-size: 1.3rem;
    }
}

/* Pour les très petits écrans */
@media (max-width: 480px) {
    .password-screen {
        padding: 10px;
    }
    
    .password-content {
        padding: 15px 10px;
    }
    
    .profile-photo-link {
        width: 7cm;
        height: 7cm;
    }
    
    .profile-info {
        font-size: 0.75rem;
        padding: 5px 10px;
    }
}
        
        /* Styles pour le calcul de l'eau bue */
        .eau-bue-calculation {
            margin-top: 5px;
            padding: 5px 8px;
            background-color: rgba(0, 188, 212, 0.1);
            border-radius: 4px;
            font-size: 0.85rem;
            color: #0097a7;
            border-left: 2px solid #00bcd4;
        }
        
        .eau-bue-result {
            font-weight: 600;
            color: #007c91;
        }
        
        /* Style pour message et appel sur une même ligne */
        .relation-message-appel {
            display: flex;
            gap: 12px;
            margin-bottom: 6px;
        }
        
        .relation-message-appel .triple-item {
            flex: 1;
        }
        
        .relation-details-comm {
            margin-top: 6px;
            width: 100%;
        }
        
        /* Styles pour les champs cachés dans certaines sections */
        .hidden-field {
            display: none;
        }
/* APERÇU PHOTOS DU JOUR - 7x7cm CHACUN */
/* APERÇU PHOTOS DU JOUR - 9x9cm CHACUN (augmenté de 2cm) */
.photos-preview-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin: 20px 0;
    padding: 20px;
    background: linear-gradient(135deg, rgba(255, 253, 245, 0.9), rgba(255, 253, 245, 0.95));
    border-radius: 12px;
    border: 3px solid #FFD700;
    box-shadow: 0 6px 20px rgba(212, 175, 55, 0.2);
    justify-content: center;
}

.photo-preview-item {
    position: relative;
    text-align: center;
    width: 9cm; /* 9 cm de largeur (augmenté de 2cm) */
    height: 9cm; /* 9 cm de hauteur (augmenté de 2cm) */
    flex-shrink: 0;
}

.photo-thumbnail-link {
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
    border: 4px solid #FFD700;
    position: relative;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    text-decoration: none;
}

.photo-thumbnail-link:hover {
    transform: translateY(-8px) scale(1.08);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
    border-color: #FFA500;
}

.photo-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease;
}

.photo-thumbnail-link:hover .photo-thumbnail {
    transform: scale(1.15);
}

.photo-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
    color: white;
    padding: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    opacity: 0;
    transform: translateY(100%);
    transition: all 0.4s ease;
    text-align: center;
    backdrop-filter: blur(2px);
}

.photo-thumbnail-link:hover .photo-overlay {
    opacity: 1;
    transform: translateY(0);
}

.photo-info {
    margin-top: 10px;
    font-size: 0.85rem;
    color: #666;
    word-break: break-word;
    line-height: 1.3;
    padding: 0 5px;
    font-weight: 500;
}

/* MODAL PHOTO */
.photo-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 3000;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    max-width: 95%;
    max-height: 95%;
    position: relative;
    text-align: center;
}

.modal-photo {
    max-width: 90vw;
    max-height: 80vh;
    object-fit: contain;
    border-radius: 12px;
    box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
    animation: zoomIn 0.4s ease;
}

@keyframes zoomIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.close-modal {
    position: absolute;
    top: 20px;
    right: 30px;
    color: white;
    font-size: 40px;
    cursor: pointer;
    background: none;
    border: none;
    z-index: 3001;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.3s;
}

.close-modal:hover {
    background: rgba(255, 255, 255, 0.1);
}

.modal-caption {
    color: white;
    text-align: center;
    margin-top: 15px;
    font-size: 1rem;
    max-width: 80%;
    margin-left: auto;
    margin-right: auto;
    background: rgba(0, 0, 0, 0.5);
    padding: 10px 15px;
    border-radius: 5px;
}

/* GALLERY CONTROLS */
.gallery-controls {
    position: absolute;
    top: 50%;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    transform: translateY(-50%);
    pointer-events: none;
}

.gallery-btn {
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    pointer-events: all;
}

.gallery-btn:hover {
    background: rgba(0, 0, 0, 0.8);
    transform: scale(1.1);
}

.gallery-counter {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    color: white;
    text-align: center;
    font-size: 0.9rem;
    background: rgba(0, 0, 0, 0.5);
    padding: 5px 10px;
    border-radius: 20px;
    display: inline-block;
    width: fit-content;
    margin: 0 auto;
}

/* RESPONSIVE POUR PHOTOS */
@media (max-width: 768px) {
    .photos-preview-container {
        gap: 15px;
        padding: 15px;
        margin: 15px 0;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .photo-preview-item {
        width: 7cm;
        height: 7cm;
        flex-shrink: 0;
        margin-bottom: 15px;
    }
    
    .photo-thumbnail-link {
        width: 7cm;
        height: 7cm;
        border-radius: 12px;
        border: 3px solid #FFD700;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }
    
    .photo-thumbnail-link:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        border-color: #FFA500;
    }
    
    .photo-info {
        font-size: 0.85rem;
        margin-top: 10px;
        line-height: 1.3;
        color: #555;
        text-align: center;
        padding: 0 8px;
        max-width: 7cm;
        word-break: break-word;
    }
    
    .photo-overlay {
        padding: 10px;
        font-size: 0.85rem;
        font-weight: 600;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.85), transparent);
        backdrop-filter: blur(3px);
    }
    
    .gallery-btn {
        width: 45px;
        height: 45px;
        font-size: 22px;
    }
    
    .close-modal {
        top: 20px;
        right: 20px;
        font-size: 32px;
        width: 45px;
        height: 45px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        transition: background 0.3s;
    }
    
    .close-modal:hover {
        background: rgba(0, 0, 0, 0.8);
    }
    
    .modal-caption {
        font-size: 0.95rem;
        max-width: 90%;
        padding: 12px 18px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 8px;
        margin-top: 20px;
    }
    
    .gallery-counter {
        bottom: 25px;
        padding: 6px 12px;
        font-size: 0.95rem;
        background: rgba(0, 0, 0, 0.6);
    }
}
    </style>
</head>
<body>
 <!-- Écran de mot de passe -->
<!-- Écran de mot de passe - VERSION CORRIGÉE -->
<div class="password-screen" id="password-screen">
    <div class="password-content">
        <!-- Photo de profil -->
        <div class="profile-photo-container">
            <a href="https://drive.google.com/file/d/1wOQdg0g9v4PWfiWV-5sFR3aIQW9Szzcq/view" 
               target="_blank" 
               class="profile-photo-link" 
               title="Voir la photo en grand">
                <img src="https://drive.google.com/thumbnail?sz=w600&id=1wOQdg0g9v4PWfiWV-5sFR3aIQW9Szzcq" 
                     alt="Ma photo de profil" 
                     class="profile-photo"
                     onerror="this.onerror=null; this.src='https://via.placeholder.com/400/cccccc/666666?text=Ma+Photo'">
                <div class="profile-overlay">📸 Cliquez pour agrandir</div>
            </a>
            <div class="profile-info">
                <i class="fas fa-user-circle"></i> Mon Journal Intime Personnel
            </div>
        </div>
        
        <div class="password-box">
            <h2><i class="fas fa-lock"></i> Accès Privé</h2>
            <p style="color: #666; margin-bottom: 20px;">Ce journal est protégé par un mot de passe. Veuillez entrer le mot de passe pour continuer.</p>
            <input type="password" class="password-input" id="password-input" placeholder="Entrez le mot de passe...">
            <button class="password-btn" id="password-btn">
                <i class="fas fa-unlock"></i> Accéder au journal
            </button>
            <div class="password-error" id="password-error">
                Mot de passe incorrect. Veuillez réessayer.
            </div>
        </div>
        
        <!-- Indicateur de défilement pour les petits écrans -->
        <div class="scroll-indicator" style="margin-top: 30px; color: white; font-size: 0.8rem; opacity: 0.7;">
            <i class="fas fa-chevron-down"></i> Faites défiler vers le bas si nécessaire
        </div>
    </div>
</div>    
    <!-- Barre de recherche flottante -->
    <div class="search-container">
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Rechercher dans le journal...">
            <button class="search-btn" id="search-button">
                <i class="fas fa-search"></i>
            </button>
            <div class="suggestions-dropdown" id="suggestions-dropdown"></div>
        </div>
        <div class="search-results" id="search-results">
            <div class="results-header">
                <h3><i class="fas fa-search"></i> Résultats de recherche</h3>
                <button class="close-results" id="close-results"><i class="fas fa-times"></i></button>
            </div>
            <div class="results-list" id="results-list"></div>
        </div>
    </div>
    
    <!-- Bouton pour remonter en haut de la fiche - À GAUCHE -->
    <button class="back-to-top-btn" id="back-to-top-btn" title="Remonter en haut">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <div class="container">
        <header>
    <div class="header-content">
        <!-- Photo à gauche -->
        <div class="header-photo">
            <img src="https://drive.google.com/thumbnail?id=1ZiGtik9b0BgidR_k-YLuZj_ZarUd8-Y1&sz=w400" 
                 alt="Ma photo" 
                 class="profile-photo-header"
                 onerror="this.src='https://via.placeholder.com/150/cccccc/666666?text=Photo'">
        </div>
        
        <!-- Titre à droite -->
        <div class="header-text">
            <h1><i class="fas fa-book-open"></i> Mon Journal Intime</h1>
            <p class="subtitle">Feuilleter les pages de ma vie, jour après jour</p>
        </div>
    </div>
</header>
        
        <div class="main-content">
            <section class="calendar-section">
                <h2><i class="fas fa-calendar-alt"></i> Calendrier</h2>
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="nav-btn prev-month" title="Mois précédent"><i class="fas fa-chevron-left"></i></button>
                        <div class="month-year">Mois 2023</div>
                        <button class="nav-btn next-month" title="Mois suivant"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    
                    <div class="weekdays">
                        <div>Lun</div>
                        <div>Mar</div>
                        <div>Mer</div>
                        <div>Jeu</div>
                        <div>Ven</div>
                        <div>Sam</div>
                        <div>Dim</div>
                    </div>
                    
                    <div class="days" id="calendar-days">
                        <!-- Les jours seront générés dynamiquement -->
                    </div>
                </div>
                
                <div class="stats" id="calendar-stats">
                    <div><span>0</span> entrées chargées</div>
                    <div><span id="current-month-count">0</span> entrées ce mois-ci</div>
                    <div><span id="menstruation-count">0</span> jours de menstruation</div>
                </div>
                
                <div class="data-source">
                    Données extraites de <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vSF_dbIjWquw8oPlVTm7c8qR5FX2EBBuIqMjhBkNj51SS6KnoqKZ8ewvn-j8FaxPypaz2vbyDnqd6Lb/pub?output=csv" target="_blank">Google Sheets</a>
                </div>
            </section>
            
            <section class="journal-section">
                <h2><i class="fas fa-book"></i> Entrée du journal</h2>
                <div id="journal-display">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Chargement des données depuis Google Sheets...
                    </div>
                </div>
            </section>
        </div>
    </div>
    <!-- Modal pour aperçu photo -->
    <div id="photoModal" class="photo-modal">
        <button class="close-modal">&times;</button>
        <div class="gallery-controls">
            <button class="gallery-btn prev-btn" id="prevPhotoBtn">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="gallery-btn next-btn" id="nextPhotoBtn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        <div class="modal-content">
            <img class="modal-photo" id="modalPhoto" src="" alt="Photo">
            <div class="modal-caption" id="modalCaption"></div>
            <div class="gallery-counter" id="galleryCounter"></div>
        </div>
    </div>
    <script>
        // Vérification du mot de passe
        const PASSWORD = "rantou02";
        const passwordScreen = document.getElementById('password-screen');
        const passwordInput = document.getElementById('password-input');
        const passwordBtn = document.getElementById('password-btn');
        const passwordError = document.getElementById('password-error');
        
        function checkPassword() {
            if (passwordInput.value === PASSWORD) {
                passwordScreen.style.display = 'none';
                document.body.style.overflow = 'auto';
                initializeJournal();
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        passwordBtn.addEventListener('click', checkPassword);
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
        
        // Variables globales
        let journalData = [];
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let csvHeaders = [];
        
        // Mise à jour avec le nouveau lien
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSF_dbIjWquw8oPlVTm7c8qR5FX2EBBuIqMjhBkNj51SS6KnoqKZ8ewvn-j8FaxPypaz2vbyDnqd6Lb/pub?output=csv";
        
        // Fonction pour supprimer les accents
        function removeAccents(str) {
            return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }
        
        // Mapping des icônes pour les sections
        const sectionIcons = {
            'SOMMEIL': 'fa-moon',
            'AU MATIN': 'fa-sun',
            'SPIRITUEL': 'fa-pray',
            'ALIMENTATION': 'fa-utensils',
            'TRAVAIL': 'fa-briefcase',
            'ACTIVITE LECTURE': 'fa-book-reader',
            'AUTRES ACTIVITES': 'fa-list-alt',
            'ACTIVITE PHYSIQUE': 'fa-running',
            'ACTIVITE MENAGERE': 'fa-broom',
            'PROGRAMME': 'fa-calendar-check',
            'NY AKO': 'fa-user',
            'FINANCE': 'fa-money-bill-wave',
            'DEPLACEMENT': 'fa-car',
            'LOCALISATION': 'fa-map-marker-alt',
            'RELATION & COMMUNICATION': 'fa-comments',
            'RELATION&COMM': 'fa-comments',
            'PERIODIQUE': 'fa-calendar-day',
            'SANTE ,SOIN,HYGIENE': 'fa-heartbeat',
            'SANTE, SOIN, HYGIENE': 'fa-heartbeat',
            'POIDS ,MENSURATION': 'fa-weight-scale',
            'POIDS & MENSURATION': 'fa-weight-scale',
            'BILAN PERSONNEL DE LA JOURNEE': 'fa-chart-line'
        };
        
        // Normalisation des noms de colonnes pour regrouper les données
        const columnGroups = {
            'au_reveil': /^au\s*reveil\s*\[\d+\]/i,
            'activite_spirituel': /^activit[ée]\s*spirituel\s*\[/i,
            'sujet_priere': /^sujet\s*de\s*pri[èe]re\s*\d+/i,
            'priere_ok': /^pri[èe]re\s*ok\s*\[/i,
            'activite_menagere': /^activit[ée]\s*m[ée]nag[èe]re\s*:/i,
            'monstruation': /^monstruation\s*\[/i
        };
        
        // Dictionnaire pour la menstruation
        const menstruationEmojis = {
            'j+j+1': '📅',
            'douleur': '😣',
            'abondance': '💦',
            'normal': '✅',
            'à la maison': '🏠',
            'chez moi': '🏠',
            'maison': '🏠',
            'dehors': '🚪',
            'extérieur': '🚪',
            'debordement': '⚠️',
            'déborde': '⚠️',
            'serviette hygienique': '🩸',
            'serviette': '🩸',
            'tissus': '🧻',
            'tissue': '🧻',
            'jour': '📅',
            'j+': '📅'
        };
        
        // Emojis pour activités spirituelles
        function getSpiritualEmoji(activityName) {
            const emojis = {
                'Lecture Bible': '📖',
                'Priére perso': '🙏',
                'Ecoute mana': '🎧',
                'Méditation': '🧘',
                'Chant': '🎵',
                'Culte': '⛪',
                'Témoignage': '💬',
                'Étude': '📚',
                'Bible anglais': '📖🇬🇧',
                'Louange': '🙌',
                'Ecoute bible': '🎧📖'
            };
            
            for (const [key, emoji] of Object.entries(emojis)) {
                if (activityName.includes(key)) return emoji;
            }
            
            return '✨';
        }
        
        // Fonction pour normaliser une date
        function normalizeDate(date) {
            return new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        }
        
        function datesAreEqual(date1, date2) {
            const normalized1 = normalizeDate(date1);
            const normalized2 = normalizeDate(date2);
            return normalized1.getTime() === normalized2.getTime();
        }
        
        function getDateKey(date) {
            const normalized = normalizeDate(date);
            return normalized.toISOString().split('T')[0];
        }
        
        // Fonction pour normaliser une clé
        function normalizeKey(key) {
            return key.toLowerCase()
                .replace(/\s+/g, '_')
                .replace(/[^a-z0-9_éèêëàâäôöûüç]/g, '')
                .trim();
        }
        
        // Fonction AMÉLIORÉE pour calculer la durée entre deux heures (supporte h, :, min, etc.)
        function calculateDuration(startTime, endTime) {
            if (!startTime || !endTime) return null;
            
            try {
                const parseTime = (timeStr) => {
                    if (!timeStr) return 0;
                    
                    let time = timeStr.trim().toLowerCase();
                    
                    // Convertir différents formats
                    time = time.replace('h', ':').replace('.', ':');
                    
                    // Gérer les formats comme "5:24" ou "5h24" ou "5h" ou "30min"
                    if (time.includes('min')) {
                        // Format "30min" ou "1h30min"
                        const hoursMatch = time.match(/(\d+)\s*h/);
                        const minsMatch = time.match(/(\d+)\s*min/);
                        
                        let hours = 0;
                        let minutes = 0;
                        
                        if (hoursMatch) hours = parseInt(hoursMatch[1]) || 0;
                        if (minsMatch) minutes = parseInt(minsMatch[1]) || 0;
                        
                        return hours * 60 + minutes;
                    } else if (time.includes(':')) {
                        // Format "5:24" ou "5:30"
                        const parts = time.split(':');
                        const hours = parseInt(parts[0]) || 0;
                        const minutes = parseInt(parts[1]) || 0;
                        
                        return hours * 60 + minutes;
                    } else if (time.includes('h') && !time.includes(':')) {
                        // Format "5h" ou "5h30"
                        const cleanTime = time.replace('h', ':');
                        const parts = cleanTime.split(':');
                        const hours = parseInt(parts[0]) || 0;
                        const minutes = parseInt(parts[1]) || 0;
                        
                        return hours * 60 + minutes;
                    } else {
                        // Format numérique simple "5" (suppose heures)
                        const num = parseInt(time);
                        return !isNaN(num) ? num * 60 : 0;
                    }
                };
                
                const startMinutes = parseTime(startTime);
                const endMinutes = parseTime(endTime);
                
                let diffMinutes = endMinutes - startMinutes;
                
                // Si la différence est négative, on suppose que c'est le lendemain
                if (diffMinutes < 0) {
                    diffMinutes += 24 * 60; // Ajouter 24 heures
                }
                
                // Formater le résultat
                const hours = Math.floor(diffMinutes / 60);
                const minutes = diffMinutes % 60;
                
                if (hours > 0 && minutes > 0) {
                    return `${hours}h${minutes < 10 ? '0' : ''}${minutes}`;
                } else if (hours > 0) {
                    return `${hours}h`;
                } else if (minutes > 0) {
                    return `${minutes}min`;
                }
                
                return null;
            } catch (e) {
                console.error("Erreur calcul durée:", e);
                return null;
            }
        }
        
        // Fonction pour calculer l'heure de fin à partir d'une heure de début et d'une durée
        function calculateEndTime(startTime, duration) {
            if (!startTime || !duration) return null;
            
            try {
                const parseTime = (timeStr) => {
                    if (!timeStr) return 0;
                    
                    let time = timeStr.trim().toLowerCase();
                    time = time.replace('h', ':').replace('.', ':');
                    
                    let [hours, minutes = 0] = time.split(':').map(num => parseInt(num) || 0);
                    
                    return hours * 60 + minutes;
                };
                
                const parseDuration = (durStr) => {
                    const dur = durStr.trim().toLowerCase();
                    let totalMinutes = 0;
                    
                    if (dur.includes('h') && dur.includes('min')) {
                        // Format "1h30min" ou "1h30"
                        const parts = dur.split('h');
                        const hours = parseInt(parts[0]) || 0;
                        totalMinutes = hours * 60;
                        
                        if (parts[1]) {
                            const minPart = parts[1].replace('min', '');
                            const minutes = parseInt(minPart) || 0;
                            totalMinutes += minutes;
                        }
                    } else if (dur.includes('h')) {
                        // Format "1h" ou "1h30"
                        const parts = dur.split('h');
                        const hours = parseInt(parts[0]) || 0;
                        totalMinutes = hours * 60;
                        
                        if (parts[1]) {
                            const minutes = parseInt(parts[1]) || 0;
                            totalMinutes += minutes;
                        }
                    } else if (dur.includes('min')) {
                        // Format "30min"
                        totalMinutes = parseInt(dur.replace('min', '')) || 0;
                    } else if (dur.includes(':')) {
                        // Format "1:30"
                        const parts = dur.split(':');
                        const hours = parseInt(parts[0]) || 0;
                        const minutes = parseInt(parts[1]) || 0;
                        totalMinutes = hours * 60 + minutes;
                    } else {
                        // Format numérique simple
                        totalMinutes = parseInt(dur) || 0;
                    }
                    
                    return totalMinutes;
                };
                
                const startMinutes = parseTime(startTime);
                const durationMinutes = parseDuration(duration);
                
                const endMinutes = startMinutes + durationMinutes;
                const endHours = Math.floor(endMinutes / 60) % 24;
                const endMins = endMinutes % 60;
                
                return `${endHours}h${endMins < 10 ? '0' : ''}${endMins}`;
            } catch (e) {
                console.error("Erreur calcul heure fin:", e);
                return null;
            }
        }
        
        // Fonction pour formater une heure simple (sans durée)
        function formatSimpleTime(timeStr) {
            if (!timeStr) return '';
            
            let time = timeStr.trim().toLowerCase();
            time = time.replace('h', ':').replace('.', ':');
            
            if (time.includes('-')) {
                return time.replace(':', 'h').replace(':', 'h');
            }
            
            const parts = time.split(':');
            if (parts.length === 2) {
                const hours = parseInt(parts[0]) || 0;
                const minutes = parseInt(parts[1]) || 0;
                return `${hours}h${minutes < 10 ? '0' : ''}${minutes}`;
            } else if (parts.length === 1) {
                const hours = parseInt(parts[0]) || 0;
                return `${hours}h00`;
            }
            
            return timeStr;
        }
        
        // Fonction pour traiter les heures et durées de repas
        function processMealTime(heure, duree) {
            let heureDisplay = '';
            let dureeDisplay = '';
            
            if (heure) {
                if (heure.includes('-')) {
                    const parts = heure.split('-');
                    if (parts.length === 2) {
                        const startTime = formatSimpleTime(parts[0]);
                        const endTime = formatSimpleTime(parts[1]);
                        heureDisplay = `${startTime}-${endTime}`;
                        
                        const duration = calculateDuration(parts[0], parts[1]);
                        if (duration) {
                            dureeDisplay = duration;
                        }
                    }
                } else {
                    heureDisplay = formatSimpleTime(heure);
                    
                    if (duree && !heure.includes('-')) {
                        const endTime = calculateEndTime(heure, duree);
                        if (endTime) {
                            heureDisplay = `${heureDisplay}-${endTime}`;
                            dureeDisplay = duree;
                        }
                    } else if (duree) {
                        dureeDisplay = duree;
                    }
                }
            }
            
            return { heure: heureDisplay, duree: dureeDisplay };
        }
        
        // Fonction pour calculer la durée de la journée (heure coucher - heure réveil)
        function calculateDayDuration(startTime, endTime) {
            if (!startTime || !endTime) return null;
            
            // Utiliser la fonction améliorée calculateDuration
            return calculateDuration(startTime, endTime);
        }
        // Fonction pour extraire les URLs de photos
function extractPhotoUrls(text) {
    if (!text || typeof text !== 'string') return [];
    
    // Nettoyer le texte
    let cleanText = text.trim();
    cleanText = cleanText.replace(/["']/g, '');
    
    // Expressions régulières pour trouver des URLs
    const urlPatterns = [
        /(https?:\/\/[^\s<>"]+\.(?:jpg|jpeg|png|gif|webp|bmp|JPG|JPEG|PNG|GIF|WEBP|BMP))/gi,
        /(https?:\/\/drive\.google\.com\/[^\s<>"]+)/gi,
        /(https?:\/\/photos\.app\.goo\.gl\/[^\s<>"]+)/gi,
        /(https?:\/\/[^\s<>"]+\.google\.com\/[^\s<>"]+)/gi
    ];
    
    const urls = new Set();
    
    // Chercher avec chaque pattern
    urlPatterns.forEach(pattern => {
        const matches = cleanText.match(pattern);
        if (matches) {
            matches.forEach(url => {
                const cleanUrl = url.replace(/[,\s;]+$/, '').trim();
                if (cleanUrl.length > 10) {
                    urls.add(cleanUrl);
                }
            });
        }
    });
    
    // Chercher les URLs entre parenthèses ou crochets
    const bracketPattern = /\[(https?:\/\/[^\]]+)\]/g;
    let bracketMatch;
    while ((bracketMatch = bracketPattern.exec(cleanText)) !== null) {
        urls.add(bracketMatch[1].trim());
    }
    
    return Array.from(urls);
}

// Fonction pour générer une vignette Google Drive
function generateDriveThumbnail(url) {
    if (!url || typeof url !== 'string') return '';
    
    if (url.includes('drive.google.com')) {
        // Fichier Google Drive
        if (url.includes('/file/d/')) {
            const fileId = url.split('/file/d/')[1].split('/')[0];
            return `https://drive.google.com/thumbnail?sz=w400&id=${fileId}`;
        }
        // Lien direct avec id=
        else if (url.includes('id=')) {
            const fileId = url.split('id=')[1].split('&')[0];
            return `https://drive.google.com/thumbnail?sz=w400&id=${fileId}`;
        }
        // Lien /open?id=
        else if (url.includes('/open?id=')) {
            const fileId = url.split('/open?id=')[1];
            return `https://drive.google.com/thumbnail?sz=w400&id=${fileId}`;
        }
    }
    
    // Pour les autres URLs, utiliser l'URL directe
    return url;
}

// Fonction pour déterminer le type de fichier
function getFileType(url) {
    if (!url) return 'unknown';
    
    const lowerUrl = url.toLowerCase();
    
    if (lowerUrl.includes('drive.google.com')) {
        if (lowerUrl.includes('/folders/')) {
            return 'folder';
        }
        return 'drive';
    }
    
    if (lowerUrl.includes('.jpg') || lowerUrl.includes('.jpeg')) return 'jpg';
    if (lowerUrl.includes('.png')) return 'png';
    if (lowerUrl.includes('.gif')) return 'gif';
    if (lowerUrl.includes('.webp')) return 'webp';
    if (lowerUrl.includes('.bmp')) return 'bmp';
    
    return 'unknown';
}

// Fonction pour générer un aperçu de photo
function generatePhotoPreview(photoUrls) {
    if (!photoUrls || photoUrls.length === 0) return '';
    
    let html = '<div class="photos-preview-container">';
    
    photoUrls.forEach((url, index) => {
        const cleanUrl = url.trim();
        const thumbnailUrl = generateDriveThumbnail(cleanUrl);
        const fileType = getFileType(cleanUrl);
        const fileName = cleanUrl.split('/').pop() || `Photo ${index + 1}`;
        
        // Pour les dossiers Google Drive
        if (fileType === 'folder') {
            html += `
                <div class="photo-preview-item">
                    <a href="${cleanUrl}" target="_blank" class="photo-thumbnail-link" title="Ouvrir le dossier Google Drive">
                        <img src="https://img.icons8.com/color/96/000000/google-drive-folder.png" 
                             alt="Dossier Google Drive" 
                             class="photo-thumbnail"
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/150/4CAF50/ffffff?text=📁'">
                        <div class="photo-overlay">📁 Dossier Drive</div>
                    </a>
                    <div class="photo-info">Dossier ${index + 1}</div>
                </div>
            `;
        }
        // Pour les fichiers images
        else {
            html += `
                <div class="photo-preview-item">
                    <a href="${cleanUrl}" target="_blank" class="photo-thumbnail-link" 
                       data-index="${index}" 
                       data-url="${cleanUrl}"
                       data-thumbnail="${thumbnailUrl}"
                       title="${fileName}">
                        <img src="${thumbnailUrl}" 
                             alt="Photo ${index + 1}" 
                             class="photo-thumbnail"
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/150/cccccc/666666?text=Image'">
                        <div class="photo-overlay">📸 Photo ${index + 1}</div>
                    </a>
                    <div class="photo-info">${fileName.substring(0, 20)}${fileName.length > 20 ? '...' : ''}</div>
                </div>
            `;
        }
    });
    
    html += '</div>';
    
    // Ajouter un message d'information
    html += `<div style="font-size:0.85rem; color:#666; margin-top:10px; display:flex; align-items:center; gap:8px;">
                <i class="fas fa-info-circle"></i>
                <span>${photoUrls.length} photo${photoUrls.length > 1 ? 's' : ''} - Cliquez pour agrandir</span>
            </div>`;
    
    return html;
}
        // Fonction pour extraire les montants financiers
        function extractFinancialAmounts(text) {
            if (!text) return { items: [], total: 0 };
            
            const items = [];
            let total = 0;
            
            const lines = text.split(/[\n,;]/).filter(line => line.trim() !== '');
            
            lines.forEach(line => {
                const cleanLine = line.trim();
                
                const amountMatch = cleanLine.match(/(\d+(?:[.,]\d+)?)\s*(?:ar)?$/i);
                if (amountMatch) {
                    const amount = parseFloat(amountMatch[1].replace(',', '.'));
                    if (!isNaN(amount)) {
                        const description = cleanLine.replace(amountMatch[0], '').trim();
                        items.push({
                            description: description || cleanLine,
                            amount: amount,
                            rawLine: cleanLine
                        });
                        total += amount;
                    }
                } else {
                    const anywhereMatch = cleanLine.match(/(\d+(?:[.,]\d+)?)/);
                    if (anywhereMatch) {
                        const amount = parseFloat(anywhereMatch[1].replace(',', '.'));
                        if (!isNaN(amount)) {
                            items.push({
                                description: cleanLine,
                                amount: amount,
                                rawLine: cleanLine
                            });
                            total += amount;
                        } else {
                            items.push({
                                description: cleanLine,
                                amount: 0,
                                rawLine: cleanLine
                            });
                        }
                    } else {
                        items.push({
                            description: cleanLine,
                            amount: 0,
                            rawLine: cleanLine
                        });
                    }
                }
            });
            
            return { items, total };
        }
        
        // Fonction pour formater un montant
        function formatAmount(amount) {
            if (typeof amount !== 'number' || isNaN(amount)) return '0 ar';
            
            return amount.toLocaleString('fr-FR', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }) + ' ar';
        }
        
        // Fonction pour créer des étoiles de qualité de sommeil ou fatigue
        function createStars(value) {
            if (!value) return '';
            
            const qualityNum = parseInt(value);
            if (isNaN(qualityNum) || qualityNum < 1 || qualityNum > 5) return value;
            
            let starsHTML = '<div class="stars-container">';
            
            for (let i = 1; i <= 5; i++) {
                if (i <= qualityNum) {
                    starsHTML += '<span class="star filled">★</span>';
                } else {
                    starsHTML += '<span class="star">☆</span>';
                }
            }
            
            starsHTML += '</div>';
            return starsHTML;
        }
        
        // Fonction pour extraire le temps d'une activité spirituelle
        function extractSpiritualTime(value) {
            if (!value) return '';
            
            const timeMatch = value.match(/(\d{1,2}[:.]?\d{0,2}\s*(h|min|sec)?)/i);
            if (timeMatch) {
                const time = timeMatch[0];
                return `<span class="spiritual-time">${time}</span>`;
            }
            
            return '';
        }
        
        // Fonction pour extraire le temps d'une tâche ménagère
        function extractMenagereTime(value) {
            if (!value) return '';
            
            const timeMatch = value.match(/(\d+)\s*(min|minutes|m|h|heures|hr|hour)/i);
            if (timeMatch) {
                const amount = timeMatch[1];
                const unit = timeMatch[2].toLowerCase();
                
                if (unit === 'h' || unit === 'heures' || unit === 'hr' || unit === 'hour') {
                    return `<span class="menagere-time"><i class="fas fa-clock-o"></i> ${amount}h</span>`;
                } else {
                    return `<span class="menagere-time"><i class="fas fa-clock-o"></i> ${amount}min</span>`;
                }
            }
            
            return '';
        }
        
        // FONCTION POUR CALCULER L'EAU BUE
        function calculateWaterDrunk(value) {
            if (!value) return { lastValue: null, totalLiters: null, display: '' };
            
            // Chercher les motifs comme "0.33 1", "0.33 2", etc.
            const pattern = /(\d+(?:\.\d+)?)\s+(\d+)/g;
            const matches = [...value.matchAll(pattern)];
            
            if (matches.length === 0) {
                return { lastValue: null, totalLiters: null, display: value };
            }
            
            // Prendre la dernière valeur
            const lastMatch = matches[matches.length - 1];
            const quantity = parseFloat(lastMatch[1]);
            const count = parseInt(lastMatch[2]);
            
            if (isNaN(quantity) || isNaN(count)) {
                return { lastValue: null, totalLiters: null, display: value };
            }
            
            const totalLiters = quantity * count;
            
            return {
                lastValue: `${quantity} ${count}`,
                totalLiters: totalLiters,
                display: `${value}<div class="eau-bue-calculation">Dernière valeur: <span class="eau-bue-result">${quantity} ${count}</span> | Total bu: <span class="eau-bue-result">${totalLiters.toFixed(2)}L</span></div>`
            };
        }
        
        // FONCTION POUR AJOUTER LES UNITÉS AUTOMATIQUEMENT
        function addUnits(value, fieldName) {
            if (!value) return '';
            
            let val = value.trim();
            
            // Si la valeur contient déjà une unité, ne rien ajouter
            if (/\d+\s*(kg|g|cm|mm|m|l|ml|ar)$/i.test(val)) {
                return val;
            }
            
            // Pour le poids
            if (fieldName.includes('poids') || fieldName.includes('Poids')) {
                if (/^\d+(\.\d+)?$/.test(val)) {
                    return val + 'kg';
                }
            }
            
            // Pour les mensurations
            if (fieldName.includes('tour') || fieldName.includes('Tour') || 
                fieldName.includes('mensuration') || fieldName.includes('Mensuration')) {
                if (/^\d+(\.\d+)?$/.test(val)) {
                    return val + 'cm';
                }
            }
            
            return val;
        }
        
        // Fonction pour charger les données depuis Google Sheets
        async function loadJournalData() {
            try {
                showLoading(true);
                
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const encodedSheetUrl = encodeURIComponent(sheetUrl);
                
                const response = await fetch(proxyUrl + encodedSheetUrl, {
                    headers: {
                        'Accept': 'text/csv'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const csvText = await response.text();
                
                if (!csvText || csvText.trim() === '') {
                    throw new Error("Le fichier CSV est vide");
                }
                
                console.log("Texte CSV brut (premiers 500 caractères):", csvText.substring(0, 500));
                
                const { headers, rows } = parseCSV(csvText);
                
                if (rows.length === 0) {
                    throw new Error("Aucune donnée trouvée dans le fichier CSV");
                }
                
                csvHeaders = headers;
                
                console.log("En-têtes CSV:", headers);
                console.log("Nombre de lignes:", rows.length);
                
                for (let i = 0; i < rows.length; i++) {
                    try {
                        const row = rows[i];
                        
                        let dateStr = '';
                        let dateColIndex = -1;
                        
                        for (let j = 0; j < headers.length; j++) {
                            if (headers[j].trim() === "Date") {
                                dateStr = row[j] || '';
                                dateColIndex = j;
                                break;
                            }
                        }
                        
                        if (dateColIndex === -1) {
                            const dateColNames = ['date', 'jour', 'timestamp', 'time', 'datetime'];
                            for (let j = 0; j < headers.length; j++) {
                                const headerLower = headers[j].toLowerCase();
                                if (dateColNames.some(name => headerLower.includes(name))) {
                                    dateStr = row[j] || '';
                                    dateColIndex = j;
                                    break;
                                }
                            }
                        }
                        
                        if (dateColIndex === -1 && row.length > 0) {
                            dateStr = row[0] || '';
                            dateColIndex = 0;
                        }
                        
                        console.log(`Ligne ${i+1}: dateStr = "${dateStr}"`);
                        
                        let date = parseDate(dateStr);
                        
                        if (date) {
                            const entry = { 
                                date: normalizeDate(date),
                                rawData: {},
                                groupedData: {}
                            };
                            
                            for (let j = 0; j < headers.length; j++) {
                                const header = headers[j].trim();
                                const value = j < row.length ? row[j] || '' : '';
                                
                                const key = normalizeKey(header);
                                
                                if (value !== '' && value.trim() !== '') {
                                    // Appliquer l'ajout d'unités automatique
                                    const processedValue = addUnits(value.trim(), header);
                                    entry.rawData[key] = processedValue;
                                    
                                    let grouped = false;
                                    for (const [groupName, pattern] of Object.entries(columnGroups)) {
                                        if (pattern.test(header)) {
                                            if (!entry.groupedData[groupName]) {
                                                entry.groupedData[groupName] = [];
                                            }
                                            entry.groupedData[groupName].push({
                                                key: key,
                                                header: header,
                                                value: processedValue
                                            });
                                            grouped = true;
                                            break;
                                        }
                                    }
                                    
                                    if (!grouped && j !== dateColIndex) {
                                        if (!entry.groupedData.other) {
                                            entry.groupedData.other = [];
                                        }
                                        entry.groupedData.other.push({
                                            key: key,
                                            header: header,
                                            value: processedValue
                                        });
                                    }
                                }
                            }
                            
                            journalData.push(entry);
                            console.log(`Entrée ajoutée pour la date: ${date.toLocaleDateString()}`);
                        } else {
                            console.warn(`Date non reconnue à la ligne ${i+1}: "${dateStr}"`);
                        }
                    } catch (rowError) {
                        console.warn(`Erreur sur la ligne ${i+1}:`, rowError);
                    }
                }
                
                console.log(`Données chargées: ${journalData.length} entrées`);
                
                updateStats();
                initCalendar();
                buildSearchIndex();
                
                if (journalData.length > 0) {
                    const normalizedCurrentDate = normalizeDate(currentDate);
                    showEntryForDate(normalizedCurrentDate);
                } else {
                    showNoDataMessage();
                }
                
            } catch (error) {
                console.error('Erreur lors du chargement des données:', error);
                
                const journalDisplay = document.getElementById('journal-display');
                journalDisplay.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Préparation de l'interface...
                    </div>
                `;
                
                setTimeout(() => {
                    showNoDataMessage();
                }, 1000);
                
            } finally {
                showLoading(false);
            }
        }
        
        // Parseur CSV
        function parseCSV(csvText) {
            const lines = [];
            let currentLine = [];
            let currentValue = '';
            let inQuotes = false;
            
            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                const nextChar = i + 1 < csvText.length ? csvText[i + 1] : '';
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        currentValue += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentLine.push(currentValue);
                    currentValue = '';
                } else if (char === '\n' && !inQuotes) {
                    currentLine.push(currentValue);
                    lines.push(currentLine);
                    currentLine = [];
                    currentValue = '';
                } else if (char === '\r' && nextChar === '\n' && !inQuotes) {
                    currentLine.push(currentValue);
                    lines.push(currentLine);
                    currentLine = [];
                    currentValue = '';
                    i++;
                } else {
                    currentValue += char;
                }
            }
            
            if (currentValue !== '' || currentLine.length > 0) {
                currentLine.push(currentValue);
                lines.push(currentLine);
            }
            
            const headers = lines.length > 0 ? lines[0].map(h => h.trim()) : [];
            const rows = lines.length > 1 ? lines.slice(1) : [];
            
            return { headers: headers, rows: rows };
        }
        
        // Parser de date
        function parseDate(dateStr) {
            if (!dateStr || dateStr.trim() === '') {
                return null;
            }
            
            const cleanDateStr = dateStr.trim().replace(/"/g, '');
            
            let date = null;
            
            let match = cleanDateStr.match(/^(\d{1,2})[/-](\d{1,2})[/-](\d{4})$/);
            if (match) {
                const day = parseInt(match[1], 10);
                const month = parseInt(match[2], 10) - 1;
                const year = parseInt(match[3], 10);
                date = new Date(year, month, day);
            }
            
            if (!date) {
                match = cleanDateStr.match(/^(\d{4})[/-](\d{1,2})[/-](\d{1,2})$/);
                if (match) {
                    const year = parseInt(match[1], 10);
                    const month = parseInt(match[2], 10) - 1;
                    const day = parseInt(match[3], 10);
                    date = new Date(year, month, day);
                }
            }
            
            if (!date) {
                match = cleanDateStr.match(/^(\d{1,2})\s+(\w+)\s+(\d{4})$/);
                if (match) {
                    const day = parseInt(match[1], 10);
                    const monthNames = {
                        'janvier': 0, 'février': 1, 'fevrier': 1, 'mars': 2, 'avril': 3,
                        'mai': 4, 'juin': 5, 'juillet': 6, 'août': 7, 'aout': 7,
                        'septembre': 8, 'octobre': 9, 'novembre': 10, 'décembre': 11, 'decembre': 11
                    };
                    const monthName = match[2].toLowerCase();
                    const month = monthNames[monthName];
                    const year = parseInt(match[3], 10);
                    
                    if (month !== undefined) {
                        date = new Date(year, month, day);
                    }
                }
            }
            
            if (!date) {
                date = new Date(cleanDateStr);
                if (isNaN(date.getTime())) {
                    date = null;
                }
            }
            
            return date;
        }
        
        // Afficher une entrée de journal
        function showEntryForDate(date) {
            const normalizedDate = normalizeDate(date);
            const entry = journalData.find(e => datesAreEqual(e.date, normalizedDate));
            
            const journalDisplay = document.getElementById('journal-display');
            
            if (entry && entry.rawData) {
                console.log("Données disponibles pour cette date:", entry.rawData);
                
                // Calcul des durées automatiques
                const heureReveil = entry.rawData[normalizeKey("Heure de réveil")];
                const heureCoucher = entry.rawData[normalizeKey("Heure de coucher")];
                const dernierRepasVeille = entry.rawData[normalizeKey("Dernier repas de la veille")];
                const heurePetitDej = entry.rawData[normalizeKey("Heure Petit déjeuner")];
                
                // Calcul durée activité au lit
                let dureeActiviteLit = null;
                const heureLever = entry.rawData[normalizeKey("Heure de lever")];
                if (heureReveil && heureLever) {
                    dureeActiviteLit = calculateDuration(heureReveil, heureLever);
                }
                
                // Calcul durée jeûne
                let dureeJeune = null;
                if (dernierRepasVeille && heurePetitDej) {
                    dureeJeune = calculateDuration(dernierRepasVeille, heurePetitDej);
                }
                
                // Calcul durée journée (heure coucher - heure réveil)
                let dureeJournee = null;
                if (heureReveil && heureCoucher) {
                    dureeJournee = calculateDayDuration(heureReveil, heureCoucher);
                }
                
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const formattedDate = entry.date.toLocaleDateString('fr-FR', options);
                
                // Navigation interne - boutons de section
                const sectionButtons = `
                    <div class="section-nav">
                        <button class="section-nav-btn" data-section="sommeil" style="--color1: #9c27b0; --color2: #ce93d8;"><i class="fas fa-moon"></i> Sommeil</button>
                        <button class="section-nav-btn" data-section="matin" style="--color1: #ff9800; --color2: #ffb74d;"><i class="fas fa-sun"></i> Matin</button>
                        <button class="section-nav-btn" data-section="spirituel" style="--color1: #2196f3; --color2: #64b5f6;"><i class="fas fa-pray"></i> Spirituel</button>
                        <button class="section-nav-btn" data-section="alimentation" style="--color1: #f44336; --color2: #ef9a9a;"><i class="fas fa-utensils"></i> Alimentation</button>
                        <button class="section-nav-btn" data-section="travail" style="--color1: #4caf50; --color2: #81c784;"><i class="fas fa-briefcase"></i> Travail</button>
                        <button class="section-nav-btn" data-section="lecture" style="--color1: #795548; --color2: #a1887f;"><i class="fas fa-book-reader"></i> Lecture</button>
                        <button class="section-nav-btn" data-section="activites" style="--color1: #ffc107; --color2: #ffd54f;"><i class="fas fa-list-alt"></i> Activités</button>
                        <button class="section-nav-btn" data-section="physique" style="--color1: #009688; --color2: #4db6ac;"><i class="fas fa-running"></i> Physique</button>
                        <button class="section-nav-btn" data-section="menagere" style="--color1: #9c27b0; --color2: #ce93d8;"><i class="fas fa-broom"></i> Ménager</button>
                        <button class="section-nav-btn" data-section="programme" style="--color1: #ff5722; --color2: #ff8a65;"><i class="fas fa-calendar-check"></i> Programme</button>
                        <button class="section-nav-btn" data-section="nyako" style="--color1: #673ab7; --color2: #9575cd;"><i class="fas fa-user"></i> Ny Ako</button>
                        <button class="section-nav-btn" data-section="finance" style="--color1: #8bc34a; --color2: #aed581;"><i class="fas fa-money-bill-wave"></i> Finance</button>
                        <button class="section-nav-btn" data-section="deplacement" style="--color1: #00bcd4; --color2: #4dd0e1;"><i class="fas fa-car"></i> Déplacement</button>
                        <button class="section-nav-btn" data-section="relation" style="--color1: #ff4081; --color2: #f8bbd9;"><i class="fas fa-comments"></i> Relation</button>
                        <button class="section-nav-btn" data-section="periodique" style="--color1: #e91e63; --color2: #f48fb1;"><i class="fas fa-calendar-day"></i> Périodique</button>
                        <button class="section-nav-btn" data-section="sante" style="--color1: #4caf50; --color2: #81c784;"><i class="fas fa-heartbeat"></i> Santé</button>
                        <button class="section-nav-btn" data-section="poids" style="--color1: #ff9800; --color2: #ffb74d;"><i class="fas fa-weight-scale"></i> Poids</button>
                        <button class="section-nav-btn" data-section="bilan" style="--color1: #2196f3; --color2: #64b5f6;"><i class="fas fa-chart-line"></i> Bilan</button>
                    </div>
                `;
                
                let entryHTML = '<div class="journal-entry" id="journal-entry-top">';
                entryHTML += `<div class="entry-header">`;
                entryHTML += `<div class="entry-date">${formattedDate}</div>`;
                entryHTML += `</div>`;
                entryHTML += '<div class="entry-content">';
                
                // Navigation interne au début
                entryHTML += sectionButtons;
                
                // SECTION: SOMMEIL
                entryHTML += `<div class="section-sommeil" id="section-sommeil">`;
                entryHTML += `<div class="section-title"><i class="fas fa-moon"></i> SOMMEIL</div>`;
                entryHTML += `<div class="section-decoration decoration-sommeil"><i class="fas fa-moon"></i></div>`;
                
                entryHTML += `<div class="compact-row-sommeil">`;
                
                // Heure de réveil
                const reveilKey = normalizeKey("Heure de réveil");
                if (entry.rawData[reveilKey]) {
                    entryHTML += `<div class="compact-item-sommeil">
                        <div class="compact-label-sommeil"><i class="fas fa-sun"></i> Réveil</div>
                        <div class="compact-value-sommeil time-value">${entry.rawData[reveilKey]}</div>
                    </div>`;
                } else {
                    entryHTML += `<div class="compact-item-sommeil">
                        <div class="compact-label-sommeil"><i class="fas fa-sun"></i> Réveil</div>
                        <div class="compact-value-sommeil"></div>
                    </div>`;
                }
                
                // Heure de coucher
                const coucherKey = normalizeKey("Heure de coucher");
                if (entry.rawData[coucherKey]) {
                    entryHTML += `<div class="compact-item-sommeil">
                        <div class="compact-label-sommeil"><i class="fas fa-moon"></i> Coucher</div>
                        <div class="compact-value-sommeil time-value">${entry.rawData[coucherKey]}</div>
                    </div>`;
                } else {
                    entryHTML += `<div class="compact-item-sommeil">
                        <div class="compact-label-sommeil"><i class="fas fa-moon"></i> Coucher</div>
                        <div class="compact-value-sommeil"></div>
                    </div>`;
                }
                
                // Qualité de sommeil
                const qualiteSommeilKey = normalizeKey("Qualité de sommeil la veille");
                if (entry.rawData[qualiteSommeilKey]) {
                    const sleepStars = createStars(entry.rawData[qualiteSommeilKey]);
                    entryHTML += `<div class="compact-item-sommeil">
                        <div class="compact-label-sommeil"><i class="fas fa-bed"></i> Qualité</div>
                        <div class="compact-value-sommeil">${sleepStars || entry.rawData[qualiteSommeilKey]}</div>
                    </div>`;
                } else {
                    entryHTML += `<div class="compact-item-sommeil">
                        <div class="compact-label-sommeil"><i class="fas fa-bed"></i> Qualité</div>
                        <div class="compact-value-sommeil"></div>
                    </div>`;
                }
                
                entryHTML += `</div>`;
                
                // Nuit la veille
                const nuitKey = normalizeKey("Nuit la veille");
                if (entry.rawData[nuitKey]) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-star"></i> Nuit la veille</div>
                        <div class="entry-value">${entry.rawData[nuitKey]}</div>
                    </div>`;
                }
                
                // Rêve la veille
                const reveKey = normalizeKey("Rêve la veille");
                if (entry.rawData[reveKey]) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-cloud-moon"></i> Rêve la veille</div>
                        <div class="entry-value">${entry.rawData[reveKey]}</div>
                    </div>`;
                }
                
                // Durée totale activité au lit (calculée automatiquement)
                if (dureeActiviteLit) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-clock"></i> Durée activité au lit</div>
                        <div class="entry-value duration-value">${dureeActiviteLit}</div>
                    </div>`;
                }
                
                entryHTML += `</div>`;
                
                // SECTION: AU MATIN avec durée journée
                entryHTML += `<div class="section-matin" id="section-matin">`;
                entryHTML += `<div class="section-title"><i class="fas fa-sun"></i> AU MATIN</div>`;
                entryHTML += `<div class="section-decoration decoration-matin"><i class="fas fa-sun"></i></div>`;
                
                if (entry.groupedData.au_reveil && entry.groupedData.au_reveil.length > 0) {                    
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-list-ol"></i> Au réveil</div>
                        <div class="entry-value">`;
                    
                    const auReveilItems = entry.groupedData.au_reveil
                        .filter(item => item.value && item.value.trim() !== '')
                        .sort((a, b) => {
                            const numA = parseInt(a.header.match(/\[(\d+)\]/)?.[1] || 0);
                            const numB = parseInt(b.header.match(/\[(\d+)\]/)?.[1] || 0);
                            return numA - numB;
                        });
                    
                    auReveilItems.forEach((item, index) => {
                        entryHTML += `<div class="aureveil-item">${index + 1}- ${item.value}</div>`;
                    });
                    
                    entryHTML += `</div></div>`;
                }
                
                // Déroulement au lit
                const deroulementLitKey = normalizeKey("Déroulement au lit");
                if (entry.rawData[deroulementLitKey]) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-bed"></i> Déroulement au lit</div>
                        <div class="entry-value">${entry.rawData[deroulementLitKey]}</div>
                    </div>`;
                }
                
                // Heure de lever
                const heureLeverKey = normalizeKey("Heure de lever");
                if (entry.rawData[heureLeverKey]) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-user-clock"></i> Heure lever</div>
                        <div class="entry-value time-value">${entry.rawData[heureLeverKey]}</div>
                    </div>`;
                }
                
                // Durée journée (calculée)
                if (dureeJournee) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-clock"></i> Durée journée</div>
                        <div class="entry-value duration-value">${dureeJournee}</div>
                    </div>`;
                }
                
                // Mis au point
                const misAuPointKey = normalizeKey("Mis au point");
                if (entry.rawData[misAuPointKey]) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-tasks"></i> Mis au point</div>
                        <div class="entry-value">${entry.rawData[misAuPointKey]}</div>
                    </div>`;
                }
                
                // Objectif du jour
                const objectifKey = normalizeKey("Objectif du jour");
                if (entry.rawData[objectifKey]) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-bullseye"></i> Objectif du jour</div>
                        <div class="entry-value">${entry.rawData[objectifKey]}</div>
                    </div>`;
                }
                
                entryHTML += `</div>`;
                
                // SECTION: SPIRITUEL
                const hasSpiritualData = (entry.groupedData.activite_spirituel && entry.groupedData.activite_spirituel.length > 0) ||
                    entry.rawData[normalizeKey("Texte medité")] ||
                    entry.rawData[normalizeKey("Ce que j'ai retenu aujourd'hui dans la méditation")] ||
                    entry.groupedData.sujet_priere;
                
                if (hasSpiritualData) {
                    entryHTML += `<div class="section-spirituel" id="section-spirituel">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-pray"></i> SPIRITUEL</div>`;
                    entryHTML += `<div class="section-decoration decoration-spirituel"><i class="fas fa-pray"></i></div>`;
                    
                    // Activités spirituelles
                    if (entry.groupedData.activite_spirituel && entry.groupedData.activite_spirituel.length > 0) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-spa"></i> Activités spirituelles</div>
                            <div class="entry-value">`;
                        
                        entry.groupedData.activite_spirituel.forEach((item, index) => {
                            if (item.value && item.value.trim() !== '') {
                                const match = item.header.match(/\[([^\]]+)\]/);
                                const activityName = match ? match[1] : `Activité ${index + 1}`;
                                const emoji = getSpiritualEmoji(activityName);
                                
                                const timeHtml = extractSpiritualTime(item.value);
                                
                                entryHTML += `<div class="spiritual-item">
                                    <span>${emoji} ${activityName}</span>
                                    ${timeHtml}
                                </div>`;
                            }
                        });
                        
                        entryHTML += `</div></div>`;
                    }
                    
                    // Fampianarana biblique du jour
                    const fampianaranaKey = normalizeKey("Fampianarana biblique du jour");
                    if (entry.rawData[fampianaranaKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-church"></i> Fampianarana biblique</div>
                            <div class="entry-value">${formatValue(entry.rawData[fampianaranaKey])}</div>
                        </div>`;
                    }
                    
                    // Autres méditation du jour
                    const autresMeditationKey = normalizeKey("Autres méditation du jour");
                    if (entry.rawData[autresMeditationKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-brain-circuit"></i> Autres méditation</div>
                            <div class="entry-value">${formatValue(entry.rawData[autresMeditationKey])}</div>
                        </div>`;
                    }
                    
                    // Leçon spirituelle du jour
                    const leconSpirituelleKey = normalizeKey("Leçon spirituelle du jour");
                    if (entry.rawData[leconSpirituelleKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-graduation-cap"></i> Leçon spirituelle</div>
                            <div class="entry-value">${formatValue(entry.rawData[leconSpirituelleKey])}</div>
                        </div>`;
                    }
                    
                    // Sujets de prière
                    if (entry.groupedData.sujet_priere && entry.groupedData.sujet_priere.length > 0) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-hands-praying"></i> Sujets de prière</div>
                            <div class="entry-value">`;
                        
                        const sujets = entry.groupedData.sujet_priere
                            .filter(item => item.value && item.value.trim() !== '')
                            .sort((a, b) => {
                                const numA = parseInt(a.header.match(/\d+/)?.[0] || 0);
                                const numB = parseInt(b.header.match(/\d+/)?.[0] || 0);
                                return numA - numB;
                            });
                        
                        sujets.forEach((item, index) => {
                            const sujetNum = item.header.match(/\d+/)?.[0] || (index + 1);
                            let statusIcon = '';
                            
                            const statusKey = normalizeKey(`Prière OK [Sujet ${sujetNum}]`);
                            if (entry.rawData[statusKey]) {
                                const status = entry.rawData[statusKey].toLowerCase();
                                if (status === 'oui') {
                                    statusIcon = '<span class="prayer-status prayer-ok">✓</span>';
                                } else if (status === 'non') {
                                    statusIcon = '<span class="prayer-status prayer-no">✗</span>';
                                } else {
                                    statusIcon = '<span class="prayer-status prayer-inprogress">…</span>';
                                }
                            }
                            
                            entryHTML += `${index + 1}- ${formatValue(item.value)} ${statusIcon}<br>`;
                        });
                        
                        entryHTML += `</div></div>`;
                    }
                    
                    // Sujet de Louange,reconnaissance
                    const louangeKey = normalizeKey("Sujet de Louange,reconnaissance");
                    if (entry.rawData[louangeKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-hands"></i> Sujet de louange</div>
                            <div class="entry-value">${formatValue(entry.rawData[louangeKey])}</div>
                        </div>`;
                    }
                    
                    // Intercession
                    const intercessionKey = normalizeKey("Intercession");
                    if (entry.rawData[intercessionKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-comment-medical"></i> Intercession</div>
                            <div class="entry-value">${formatValue(entry.rawData[intercessionKey])}</div>
                        </div>`;
                    }
                    
                    // Détails intercession
                    const detailsIntercessionKey = normalizeKey("Détails intercession");
                    if (entry.rawData[detailsIntercessionKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails intercession</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsIntercessionKey])}</div>
                        </div>`;
                    }
                    
                    // Champs spirituels individuels
                    const spiritualFields = [
                        {key: "Texte medité", label: "Texte médité", icon: "fa-book-bible", class: "texte-medite"},
                        {key: "Ce que j'ai retenu aujourd'hui dans la méditation", label: "Retenu de la méditation", icon: "fa-graduation-cap", class: "retenu-meditation"},
                        {key: "Résolution du jour/décision", label: "Résolution du jour", icon: "fa-flag"},
                        {key: "Partage spirituel", label: "Partage spirituel", icon: "fa-comments"}
                    ];
                    
                    spiritualFields.forEach(field => {
                        const fieldKey = normalizeKey(field.key);
                        if (entry.rawData[fieldKey]) {
                            const valueClass = field.class || (field.key.includes("Résolution") ? "resolution-du-jour" : "");
                            entryHTML += `<div class="entry-row">
                                <div class="entry-label"><i class="fas ${field.icon}"></i> ${field.label}</div>
                                <div class="entry-value ${valueClass}">${formatValue(entry.rawData[fieldKey])}</div>
                            </div>`;
                        }
                    });
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: ALIMENTATION avec modifications
                const hasFoodData = entry.rawData[normalizeKey("Petit déjeuner")] ||
                    entry.rawData[normalizeKey("Déjeuner")] ||
                    entry.rawData[normalizeKey("Dîner")] ||
                    entry.rawData[normalizeKey("Dernier repas de la veille")];
                
                if (hasFoodData) {
                    entryHTML += `<div class="section-alimentation" id="section-alimentation">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-utensils"></i> ALIMENTATION</div>`;
                    entryHTML += `<div class="section-decoration decoration-alimentation"><i class="fas fa-utensils"></i></div>`;
                    
                    // Dernier repas de la veille
                    const dernierRepasKey = normalizeKey("Dernier repas de la veille");
                    if (entry.rawData[dernierRepasKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-utensils"></i> Dernier repas veille</div>
                            <div class="entry-value">${entry.rawData[dernierRepasKey]}</div>
                        </div>`;
                    }
                    
                    // Durée du jeûne (calculée automatiquement)
                    if (dureeJeune) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-clock"></i> Durée jeûne</div>
                            <div class="entry-value duration-value">${dureeJeune}</div>
                        </div>`;
                    }
                    
                    // Petit déjeuner avec NOUVELLE disposition
                    const heurePetitDejKey = normalizeKey("Heure Petit déjeuner");
                    const lieuPetitDejKey = normalizeKey("Lieu Petit déjeuner");
                    const petitDejKey = normalizeKey("Petit déjeuner");
                    const petitDejAvecKey = normalizeKey("Petit déjeuner avec");
                    const dureePetitDejKey = normalizeKey("Durée petit déjeuner");
                    
                    if (entry.rawData[heurePetitDejKey] || entry.rawData[petitDejKey] || entry.rawData[lieuPetitDejKey]) {
                        entryHTML += `<div class="meal-container">`;
                        entryHTML += `<div class="meal-title"><i class="fas fa-coffee"></i> Petit déjeuner</div>`;
                        
                        // Traiter heure et durée
                        const mealTime1 = processMealTime(
                            entry.rawData[heurePetitDejKey],
                            entry.rawData[dureePetitDejKey]
                        );
                        
                        // Ligne 1: Heure et Durée sur une ligne
                        entryHTML += `<div class="meal-line-single">`;
                        
                        if (mealTime1.heure) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-clock"></i> Heure</div>
                                <div class="meal-compact-value time-value">${mealTime1.heure}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-clock"></i> Heure</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        if (mealTime1.duree) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-stopwatch"></i> Durée</div>
                                <div class="meal-compact-value duration-value">${mealTime1.duree}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-stopwatch"></i> Durée</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                        
                        // Ligne 2: Lieu et Avec sur une ligne
                        entryHTML += `<div class="meal-line-single">`;
                        
                        if (entry.rawData[lieuPetitDejKey]) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-map-marker-alt"></i> Lieu</div>
                                <div class="meal-compact-value">${entry.rawData[lieuPetitDejKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-map-marker-alt"></i> Lieu</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[petitDejAvecKey]) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-users"></i> Avec</div>
                                <div class="meal-compact-value">${entry.rawData[petitDejAvecKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-users"></i> Avec</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                        
                        if (entry.rawData[petitDejKey]) {
                            entryHTML += `<div class="meal-content">
                                <div class="meal-content-label"><i class="fas fa-utensils-alt"></i> Repas</div>
                                <div class="meal-content-value meal-text">${formatValue(entry.rawData[petitDejKey])}</div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Déjeuner avec NOUVELLE disposition
                    const heureDejKey = normalizeKey("Heure Déjeuner");
                    const lieuDejKey = normalizeKey("Lieu déjeuner");
                    const dejKey = normalizeKey("Déjeuner");
                    const dejAvecKey = normalizeKey("Déjeuner avec");
                    const dureeDejKey = normalizeKey("Durée déjeuner");
                    
                    if (entry.rawData[heureDejKey] || entry.rawData[dejKey] || entry.rawData[lieuDejKey]) {
                        entryHTML += `<div class="meal-container">`;
                        entryHTML += `<div class="meal-title"><i class="fas fa-utensil-spoon"></i> Déjeuner</div>`;
                        
                        // Traiter heure et durée
                        const mealTime2 = processMealTime(
                            entry.rawData[heureDejKey],
                            entry.rawData[dureeDejKey]
                        );
                        
                        // Ligne 1: Heure et Durée sur une ligne
                        entryHTML += `<div class="meal-line-single">`;
                        
                        if (mealTime2.heure) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-clock"></i> Heure</div>
                                <div class="meal-compact-value time-value">${mealTime2.heure}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-clock"></i> Heure</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        if (mealTime2.duree) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-stopwatch"></i> Durée</div>
                                <div class="meal-compact-value duration-value">${mealTime2.duree}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-stopwatch"></i> Durée</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                        
                        // Ligne 2: Lieu et Avec sur une ligne
                        entryHTML += `<div class="meal-line-single">`;
                        
                        if (entry.rawData[lieuDejKey]) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-map-marker-alt"></i> Lieu</div>
                                <div class="meal-compact-value">${entry.rawData[lieuDejKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-map-marker-alt"></i> Lieu</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[dejAvecKey]) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-users"></i> Avec</div>
                                <div class="meal-compact-value">${entry.rawData[dejAvecKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-users"></i> Avec</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                        
                        if (entry.rawData[dejKey]) {
                            entryHTML += `<div class="meal-content">
                                <div class="meal-content-label"><i class="fas fa-utensils-alt"></i> Repas</div>
                                <div class="meal-content-value meal-text">${formatValue(entry.rawData[dejKey])}</div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Dîner avec NOUVELLE disposition
                    const heureDinerKey = normalizeKey("Heure Dîner");
                    const lieuDinerKey = normalizeKey("Lieu Dîner");
                    const dinerKey = normalizeKey("Dîner");
                    const dinerAvecKey = normalizeKey("Dîner avec");
                    const dureeDinerKey = normalizeKey("Durée Dîner");
                    
                    if (entry.rawData[heureDinerKey] || entry.rawData[dinerKey] || entry.rawData[lieuDinerKey]) {
                        entryHTML += `<div class="meal-container">`;
                        entryHTML += `<div class="meal-title"><i class="fas fa-dinner"></i> Dîner</div>`;
                        
                        // Traiter heure et durée
                        const mealTime3 = processMealTime(
                            entry.rawData[heureDinerKey],
                            entry.rawData[dureeDinerKey]
                        );
                        
                        // Ligne 1: Heure et Durée sur une ligne
                        entryHTML += `<div class="meal-line-single">`;
                        
                        if (mealTime3.heure) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-clock"></i> Heure</div>
                                <div class="meal-compact-value time-value">${mealTime3.heure}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-clock"></i> Heure</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        if (mealTime3.duree) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-stopwatch"></i> Durée</div>
                                <div class="meal-compact-value duration-value">${mealTime3.duree}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-stopwatch"></i> Durée</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                        
                        // Ligne 2: Lieu et Avec sur une ligne
                        entryHTML += `<div class="meal-line-single">`;
                        
                        if (entry.rawData[lieuDinerKey]) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-map-marker-alt"></i> Lieu</div>
                                <div class="meal-compact-value">${entry.rawData[lieuDinerKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-map-marker-alt"></i> Lieu</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[dinerAvecKey]) {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-users"></i> Avec</div>
                                <div class="meal-compact-value">${entry.rawData[dinerAvecKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="meal-compact-item">
                                <div class="meal-compact-label"><i class="fas fa-users"></i> Avec</div>
                                <div class="meal-compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                        
                        if (entry.rawData[dinerKey]) {
                            entryHTML += `<div class="meal-content">
                                <div class="meal-content-label"><i class="fas fa-utensils-alt"></i> Repas</div>
                                <div class="meal-content-value meal-text">${formatValue(entry.rawData[dinerKey])}</div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Collations AM et PM
                    const collationAMKey = normalizeKey("Collation AM");
                    const collationPMKey = normalizeKey("Collation PM");
                    const collationAvecKey = normalizeKey("Collation avec");
                    
                    if (entry.rawData[collationAMKey] || entry.rawData[collationPMKey]) {
                        entryHTML += `<div class="collation-section">`;
                        entryHTML += `<div class="collation-title"><i class="fas fa-apple-alt"></i> COLLATIONS</div>`;
                        
                        if (entry.rawData[collationAvecKey]) {
                            entryHTML += `<div class="entry-row">
                                <div class="entry-label"><i class="fas fa-users"></i> Avec</div>
                                <div class="entry-value">${entry.rawData[collationAvecKey]}</div>
                            </div>`;
                        }
                        
                        if (entry.rawData[collationAMKey]) {
                            entryHTML += `<div class="entry-row">
                                <div class="entry-label"><i class="fas fa-sun"></i> Collation AM</div>
                                <div class="entry-value">${formatValue(entry.rawData[collationAMKey])}</div>
                            </div>`;
                        }
                        
                        if (entry.rawData[collationPMKey]) {
                            entryHTML += `<div class="entry-row">
                                <div class="entry-label"><i class="fas fa-moon"></i> Collation PM</div>
                                <div class="entry-value">${formatValue(entry.rawData[collationPMKey])}</div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Autres boissons et quantité
                    const autresBoissonKey = normalizeKey("Autres boisson");
                    const qteAutresBoissonKey = normalizeKey("Qté autres boisson");
                    
                    if (entry.rawData[autresBoissonKey] || entry.rawData[qteAutresBoissonKey]) {
                        entryHTML += `<div class="double-row">`;
                        
                        if (entry.rawData[autresBoissonKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-glass"></i> Autres boissons</div>
                                <div class="compact-value">${formatValue(entry.rawData[autresBoissonKey])}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-glass"></i> Autres boissons</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[qteAutresBoissonKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-wine-bottle"></i> Quantité</div>
                                <div class="compact-value">${entry.rawData[qteAutresBoissonKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-wine-bottle"></i> Quantité</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Eau bue avec calcul et dernière valeur seulement
                    const eauBueKey = normalizeKey("Eau bue dans la journee");
                    if (entry.rawData[eauBueKey]) {
                        const waterCalculation = calculateWaterDrunk(entry.rawData[eauBueKey]);
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-tint"></i> Eau bue</div>
                            <div class="entry-value">${waterCalculation.display || formatValue(entry.rawData[eauBueKey])}
                        </div></div>`;
                    }
                    
                    // Autres champs alimentation
                    const foodFields = [
                        {key: "Repas extra", label: "Repas extra", icon: "fa-plus-circle"},
                        {key: "Details Repas extra", label: "Détails repas extra", icon: "fa-info-circle"},
                        {key: "Détails cuisine", label: "Détails cuisine", icon: "fa-clipboard-list"},
                        {key: "Recette à retenir", label: "Recette à retenir", icon: "fa-bookmark"},
                        {key: "Durée cuisine", label: "Durée cuisine", icon: "fa-clock"}
                    ];
                    
                    foodFields.forEach(field => {
                        const fieldKey = normalizeKey(field.key);
                        if (entry.rawData[fieldKey]) {
                            entryHTML += `<div class="entry-row">
                                <div class="entry-label"><i class="fas ${field.icon}"></i> ${field.label}</div>
                                <div class="entry-value">${formatValue(entry.rawData[fieldKey])}</div>
                            </div>`;
                        }
                    });
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: TRAVAIL
                const typeKey = normalizeKey("Type");
                const contenuKey = normalizeKey("Contenu");
                
                if (entry.rawData[typeKey] || entry.rawData[contenuKey]) {
                    entryHTML += `<div class="section-travail" id="section-travail">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-briefcase"></i> TRAVAIL</div>`;
                    entryHTML += `<div class="section-decoration decoration-travail"><i class="fas fa-briefcase"></i></div>`;
                    
                    if (entry.rawData[typeKey]) {
                        entryHTML += `<div class="travail-header">
                            <div class="travail-type">${entry.rawData[typeKey]}</div>
                        </div>`;
                    }
                    
                    // Heure et durée travail
                    const heureTravailKey = normalizeKey("Heure Travail");
                    const dureeTravailKey = normalizeKey("Durée Travail");
                    
                    if (entry.rawData[heureTravailKey] || entry.rawData[dureeTravailKey]) {
                        entryHTML += `<div class="travail-time-container">`;
                        
                        if (entry.rawData[heureTravailKey]) {
                            entryHTML += `<div class="travail-time-card">
                                <div class="compact-label"><i class="fas fa-clock"></i> Heure</div>
                                <div class="compact-value time-value">${entry.rawData[heureTravailKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="travail-time-card">
                                <div class="compact-label"><i class="fas fa-clock"></i> Heure</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[dureeTravailKey]) {
                            entryHTML += `<div class="travail-time-card">
                                <div class="compact-label"><i class="fas fa-hourglass"></i> Durée</div>
                                <div class="compact-value duration-value">${entry.rawData[dureeTravailKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="travail-time-card">
                                <div class="compact-label"><i class="fas fa-hourglass"></i> Durée</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Contenu et à faire periodique
                    const aFaireKey = normalizeKey("A faire periodique");
                    
                    if (entry.rawData[contenuKey] || entry.rawData[aFaireKey]) {
                        entryHTML += `<div class="travail-content-row">`;
                        
                        if (entry.rawData[contenuKey]) {
                            entryHTML += `<div class="travail-content-item">
                                <div class="compact-label"><i class="fas fa-file-alt"></i> Contenu</div>
                                <div class="compact-value">${formatValue(entry.rawData[contenuKey])}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="travail-content-item">
                                <div class="compact-label"><i class="fas fa-file-alt"></i> Contenu</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[aFaireKey]) {
                            entryHTML += `<div class="travail-content-item">
                                <div class="compact-label"><i class="fas fa-tasks"></i> À faire périodique</div>
                                <div class="compact-value">${formatValue(entry.rawData[aFaireKey])}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="travail-content-item">
                                <div class="compact-label"><i class="fas fa-tasks"></i> À faire périodique</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Details Travail
                    const detailsTravailKey = normalizeKey("Details Travail");
                    if (entry.rawData[detailsTravailKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails travail</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsTravailKey])}</div>
                        </div>`;
                    }
                    
                    // Details extra-Travail
                    const detailsExtraTravailKey = normalizeKey("Details extra-Travail");
                    if (entry.rawData[detailsExtraTravailKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-plus-circle"></i> Détails extra-travail</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsExtraTravailKey])}</div>
                        </div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: ACTIVITE LECTURE
                const typeLectureKey = normalizeKey("type de lecture");
                const titreKey = normalizeKey("Titre");
                
                if (entry.rawData[typeLectureKey] || entry.rawData[titreKey]) {
                    entryHTML += `<div class="section-lecture" id="section-lecture">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-book-reader"></i> ACTIVITE LECTURE</div>`;
                    entryHTML += `<div class="section-decoration decoration-lecture"><i class="fas fa-book-reader"></i></div>`;
                    
                    if (entry.rawData[typeLectureKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-book"></i> Type de lecture</div>
                            <div class="entry-value">${entry.rawData[typeLectureKey]}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[titreKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-heading"></i> Titre</div>
                            <div class="entry-value">${entry.rawData[titreKey]}</div>
                        </div>`;
                    }
                    
                    // Détails lecture
                    const detailsLectureKey = normalizeKey("Détails lecture");
                    if (entry.rawData[detailsLectureKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails lecture</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsLectureKey])}</div>
                        </div>`;
                    }
                    
                    // Leçons reçues lecture
                    const leconsLectureKey = normalizeKey("Leçons reçues lecture");
                    if (entry.rawData[leconsLectureKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-graduation-cap"></i> Leçons reçues</div>
                            <div class="entry-value">${formatValue(entry.rawData[leconsLectureKey])}</div>
                        </div>`;
                    }
                    
                    // Durée lecture livre et Heure lecture livre
                    const dureeLectureKey = normalizeKey("Durée lecture livre");
                    const heureLectureKey = normalizeKey("Heure lecture livre");
                    
                    if (entry.rawData[dureeLectureKey] || entry.rawData[heureLectureKey]) {
                        entryHTML += `<div class="double-row">`;
                        
                        if (entry.rawData[dureeLectureKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-clock"></i> Durée lecture</div>
                                <div class="compact-value duration-value">${entry.rawData[dureeLectureKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-clock"></i> Durée lecture</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[heureLectureKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-user-clock"></i> Heure lecture</div>
                                <div class="compact-value time-value">${entry.rawData[heureLectureKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-user-clock"></i> Heure lecture</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: AUTRES ACTIVITES
                const occupationKey = normalizeKey("Occupation");
                const activiteExtraKey = normalizeKey("Activité extra");
                
                if (entry.rawData[occupationKey] || entry.rawData[activiteExtraKey]) {
                    entryHTML += `<div class="section-activites" id="section-activites">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-list-alt"></i> AUTRES ACTIVITES</div>`;
                    entryHTML += `<div class="section-decoration decoration-activites"><i class="fas fa-list-alt"></i></div>`;
                    
                    if (entry.rawData[occupationKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-tasks"></i> Occupation</div>
                            <div class="entry-value occupation">${formatValue(entry.rawData[occupationKey])}</div>
                        </div>`;
                    }
                    
                    // Détails Occupation
                    const detailsOccupationKey = normalizeKey("Détails Occupation");
                    if (entry.rawData[detailsOccupationKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails occupation</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsOccupationKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[activiteExtraKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-plus-circle"></i> Activité extra</div>
                            <div class="entry-value">${formatValue(entry.rawData[activiteExtraKey])}</div>
                        </div>`;
                    }
                    
                    // Détails Activité extra
                    const detailsActiviteExtraKey = normalizeKey("Détails Activité extra");
                    if (entry.rawData[detailsActiviteExtraKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails activité extra</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsActiviteExtraKey])}</div>
                        </div>`;
                    }
                    
                    // Apprentissage/formation
                    const apprentissageKey = normalizeKey("Apprentissage/formation");
                    if (entry.rawData[apprentissageKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-graduation-cap"></i> Apprentissage/formation</div>
                            <div class="entry-value">${formatValue(entry.rawData[apprentissageKey])}</div>
                        </div>`;
                    }
                    
                    // Détails Apprentissage
                    const detailsApprentissageKey = normalizeKey("Détails Apprentissage");
                    if (entry.rawData[detailsApprentissageKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails apprentissage</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsApprentissageKey])}</div>
                        </div>`;
                    }
                    
                    // Distraction
                    const distractionKey = normalizeKey("Distraction");
                    if (entry.rawData[distractionKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-tv"></i> Distraction</div>
                            <div class="entry-value">${formatValue(entry.rawData[distractionKey])}</div>
                        </div>`;
                    }
                    
                    // Détails sur distraction (CORRIGÉ)
                    let detailsDistractionValue = '';
                    const distractionDetailKeys = [
                        "Obs sur lecture",
                        "Détails distraction",
                        "Details distraction",
                        "Observation sur lecture",
                        "Détails sur distraction",
                        "Details sur distraction"
                    ];

                    for (const keyName of distractionDetailKeys) {
                        const variations = [
                            normalizeKey(keyName),
                            keyName.toLowerCase().replace(/\s+/g, '_'),
                            keyName.toLowerCase().replace(/[éèêë]/g, 'e').replace(/\s+/g, '_')
                        ];
                        
                        for (const key of variations) {
                            if (entry.rawData[key] && entry.rawData[key].trim() !== '') {
                                detailsDistractionValue = entry.rawData[key];
                                break;
                            }
                        }
                        
                        if (detailsDistractionValue) break;
                    }

                    if (!detailsDistractionValue && entry.groupedData.other) {
                        for (const item of entry.groupedData.other) {
                            const headerLower = item.header.toLowerCase();
                            if (headerLower.includes('distraction') || headerLower.includes('lecture')) {
                                detailsDistractionValue = item.value;
                                break;
                            }
                        }
                    }

                    if (detailsDistractionValue) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails sur distraction</div>
                            <div class="entry-value">${formatValue(detailsDistractionValue)}</div>
                        </div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: ACTIVITE PHYSIQUE
                const activitePhysiqueKey = normalizeKey("Activité physique");
                if (entry.rawData[activitePhysiqueKey]) {
                    entryHTML += `<div class="section-physique" id="section-physique">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-running"></i> ACTIVITE PHYSIQUE</div>`;
                    entryHTML += `<div class="section-decoration decoration-physique"><i class="fas fa-running"></i></div>`;
                    
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-running"></i> Activité physique</div>
                        <div class="entry-value">${formatValue(entry.rawData[activitePhysiqueKey])}</div>
                    </div>`;
                    
                    // Ligne avec Durée activité physique et Durée Debout
                    const dureePhysiqueKey = normalizeKey("Durée activité physique");
                    const dureeDeboutKey = normalizeKey("Durée Debout");
                    
                    if (entry.rawData[dureePhysiqueKey] || entry.rawData[dureeDeboutKey]) {
                        entryHTML += `<div class="double-row">`;
                        
                        if (entry.rawData[dureePhysiqueKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-stopwatch"></i> Durée activité</div>
                                <div class="compact-value duration-value">${entry.rawData[dureePhysiqueKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-stopwatch"></i> Durée activité</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[dureeDeboutKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-standing"></i> Durée debout</div>
                                <div class="compact-value duration-value">${entry.rawData[dureeDeboutKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-standing"></i> Durée debout</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Ligne avec Durée Marche Lente,normale et Durée Marche Rapide,modérée
                    const dureeMarcheLenteKey = normalizeKey("Durée Marche Lente,normale");
                    const dureeMarcheRapideKey = normalizeKey("Durée Marche Rapide,modérée");
                    
                    if (entry.rawData[dureeMarcheLenteKey] || entry.rawData[dureeMarcheRapideKey]) {
                        entryHTML += `<div class="double-row">`;
                        
                        if (entry.rawData[dureeMarcheLenteKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-walking"></i> Marche lente</div>
                                <div class="compact-value duration-value">${entry.rawData[dureeMarcheLenteKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-walking"></i> Marche lente</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[dureeMarcheRapideKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-running"></i> Marche rapide</div>
                                <div class="compact-value duration-value">${entry.rawData[dureeMarcheRapideKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-running"></i> Marche rapide</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Détails activité physique
                    const detailsPhysiqueKey = normalizeKey("Détails activité physique");
                    if (entry.rawData[detailsPhysiqueKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsPhysiqueKey])}</div>
                        </div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: ACTIVITE MENAGERE
                const detailsMenagereKey3 = normalizeKey("Détails sur activités ménagère");
                const detailsMenagereKey2 = normalizeKey("Details activites menageres");
                const detailsMenagereKey1 = normalizeKey("Leçon spirituelle tirée du jour");
                const dureeMenagereKey = normalizeKey("Durée activités ménagère");
                
                let detailsMenagereValue = '';
                let detailsMenagereKeyUsed = '';
                
                if (entry.rawData[detailsMenagereKey3]) {
                    detailsMenagereValue = entry.rawData[detailsMenagereKey3];
                    detailsMenagereKeyUsed = detailsMenagereKey3;
                } else if (entry.rawData[detailsMenagereKey2]) {
                    detailsMenagereValue = entry.rawData[detailsMenagereKey2];
                    detailsMenagereKeyUsed = detailsMenagereKey2;
                } else if (entry.rawData[detailsMenagereKey1]) {
                    detailsMenagereValue = entry.rawData[detailsMenagereKey1];
                    detailsMenagereKeyUsed = detailsMenagereKey1;
                }
                
                const hasMenagereData = (entry.groupedData.activite_menagere && entry.groupedData.activite_menagere.length > 0) || 
                    detailsMenagereValue || entry.rawData[dureeMenagereKey];
                
                if (hasMenagereData) {
                    entryHTML += `<div class="section-menagere" id="section-menagere">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-broom"></i> ACTIVITE MENAGERE</div>`;
                    entryHTML += `<div class="section-decoration decoration-menagere"><i class="fas fa-broom"></i></div>`;
                    
                    // Durée activités ménagère
                    if (entry.rawData[dureeMenagereKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-stopwatch"></i> Durée activités ménagère</div>
                            <div class="entry-value duration-value">${entry.rawData[dureeMenagereKey]}</div>
                        </div>`;
                    }
                    
                    // Tâches ménagères
                    if (entry.groupedData.activite_menagere && entry.groupedData.activite_menagere.length > 0) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-home-alt"></i> Tâches ménagères</div>
                            <div class="entry-value">`;
                        
                        const menagereLabels = {
                            'Chambre': '🛏️ Chambre',
                            'Salon': '🛋️ Salon',
                            'Cuisine': '🍳 Cuisine',
                            'Salle de bain': '🚿 Salle de bain',
                            'Toilette': '🚽 Toilette'
                        };
                        
                        entry.groupedData.activite_menagere.forEach(item => {
                            if (item.value && item.value.trim() !== '') {
                                let room = item.header.replace('Activité ménagère: ', '');
                                
                                for (const [key, emojiLabel] of Object.entries(menagereLabels)) {
                                    if (room.includes(key)) {
                                        room = emojiLabel;
                                        break;
                                    }
                                }
                                
                                const timeDisplay = extractMenagereTime(item.value);
                                const valueWithoutTime = item.value.replace(/(\d+)\s*(min|minutes|m|h|heures|hr|hour)/i, '').trim();
                                
                                entryHTML += `<div class="menagere-label">${room} ${timeDisplay}</div>`;
                                entryHTML += `<div class="menagere-value">${valueWithoutTime}</div><br>`;
                            }
                        });
                        
                        entryHTML += `</div></div>`;
                    }
                    
                    // Détails sur activités ménagère
                    if (detailsMenagereValue) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails sur activités ménagère</div>
                            <div class="entry-value">${formatValue(detailsMenagereValue)}</div>
                        </div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: PROGRAMME
                const proAmisKey = normalizeKey("Pro avec des amis");
                const avecFamilleKey = normalizeKey("Avec la famille");
                const proFamilleKey = normalizeKey("Pro avec la famille");
                const evenementKey = normalizeKey("Evenement special / Fête");
                
                if (entry.rawData[proAmisKey] || entry.rawData[avecFamilleKey] || entry.rawData[proFamilleKey] || entry.rawData[evenementKey]) {
                    entryHTML += `<div class="section-programme" id="section-programme">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-calendar-check"></i> PROGRAMME</div>`;
                    entryHTML += `<div class="section-decoration decoration-programme"><i class="fas fa-calendar-check"></i></div>`;
                    
                    if (entry.rawData[proAmisKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-user-friends"></i> Avec des amis</div>
                            <div class="entry-value">${formatValue(entry.rawData[proAmisKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[avecFamilleKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-users"></i> Avec la famille</div>
                            <div class="entry-value">${formatValue(entry.rawData[avecFamilleKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[proFamilleKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-users"></i> Programme avec famille</div>
                            <div class="entry-value">${formatValue(entry.rawData[proFamilleKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[evenementKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-calendar-star"></i> Événement spécial</div>
                            <div class="entry-value">${formatValue(entry.rawData[evenementKey])}</div>
                        </div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: NY AKO
                const programmeNyAkoKey = normalizeKey("Programme avec ny ako");
                const detailsNyAkoKey = normalizeKey("Details Programme avec ny ako");
                
                if (entry.rawData[programmeNyAkoKey] || entry.rawData[detailsNyAkoKey]) {
                    entryHTML += `<div class="section-nyako" id="section-nyako">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-user"></i> NY AKO</div>`;
                    entryHTML += `<div class="section-decoration decoration-nyako"><i class="fas fa-user"></i></div>`;
                    
                    if (entry.rawData[programmeNyAkoKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-calendar"></i> Programme</div>
                            <div class="entry-value">${formatValue(entry.rawData[programmeNyAkoKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[detailsNyAkoKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails programme</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsNyAkoKey])}</div>
                        </div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: FINANCE avec tableau de report (CORRIGÉ)
                const depensesNourritureKey = normalizeKey("Dépenses en nourriture");
                const achatsAutresKey = normalizeKey("Achats autres");
                const autresDepensesKey = normalizeKey("Autres depenses non achat du jour");
                const fraisTravailKey = normalizeKey("Frais travail");
                const fraisDiversKey = normalizeKey("Frais divers");
                const achatsMaterielKey = normalizeKey("Achats matériel(+-durable)");
                const entreeEspeceKey = normalizeKey("Entrée espèce");
                const sourceEntreeKey = normalizeKey("Source entrée");
                
                let financeData = {
                    depensesNourriture: { text: '', data: null, total: 0 },
                    achatsAutres: { text: '', data: null, total: 0 },
                    fraisTravail: { text: '', data: null, total: 0 },
                    achatsMateriel: { text: '', data: null, total: 0 },
                    fraisDivers: { text: '', data: null, total: 0 },
                    autresDepenses: { text: '', data: null, total: 0 },
                    entreeEspece: { text: '', data: null, total: 0 }
                };
                
                if (entry.rawData[depensesNourritureKey]) {
                    financeData.depensesNourriture.text = entry.rawData[depensesNourritureKey];
                    financeData.depensesNourriture.data = extractFinancialAmounts(entry.rawData[depensesNourritureKey]);
                    financeData.depensesNourriture.total = financeData.depensesNourriture.data.total;
                }
                
                if (entry.rawData[achatsAutresKey]) {
                    financeData.achatsAutres.text = entry.rawData[achatsAutresKey];
                    financeData.achatsAutres.data = extractFinancialAmounts(entry.rawData[achatsAutresKey]);
                    financeData.achatsAutres.total = financeData.achatsAutres.data.total;
                }
                
                if (entry.rawData[fraisTravailKey]) {
                    financeData.fraisTravail.text = entry.rawData[fraisTravailKey];
                    financeData.fraisTravail.data = extractFinancialAmounts(entry.rawData[fraisTravailKey]);
                    financeData.fraisTravail.total = financeData.fraisTravail.data.total;
                }
                
                if (entry.rawData[achatsMaterielKey]) {
                    financeData.achatsMateriel.text = entry.rawData[achatsMaterielKey];
                    financeData.achatsMateriel.data = extractFinancialAmounts(entry.rawData[achatsMaterielKey]);
                    financeData.achatsMateriel.total = financeData.achatsMateriel.data.total;
                }
                
                if (entry.rawData[fraisDiversKey]) {
                    financeData.fraisDivers.text = entry.rawData[fraisDiversKey];
                    financeData.fraisDivers.data = extractFinancialAmounts(entry.rawData[fraisDiversKey]);
                    financeData.fraisDivers.total = financeData.fraisDivers.data.total;
                }
                
                if (entry.rawData[autresDepensesKey]) {
                    financeData.autresDepenses.text = entry.rawData[autresDepensesKey];
                    financeData.autresDepenses.data = extractFinancialAmounts(entry.rawData[autresDepensesKey]);
                    financeData.autresDepenses.total = financeData.autresDepenses.data.total;
                }
                
                if (entry.rawData[entreeEspeceKey]) {
                    financeData.entreeEspece.text = entry.rawData[entreeEspeceKey];
                    financeData.entreeEspece.data = extractFinancialAmounts(entry.rawData[entreeEspeceKey]);
                    financeData.entreeEspece.total = financeData.entreeEspece.data.total;
                }
                
                const totalDepenses = financeData.depensesNourriture.total + 
                                     financeData.achatsAutres.total + 
                                     financeData.fraisTravail.total + 
                                     financeData.achatsMateriel.total + 
                                     financeData.fraisDivers.total + 
                                     financeData.autresDepenses.total;
                
                const totalRecettes = financeData.entreeEspece.total;
                const solde = totalRecettes - totalDepenses;
                
                const hasFinanceData = totalDepenses > 0 || totalRecettes > 0;
                
                if (hasFinanceData) {
                    entryHTML += `<div class="section-finance" id="section-finance">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-money-bill-wave"></i> FINANCE</div>`;
                    entryHTML += `<div class="section-decoration decoration-finance"><i class="fas fa-money-bill-wave"></i></div>`;
                    
                    const addFinanceCategory = (label, data, icon) => {
                        if (data.total > 0) {
                            entryHTML += `<tr class="finance-category">
                                <td><i class="fas ${icon}"></i> ${label}</td>
                                <td>`;
                            
                            if (data.data && data.data.items.length > 0) {
                                data.data.items.forEach(item => {
                                    if (item.rawLine) {
                                        entryHTML += `<div class="finance-detail">${formatValue(item.rawLine)}</div>`;
                                    } else if (item.description) {
                                        entryHTML += `<div class="finance-detail">${formatValue(item.description)}</div>`;
                                    }
                                });
                            } else if (data.text) {
                                const lines = data.text.split(/[\n,;]/).filter(line => line.trim() !== '');
                                lines.forEach(line => {
                                    const cleanLine = line.trim();
                                    entryHTML += `<div class="finance-detail">${formatValue(cleanLine)}</div>`;
                                });
                            }
                            
                            entryHTML += `</td>
                                <td class="finance-amount">${formatAmount(data.total)}</td>
                            </tr>`;
                        }
                    };
                    
                    entryHTML += `<table class="finance-report">`;
                    entryHTML += `<thead>
                        <tr>
                            <th>Catégorie</th>
                            <th>Détails</th>
                            <th>Montant</th>
                        </tr>
                    </thead>
                    <tbody>`;
                    
                    addFinanceCategory("Dépenses en nourriture", financeData.depensesNourriture, "fa-utensils");
                    addFinanceCategory("Achats autres", financeData.achatsAutres, "fa-shopping-cart");
                    addFinanceCategory("Frais travail", financeData.fraisTravail, "fa-briefcase");
                    addFinanceCategory("Achats matériel", financeData.achatsMateriel, "fa-shopping-bag");
                    addFinanceCategory("Frais divers", financeData.fraisDivers, "fa-money-bill-alt");
                    addFinanceCategory("Autres dépenses", financeData.autresDepenses, "fa-receipt");
                    
                    if (totalDepenses > 0) {
                        entryHTML += `<tr class="finance-total">
                            <td colspan="2"><strong>TOTAL DÉPENSES</strong></td>
                            <td class="finance-amount"><strong>${formatAmount(totalDepenses)}</strong></td>
                        </tr>`;
                    }
                    
                    if (financeData.entreeEspece.total > 0) {
                        entryHTML += `<tr class="finance-category">
                            <td><i class="fas fa-money-check-alt"></i> Entrée espèce</td>
                            <td>`;
                        
                        if (financeData.entreeEspece.data && financeData.entreeEspece.data.items.length > 0) {
                            financeData.entreeEspece.data.items.forEach(item => {
                                if (item.rawLine) {
                                    entryHTML += `<div class="finance-detail">${formatValue(item.rawLine)}</div>`;
                                } else if (item.description) {
                                    entryHTML += `<div class="finance-detail">${formatValue(item.description)}</div>`;
                                }
                            });
                        } else if (financeData.entreeEspece.text) {
                            const lines = financeData.entreeEspece.text.split(/[\n,;]/).filter(line => line.trim() !== '');
                            lines.forEach(line => {
                                const cleanLine = line.trim();
                                entryHTML += `<div class="finance-detail">${formatValue(cleanLine)}</div>`;
                            });
                        }
                        
                        entryHTML += `</td>
                            <td class="finance-amount">${formatAmount(financeData.entreeEspece.total)}</td>
                        </tr>`;
                    }
                    
                    if (entry.rawData[sourceEntreeKey]) {
                        entryHTML += `<tr>
                            <td><i class="fas fa-search-dollar"></i> Source entrée</td>
                            <td colspan="2">${formatValue(entry.rawData[sourceEntreeKey])}</td>
                        </tr>`;
                    }
                    
                    entryHTML += `</tbody></table>`;
                    
                    entryHTML += `<div class="finance-summary">`;
                    entryHTML += `<div class="finance-summary-row">
                        <span class="finance-summary-label">Total dépenses:</span>
                        <span class="finance-summary-value">${formatAmount(totalDepenses)}</span>
                    </div>`;
                    
                    if (totalRecettes > 0) {
                        entryHTML += `<div class="finance-summary-row">
                            <span class="finance-summary-label">Total recettes:</span>
                            <span class="finance-summary-value">${formatAmount(totalRecettes)}</span>
                        </div>`;
                    }
                    
                    entryHTML += `<div class="finance-summary-row">
                        <span class="finance-summary-label">Solde du jour:</span>
                        <span class="finance-summary-value" style="color: ${solde >= 0 ? '#2E7D32' : '#D32F2F'}">
                            ${formatAmount(Math.abs(solde))} ${solde >= 0 ? '(excédent)' : '(déficit)'}
                        </span>
                    </div>`;
                    entryHTML += `</div>`;
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: DEPLACEMENT
                const lieuxKey = normalizeKey("Lieux du jour");
                const moyenKey = normalizeKey("Moyen de locomotion");
                const detailsDeplacementKey = normalizeKey("Details de mes déplacements/trajets/durée");
                const dureeBusKey = normalizeKey("Durée en bus");
                const dureeVoitureKey = normalizeKey("Durée en voiture");
                const dureeMotoKey = normalizeKey("Durée en moto");
                
                if (entry.rawData[lieuxKey] || entry.rawData[moyenKey] || entry.rawData[detailsDeplacementKey] ||
                    entry.rawData[dureeBusKey] || entry.rawData[dureeVoitureKey] || entry.rawData[dureeMotoKey]) {
                    entryHTML += `<div class="section-deplacement" id="section-deplacement">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-car"></i> DEPLACEMENT</div>`;
                    entryHTML += `<div class="section-decoration decoration-deplacement"><i class="fas fa-car"></i></div>`;
                    
                    if (entry.rawData[lieuxKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-map-marked-alt"></i> Lieux du jour</div>
                            <div class="entry-value">${formatValue(entry.rawData[lieuxKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[moyenKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-bus"></i> Moyen de locomotion</div>
                            <div class="entry-value">${formatValue(entry.rawData[moyenKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[detailsDeplacementKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-route"></i> Détails déplacements</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsDeplacementKey])}</div>
                        </div>`;
                    }
                    
                    // Durées en bus, voiture, moto
                    if (entry.rawData[dureeBusKey] || entry.rawData[dureeVoitureKey] || entry.rawData[dureeMotoKey]) {
                        entryHTML += `<div class="triple-row">`;
                        
                        if (entry.rawData[dureeBusKey]) {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-bus-alt"></i> Bus</div>
                                <div class="compact-value duration-value">${entry.rawData[dureeBusKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-bus-alt"></i> Bus</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[dureeVoitureKey]) {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-car-side"></i> Voiture</div>
                                <div class="compact-value duration-value">${entry.rawData[dureeVoitureKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-car-side"></i> Voiture</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[dureeMotoKey]) {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-motorcycle"></i> Moto</div>
                                <div class="compact-value duration-value">${entry.rawData[dureeMotoKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-motorcycle"></i> Moto</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: RELATION & COMMUNICATION - AMÉLIORÉE
                const familleInteractionKey = normalizeKey("Famille interaction");
                const rencontreKey = normalizeKey("Rencontre du jour");
                const relationKey = normalizeKey("Relation avec mmr");
                const discussionKey = normalizeKey("Discussion en réseau/sms/mail du jour");
                const discussionRencontreKey = normalizeKey("Discussion");
                const messageKey = normalizeKey("Message");
                const appelKey = normalizeKey("Appel");
                const detailsCommKey = normalizeKey("Détails comm");
                
                if (entry.rawData[familleInteractionKey] || entry.rawData[rencontreKey] || entry.rawData[relationKey] || 
                    entry.rawData[discussionKey] || entry.rawData[discussionRencontreKey] || entry.rawData[messageKey] || 
                    entry.rawData[appelKey] || entry.rawData[detailsCommKey]) {
                    entryHTML += `<div class="section-relation" id="section-relation">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-comments"></i> RELATION & COMMUNICATION</div>`;
                    entryHTML += `<div class="section-decoration decoration-relation"><i class="fas fa-comments"></i></div>`;
                    
                    if (entry.rawData[familleInteractionKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-users"></i> Interaction famille</div>
                            <div class="entry-value">${formatValue(entry.rawData[familleInteractionKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[rencontreKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-handshake"></i> Rencontre du jour</div>
                            <div class="entry-value">${formatValue(entry.rawData[rencontreKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[discussionRencontreKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-comments-alt"></i> Discussion</div>
                            <div class="entry-value">${formatValue(entry.rawData[discussionRencontreKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[relationKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-heart"></i> Relation avec mmr</div>
                            <div class="entry-value">${formatValue(entry.rawData[relationKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[discussionKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-comment-dots"></i> Discussions réseau</div>
                            <div class="entry-value">${formatValue(entry.rawData[discussionKey])}</div>
                        </div>`;
                    }
                    
                    // Message et Appel sur une même ligne, Détails comm sur une ligne en dessous
                    if (entry.rawData[messageKey] || entry.rawData[appelKey] || entry.rawData[detailsCommKey]) {
                        entryHTML += `<div class="relation-message-appel">`;
                        
                        if (entry.rawData[messageKey]) {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-sms"></i> Message</div>
                                <div class="compact-value">${entry.rawData[messageKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-sms"></i> Message</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[appelKey]) {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-phone"></i> Appel</div>
                                <div class="compact-value">${entry.rawData[appelKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="triple-item">
                                <div class="compact-label"><i class="fas fa-phone"></i> Appel</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                        
                        if (entry.rawData[detailsCommKey]) {
                            entryHTML += `<div class="relation-details-comm">
                                <div class="triple-item">
                                    <div class="compact-label"><i class="fas fa-info-circle"></i> Détails comm</div>
                                    <div class="compact-value">${formatValue(entry.rawData[detailsCommKey])}</div>
                                </div>
                            </div>`;
                        }
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: PERIODIQUE
                if (entry.groupedData.monstruation && entry.groupedData.monstruation.length > 0) {
                    entryHTML += `<div class="section-periodique" id="section-periodique">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-calendar-day"></i> PERIODIQUE</div>`;
                    entryHTML += `<div class="section-decoration decoration-periodique"><i class="fas fa-calendar-day"></i></div>`;
                    
                    // Menstruation
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-female"></i> Menstruation</div>
                        <div class="entry-value">`;
                    
                    const menstruationItems = [];
                    let jPlusValue = '';
                    
                    entry.groupedData.monstruation.forEach(item => {
                        if (item.value && item.value.trim() !== '') {
                            let formattedValue = item.value.toLowerCase().trim();
                            const match = item.header.match(/\[([^\]]+)\]/);
                            
                            if (match) {
                                const aspect = match[1].toLowerCase();
                                let emoji = '';
                                
                                Object.entries(menstruationEmojis).forEach(([keyword, emojiChar]) => {
                                    if (aspect.includes(keyword) || formattedValue.includes(keyword)) {
                                        emoji = emojiChar;
                                    }
                                });
                                
                                if (aspect.includes('jour') || aspect.includes('j+')) {
                                    jPlusValue = formattedValue;
                                    menstruationItems.push(`<span class="menstruation-item">📅 J+${formattedValue.replace(/[^0-9]/g, '') || '?'}</span>`);
                                } else if (formattedValue !== 'non' && formattedValue !== 'aucun' && formattedValue !== 'pas') {
                                    menstruationItems.push(`<span class="menstruation-item">${emoji} ${aspect}</span>`);
                                }
                            }
                        }
                    });
                    
                    if (menstruationItems.length > 0) {
                        entryHTML += `<div class="cycle-emojis">${menstruationItems.join(' ')}</div>`;
                    } else {
                        entryHTML += 'Aucune information';
                    }
                    
                    entryHTML += `</div></div>`;
                    
                    // Nouveaux champs
                    const lavageOreilleKey = normalizeKey("Lavage oreille");
                    const detartrageKey = normalizeKey("Detartrage");
                    const bilanSanteKey = normalizeKey("Bilan santé");
                    const nettoyageKey = normalizeKey("Nettoyage");
                    
                    // Lavage oreille
                    if (entry.rawData[lavageOreilleKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-ear"></i> Lavage oreille</div>
                            <div class="entry-value">${formatValue(entry.rawData[lavageOreilleKey])}</div>
                        </div>`;
                    }
                    
                    // Detartrage
                    if (entry.rawData[detartrageKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-teeth"></i> Détartrage</div>
                            <div class="entry-value">${formatValue(entry.rawData[detartrageKey])}</div>
                        </div>`;
                    }
                    
                    // Bilan santé
                    if (entry.rawData[bilanSanteKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-stethoscope"></i> Bilan santé</div>
                            <div class="entry-value">${formatValue(entry.rawData[bilanSanteKey])}</div>
                        </div>`;
                    }
                    
                    // Nettoyage
                    if (entry.rawData[nettoyageKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-toothbrush"></i> Nettoyage</div>
                            <div class="entry-value">${formatValue(entry.rawData[nettoyageKey])}</div>
                        </div>`;
                    }
                    
                    // Lunette et Details lunette
                    const lunetteKey = normalizeKey("Lunette");
                    const detailsLunetteKey = normalizeKey("Details lunette");
                    
                    if (entry.rawData[lunetteKey] || entry.rawData[detailsLunetteKey]) {
                        entryHTML += `<div class="double-row">`;
                        
                        if (entry.rawData[lunetteKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-glasses"></i> Lunette</div>
                                <div class="compact-value">${entry.rawData[lunetteKey]}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-glasses"></i> Lunette</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        if (entry.rawData[detailsLunetteKey]) {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-info-circle"></i> Détails lunette</div>
                                <div class="compact-value">${formatValue(entry.rawData[detailsLunetteKey])}</div>
                            </div>`;
                        } else {
                            entryHTML += `<div class="double-item">
                                <div class="compact-label"><i class="fas fa-info-circle"></i> Détails lunette</div>
                                <div class="compact-value"></div>
                            </div>`;
                        }
                        
                        entryHTML += `</div>`;
                    }
                    
                    // Autres champs périodiques
                    const periodicFields = [
                        {key: "Anti parasite", label: "Anti parasite", icon: "fa-bug"},
                        {key: "Jirama", label: "Jirama", icon: "fa-bolt"},
                        {key: "Crédit", label: "Crédit", icon: "fa-credit-card"}
                    ];
                    
                    periodicFields.forEach(field => {
                        const fieldKey = normalizeKey(field.key);
                        if (entry.rawData[fieldKey]) {
                            entryHTML += `<div class="entry-row">
                                <div class="entry-label"><i class="fas ${field.icon}"></i> ${field.label}</div>
                                <div class="entry-value">${formatValue(entry.rawData[fieldKey])}</div>
                            </div>`;
                        }
                    });
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: SANTE, SOIN, HYGIENE (CORRIGÉE)
                const lavageKey = normalizeKey("Lavage");
                const extraKey = normalizeKey("Extra");
                const bijouKey = normalizeKey("Bijou inhabituel");
                const detailsSoinKey = normalizeKey("Details soin du jour");
                const maladieKey = normalizeKey("Maladie");
                const suiviSanteKey = normalizeKey("Suivi santé");
                const santeKey = normalizeKey("Santé");
                
                if (entry.rawData[lavageKey] || entry.rawData[extraKey] || entry.rawData[bijouKey] || 
                    entry.rawData[detailsSoinKey] || entry.rawData[maladieKey] || entry.rawData[suiviSanteKey] ||
                    entry.rawData[santeKey]) {
                    entryHTML += `<div class="section-sante" id="section-sante">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-heartbeat"></i> SANTE, SOIN, HYGIENE</div>`;
                    entryHTML += `<div class="section-decoration decoration-sante"><i class="fas fa-heartbeat"></i></div>`;
                    
                    if (entry.rawData[lavageKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-shower"></i> Lavage</div>
                            <div class="entry-value">${formatValue(entry.rawData[lavageKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[extraKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-plus-circle"></i> Extra</div>
                            <div class="entry-value">${formatValue(entry.rawData[extraKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[bijouKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-gem"></i> Bijou inhabituel</div>
                            <div class="entry-value">${formatValue(entry.rawData[bijouKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[detailsSoinKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-info-circle"></i> Détails soin</div>
                            <div class="entry-value">${formatValue(entry.rawData[detailsSoinKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[maladieKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-head-side-cough"></i> Maladie</div>
                            <div class="entry-value maladie-sante">${formatValue(entry.rawData[maladieKey])}</div>
                        </div>`;
                    }
                    
                    if (entry.rawData[suiviSanteKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-heartbeat"></i> Suivi santé</div>
                            <div class="entry-value maladie-sante">${formatValue(entry.rawData[suiviSanteKey])}</div>
                        </div>`;
                    }
                    
                    // Santé (corrigé : champ distinct)
                    if (entry.rawData[santeKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-heartbeat"></i> Santé</div>
                            <div class="entry-value maladie-sante">${formatValue(entry.rawData[santeKey])}</div>
                        </div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // SECTION: POIDS & MENSURATION (avec ajout automatique d'unités)
                const poidsKey = normalizeKey("Poids");
                const tourHancheKey = normalizeKey("Tour de hanche");
                const tourCuissesKey = normalizeKey("Tour du haut des cuisse");
                const tourJambeKey = normalizeKey("Tour de jambe");
                const tourTailleKey = normalizeKey("Tour de taille");
                const tourVentreKey = normalizeKey("Tour de ventre");
                const tourPoitrineKey = normalizeKey("Tour de poitrine");
                const tourBrasKey = normalizeKey("Tour de bras");
                
                if (entry.rawData[poidsKey] || entry.rawData[tourHancheKey] || entry.rawData[tourCuissesKey] || 
                    entry.rawData[tourJambeKey] || entry.rawData[tourTailleKey] || entry.rawData[tourVentreKey] || 
                    entry.rawData[tourPoitrineKey] || entry.rawData[tourBrasKey]) {
                    entryHTML += `<div class="section-poids" id="section-poids">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-weight-scale"></i> POIDS & MENSURATION</div>`;
                    entryHTML += `<div class="section-decoration decoration-poids"><i class="fas fa-weight-scale"></i></div>`;
                    
                    entryHTML += `<div class="measurement-table">`;
                    
                    const measurementFields = [
                        {key: "Poids", label: "Poids", icon: "fa-weight-scale"},
                        {key: "Tour de hanche", label: "Tour de hanche", icon: "fa-ruler"},
                        {key: "Tour du haut des cuisse", label: "Tour haut cuisses", icon: "fa-ruler"},
                        {key: "Tour de jambe", label: "Tour de jambe", icon: "fa-ruler"},
                        {key: "Tour de taille", label: "Tour de taille", icon: "fa-ruler"},
                        {key: "Tour de ventre", label: "Tour de ventre", icon: "fa-ruler"},
                        {key: "Tour de poitrine", label: "Tour de poitrine", icon: "fa-ruler"},
                        {key: "Tour de bras", label: "Tour de bras", icon: "fa-ruler"}
                    ];
                    
                    measurementFields.forEach(field => {
                        const fieldKey = normalizeKey(field.key);
                        if (entry.rawData[fieldKey]) {
                            entryHTML += `<div class="measurement-item">
                                <div class="measurement-label">${field.label}</div>
                                <div class="measurement-value">${entry.rawData[fieldKey]}</div>
                            </div>`;
                        }
                    });
                    
                    entryHTML += `</div>`;
                    entryHTML += `</div>`;
                }
                
                // SECTION: BILAN PERSONNEL DE LA JOURNEE (CORRIGÉE)
                const stressKey = normalizeKey("Stress ressenti, pensée dominante, quelque chose de positif aujourd'hui");
                const difficultesKey = normalizeKey("Difficultés rencontrées");
                const erreurKey = normalizeKey("Erreur à ne pas répéter");
                const leconsKey = normalizeKey("Leçons du jour");
                const inhabituelKey = normalizeKey("Inhabituel");
                const autresChoseKey = normalizeKey("Autres chose");
                const cadeauKey = normalizeKey("Ce que j'ai reçu en cadeau aujourd'hui");
                const etatKey = normalizeKey("Etat mental et emotionnel");
                const fatigueKey = normalizeKey("Fatigue");
                const photosKey = normalizeKey("Photos du jour");
                const rohyKey = normalizeKey("rohy fiche");
                const partageJourKey = normalizeKey("Partage du jour");
                const penseesAnalyseKey = normalizeKey("Mes pensées et analyse du jour");
                const deroulementJourneeKey = normalizeKey("Déroulement journée");
                
                // Déroulement journée à part
                if (entry.rawData[deroulementJourneeKey]) {
                    entryHTML += `<div class="entry-row">
                        <div class="entry-label"><i class="fas fa-calendar-day"></i> DÉROULEMENT JOURNÉE</div>
                        <div class="entry-value deroulement-journee">${formatValue(entry.rawData[deroulementJourneeKey])}</div>
                    </div>`;
                }
                
                if (entry.rawData[stressKey] || entry.rawData[difficultesKey] || entry.rawData[leconsKey] || 
                    entry.rawData[partageJourKey] || entry.rawData[rohyKey] || entry.rawData[photosKey] ||
                    entry.rawData[penseesAnalyseKey] || entry.rawData[cadeauKey] || entry.rawData[etatKey] ||
                    entry.rawData[erreurKey] || entry.rawData[inhabituelKey] || entry.rawData[autresChoseKey]) {
                    entryHTML += `<div class="section-bilan" id="section-bilan">`;
                    entryHTML += `<div class="section-title"><i class="fas fa-chart-line"></i> BILAN PERSONNEL DE LA JOURNEE</div>`;
                    entryHTML += `<div class="section-decoration decoration-bilan"><i class="fas fa-chart-line"></i></div>`;
                    
                    const bilanFields = [
                        {key: "Stress ressenti, pensée dominante, quelque chose de positif aujourd'hui", label: "Stress/positif du jour", icon: "fa-brain"},
                        {key: "Difficultés rencontrées", label: "Difficultés rencontrées", icon: "fa-exclamation-triangle"},
                        {key: "Erreur à ne pas répéter", label: "Erreur à ne pas répéter", icon: "fa-times-circle"},
                        {key: "Leçons du jour", label: "Leçons du jour", icon: "fa-graduation-cap"},
                        {key: "Inhabituel", label: "Inhabituel", icon: "fa-star"},
                        {key: "Autres chose", label: "Autres choses", icon: "fa-ellipsis-h"},
                        {key: "Mes pensées et analyse du jour", label: "Mes pensées et analyse", icon: "fa-thought-bubble"},
                        {key: "Partage du jour", label: "Partage du jour", icon: "fa-comments"},
                        {key: "Ce que j'ai reçu en cadeau aujourd'hui", label: "Cadeau reçu", icon: "fa-gift", class: "cadeau-recu"},
                        {key: "Fatigue", label: "Fatigue", icon: "fa-bed"},
                        {key: "Photos du jour", label: "Photos du jour", icon: "fa-camera"},
                        {key: "rohy fiche", label: "Lien fiche", icon: "fa-link"}
                    ];
                    
                    bilanFields.forEach(field => {
    const fieldKey = normalizeKey(field.key);
    if (entry.rawData[fieldKey]) {
        if (field.key === "Fatigue") {
            const fatigueStars = createStars(entry.rawData[fieldKey]);
            entryHTML += `<div class="entry-row">
                <div class="entry-label"><i class="fas ${field.icon}"></i> ${field.label}</div>
                <div class="entry-value">${fatigueStars || entry.rawData[fieldKey]}</div>
            </div>`;
        } else if (field.key === "rohy fiche") {
            const urls = entry.rawData[fieldKey].match(/https?:\/\/[^\s]+/g) || [];
            let formattedValue = formatValue(entry.rawData[fieldKey]);
            urls.forEach(url => {
                formattedValue = formattedValue.replace(url, `<a href="${url}" target="_blank">${url}</a>`);
            });
            entryHTML += `<div class="entry-row">
                <div class="entry-label"><i class="fas ${field.icon}"></i> ${field.label}</div>
                <div class="entry-value">${formattedValue}</div>
            </div>`;
        } else if (field.key === "Photos du jour") {
            // Photos du jour avec aperçu
            const photosContent = entry.rawData[fieldKey];
            const photoUrls = extractPhotoUrls(photosContent);
            
            entryHTML += `<div class="entry-row">
                <div class="entry-label"><i class="fas ${field.icon}"></i> ${field.label}</div>
                <div class="entry-value">`;
            
            if (photoUrls.length > 0) {
                // Afficher l'aperçu des photos
                entryHTML += generatePhotoPreview(photoUrls);
            } else {
                // Fallback: afficher le texte original
                entryHTML += formatValue(photosContent);
            }
            
            entryHTML += `</div></div>`;
        } else {
            const valueClass = field.class || "";
            entryHTML += `<div class="entry-row">
                <div class="entry-label"><i class="fas ${field.icon}"></i> ${field.label}</div>
                <div class="entry-value ${valueClass}">${formatValue(entry.rawData[fieldKey])}</div>
            </div>`;
        }
    }
});
                    
                    // Rêve la veille (déjà dans section SOMMEIL, mais on l'ajoute si manquant)
                    const reveKey = normalizeKey("Rêve la veille");
                    if (entry.rawData[reveKey] && !document.querySelector('.section-sommeil .entry-row:has(.entry-label i.fa-cloud-moon)')) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-cloud-moon"></i> Rêve la veille</div>
                            <div class="entry-value">${formatValue(entry.rawData[reveKey])}</div>
                        </div>`;
                    }
                    
                    // Nuit la veille (déjà dans section SOMMEIL, mais on l'ajoute si manquant)
                    const nuitKey = normalizeKey("Nuit la veille");
                    if (entry.rawData[nuitKey] && !document.querySelector('.section-sommeil .entry-row:has(.entry-label i.fa-star)')) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-star"></i> Nuit la veille</div>
                            <div class="entry-value">${formatValue(entry.rawData[nuitKey])}</div>
                        </div>`;
                    }
                    
                    // État mental et émotionnel
                    if (entry.rawData[etatKey]) {
                        entryHTML += `<div class="entry-row">
                            <div class="entry-label"><i class="fas fa-smile"></i> État mental/émotionnel</div>
                            <div class="entry-value">${formatValue(entry.rawData[etatKey])}</div>
                        </div>`;
                    }
                    
                    entryHTML += `</div>`;
                }
                
                // Navigation interne à la fin
                entryHTML += `<div class="section-nav-end">${sectionButtons}</div>`;
                
                // Navigation précédent/suivant
                const prevEntry = getPreviousEntry(entry.date);
                const nextEntry = getNextEntry(entry.date);
                
                entryHTML += `<div class="entry-navigation">
                    <button class="nav-prev-next" id="prev-entry" ${!prevEntry ? 'disabled class="disabled"' : ''}>
                        <i class="fas fa-chevron-left"></i> Précédent
                    </button>
                    <button class="nav-prev-next" id="next-entry" ${!nextEntry ? 'disabled class="disabled"' : ''}>
                        Suivant <i class="fas fa-chevron-right"></i>
                    </button>
                </div>`;
                
                entryHTML += '</div></div>';
                journalDisplay.innerHTML = entryHTML;
                
                // Scroll vers le haut de la fiche
                setTimeout(() => {
                    const journalEntry = document.getElementById('journal-entry-top');
                    if (journalEntry) {
                        journalEntry.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
                
                // Ajouter les écouteurs d'événements pour la navigation interne
                document.querySelectorAll('.section-nav-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const section = this.getAttribute('data-section');
                        const sectionElement = document.getElementById(`section-${section}`);
                        if (sectionElement) {
                            sectionElement.scrollIntoView({ behavior: 'smooth' });
                        }
                    });
                });
                
                // Ajouter les écouteurs d'événements pour la navigation précédent/suivant
                if (prevEntry) {
                    document.getElementById('prev-entry').addEventListener('click', function() {
                        currentDate = prevEntry.date;
                        const normalizedDate = normalizeDate(prevEntry.date);
                        showEntryForDate(normalizedDate);
                        
                        // Mettre à jour le calendrier
                        const dateObj = new Date(prevEntry.date);
                        currentMonth = dateObj.getMonth();
                        currentYear = dateObj.getFullYear();
                        renderCalendar(currentMonth, currentYear);
                    });
                }
                
                if (nextEntry) {
                    document.getElementById('next-entry').addEventListener('click', function() {
                        currentDate = nextEntry.date;
                        const normalizedDate = normalizeDate(nextEntry.date);
                        showEntryForDate(normalizedDate);
                        
                        // Mettre à jour le calendrier
                        const dateObj = new Date(nextEntry.date);
                        currentMonth = dateObj.getMonth();
                        currentYear = dateObj.getFullYear();
                        renderCalendar(currentMonth, currentYear);
                    });
                }
                
            } else {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const formattedDate = date.toLocaleDateString('fr-FR', options);
                
                journalDisplay.innerHTML = `
                    <div class="journal-entry">
                        <div class="entry-header">
                            <div class="entry-date">${formattedDate}</div>
                        </div>
                        <div class="no-entry">
                            <i class="fas fa-feather-alt"></i>
                            <p>Aucune entrée de journal pour cette date. Profitez de cette journée !</p>
                        </div>
                    </div>
                `;
            }
        }
        
        // Fonction pour obtenir l'entrée précédente
        function getPreviousEntry(currentDate) {
            const currentIndex = journalData.findIndex(e => datesAreEqual(e.date, currentDate));
            if (currentIndex > 0) {
                return journalData[currentIndex - 1];
            }
            return null;
        }
        
        // Fonction pour obtenir l'entrée suivante
        function getNextEntry(currentDate) {
            const currentIndex = journalData.findIndex(e => datesAreEqual(e.date, currentDate));
            if (currentIndex < journalData.length - 1) {
                return journalData[currentIndex + 1];
            }
            return null;
        }
        
        // Formater les valeurs
        function formatValue(value) {
            if (!value) return '';
            return value
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\n/g, '<br>')
                .replace(/\r\n/g, '<br>');
        }
        
        // Initialiser le calendrier
        function initCalendar() {
            renderCalendar(currentMonth, currentYear);
            setupEventListeners();
        }
        
        // Afficher le calendrier
        function renderCalendar(month, year) {
            const monthNames = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin",
                                "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];
            
            document.querySelector('.month-year').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(Date.UTC(year, month, 1));
            const lastDay = new Date(Date.UTC(year, month + 1, 0));
            const firstDayIndex = firstDay.getUTCDay();
            const adjustedFirstDayIndex = firstDayIndex === 0 ? 6 : firstDayIndex - 1;
            const daysInMonth = lastDay.getUTCDate();
            const prevMonthLastDay = new Date(Date.UTC(year, month, 0)).getUTCDate();
            
            let calendarHTML = '';
            
            for (let i = adjustedFirstDayIndex; i > 0; i--) {
                const day = prevMonthLastDay - i + 1;
                calendarHTML += `<div class="day empty">${day}</div>`;
            }
            
            const today = new Date();
            const normalizedToday = normalizeDate(today);
            let entriesThisMonth = 0;
            let menstruationDays = 0;
            
            for (let i = 1; i <= daysInMonth; i++) {
                const date = new Date(Date.UTC(year, month, i));
                const dateKey = getDateKey(date);
                const normalizedDate = normalizeDate(date);
                
                const entry = journalData.find(e => datesAreEqual(e.date, normalizedDate));
                const hasEntry = !!entry;
                
                let weight = '';
                let hasMenstruation = false;
                
                if (entry) {
                    entriesThisMonth++;
                    
                    const poidsKey = normalizeKey("Poids");
                    if (entry.rawData[poidsKey]) {
                        weight = entry.rawData[poidsKey];
                    }
                    
                    if (entry.groupedData.monstruation && entry.groupedData.monstruation.length > 0) {
                        const hasMenstruationData = entry.groupedData.monstruation.some(item => {
                            if (item.value && item.value.trim() !== '') {
                                const value = item.value.toLowerCase().trim();
                                return value !== 'non' && value !== 'aucun' && value !== 'pas' && value !== '';
                            }
                            return false;
                        });
                        
                        if (hasMenstruationData) {
                            hasMenstruation = true;
                            menstruationDays++;
                        }
                    }
                }
                
                let dayClass = "day";
                if (datesAreEqual(date, normalizedToday)) {
                    dayClass += " today";
                }
                if (hasEntry) {
                    dayClass += " has-entry";
                }
                if (datesAreEqual(date, currentDate)) {
                    dayClass += " selected";
                }
                
                calendarHTML += `
                    <div class="${dayClass}" data-date="${dateKey}">
                        ${i}
                        ${weight ? `<div class="day-weight">${weight}</div>` : ''}
                        ${hasMenstruation ? `<div class="day-menstruation">🩸</div>` : ''}
                    </div>
                `;
            }
            
            const totalCells = 42;
            const daysSoFar = adjustedFirstDayIndex + daysInMonth;
            const remainingCells = totalCells - daysSoFar;
            
            for (let i = 1; i <= remainingCells; i++) {
                calendarHTML += `<div class="day empty">${i}</div>`;
            }
            
            document.getElementById('calendar-days').innerHTML = calendarHTML;
            document.getElementById('current-month-count').textContent = entriesThisMonth;
            document.getElementById('menstruation-count').textContent = menstruationDays;
            
            document.querySelectorAll('.day:not(.empty)').forEach(day => {
                day.addEventListener('click', function() {
                    const dateStr = this.getAttribute('data-date');
                    const [year, month, dayNum] = dateStr.split('-').map(Number);
                    const date = new Date(Date.UTC(year, month - 1, dayNum));
                    
                    currentDate = date;
                    
                    document.querySelectorAll('.day').forEach(d => d.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    showEntryForDate(date);
                });
            });
        }
        
        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            document.querySelector('.prev-month').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar(currentMonth, currentYear);
            });
            
            document.querySelector('.next-month').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar(currentMonth, currentYear);
            });
            
            const todayBtn = document.createElement('button');
            todayBtn.className = 'nav-btn';
            todayBtn.innerHTML = '<i class="fas fa-calendar-day"></i>';
            todayBtn.title = "Aller à aujourd'hui";
            todayBtn.style.marginLeft = '10px';
            
            todayBtn.addEventListener('click', function() {
                const today = new Date();
                currentDate = normalizeDate(today);
                currentMonth = today.getMonth();
                currentYear = today.getFullYear();
                renderCalendar(currentMonth, currentYear);
                showEntryForDate(today);
            });
            
            document.querySelector('.calendar-nav').appendChild(todayBtn);
            
            // Gestion du bouton pour remonter en haut
            const backToTopBtn = document.getElementById('back-to-top-btn');
            
            backToTopBtn.addEventListener('click', function() {
                const journalEntry = document.getElementById('journal-entry-top');
                if (journalEntry) {
                    journalEntry.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });
            
            // Le bouton est toujours visible maintenant
            backToTopBtn.style.opacity = '1';
            backToTopBtn.style.visibility = 'visible';
        }
        
        // Mettre à jour les statistiques
        function updateStats() {
            const statsElement = document.querySelector('.stats');
            statsElement.innerHTML = `
                <div><span>${journalData.length}</span> entrées chargées</div>
                <div><span id="current-month-count">0</span> entrées ce mois-ci</div>
                <div><span id="menstruation-count">0</span> jours de menstruation</div>
            `;
        }
        
        // Fonctions d'état d'interface
        function showLoading(isLoading) {
            const journalDisplay = document.getElementById('journal-display');
            if (isLoading) {
                journalDisplay.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Chargement des données depuis Google Sheets...
                    </div>
                `;
            }
        }
        
        function showNoDataMessage() {
            const journalDisplay = document.getElementById('journal-display');
            journalDisplay.innerHTML = `
                <div class="journal-entry">
                    <div class="no-entry">
                        <i class="fas fa-database"></i>
                        <p>Aucune donnée trouvée dans le Google Sheet.</p>
                    </div>
                </div>
            `;
        }
        
        // Système de recherche
        let searchIndex = [];
        let allWordsSet = new Set();
        
        // Indexer toutes les données pour la recherche
        function buildSearchIndex() {
            console.log("Construction de l'index de recherche...");
            searchIndex = [];
            allWordsSet = new Set();
            
            journalData.forEach(entry => {
                const entryData = {
                    date: entry.date,
                    formattedDate: entry.date.toLocaleDateString('fr-FR', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    }),
                    shortDate: entry.date.toLocaleDateString('fr-FR'),
                    content: '',
                    lowerContent: '',
                    lowerContentNoAccents: '',
                    fields: []
                };
                
                let allText = '';
                let allLowerText = '';
                
                Object.values(entry.rawData).forEach(value => {
                    if (value && typeof value === 'string') {
                        const cleanValue = value.trim();
                        const lowerValue = cleanValue.toLowerCase();
                        
                        allText += cleanValue + ' ';
                        allLowerText += lowerValue + ' ';
                        entryData.content += cleanValue + ' ';
                        
                        const words = lowerValue
                            .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                            .replace(/[^a-z0-9\s]/g, ' ')
                            .split(/\s+/)
                            .filter(word => word.length > 2);
                        
                        words.forEach(word => allWordsSet.add(word));
                    }
                });
                
                entryData.lowerContent = allLowerText;
                entryData.lowerContentNoAccents = removeAccents(allLowerText);
                
                Object.entries(entry.rawData).forEach(([key, value]) => {
                    if (value && typeof value === 'string' && value.trim().length > 0) {
                        const cleanValue = value.trim();
                        entryData.fields.push({
                            key: key,
                            value: cleanValue,
                            normalizedValue: cleanValue.toLowerCase(),
                            normalizedNoAccents: removeAccents(cleanValue.toLowerCase())
                        });
                    }
                });
                
                searchIndex.push(entryData);
            });
            
            console.log(`Index construit : ${searchIndex.length} entrées, ${allWordsSet.size} mots uniques`);
        }
        
        // Rechercher dans les données
        function searchInJournal(query) {
            if (!query || query.trim() === '') return [];
            
            const normalizedQuery = query.toLowerCase().trim();
            const normalizedQueryNoAccents = removeAccents(normalizedQuery);
            const queryWords = normalizedQuery.split(/\s+/).filter(word => word.length > 0);
            const queryWordsNoAccents = normalizedQueryNoAccents.split(/\s+/).filter(word => word.length > 0);
            
            const results = searchIndex.map((entry, index) => {
                let score = 0;
                let matches = [];
                let snippets = [];
                
                queryWords.forEach((word, wordIndex) => {
                    const lowerWord = word.toLowerCase();
                    const lowerWordNoAccents = removeAccents(lowerWord);
                    
                    if (entry.lowerContent.includes(lowerWord) || 
                        (entry.lowerContentNoAccents && entry.lowerContentNoAccents.includes(lowerWordNoAccents))) {
                        score += 10;
                        
                        entry.fields.forEach(field => {
                            const matchesWord = field.normalizedValue.includes(lowerWord) || 
                                               field.normalizedNoAccents.includes(lowerWordNoAccents);
                            
                            if (matchesWord) {
                                matches.push(field.key);
                                
                                const fieldValue = field.value;
                                let wordIndexInText = fieldValue.toLowerCase().indexOf(lowerWord);
                                
                                if (wordIndexInText === -1) {
                                    const fieldValueNoAccents = removeAccents(fieldValue.toLowerCase());
                                    const noAccentIndex = fieldValueNoAccents.indexOf(lowerWordNoAccents);
                                    if (noAccentIndex !== -1) {
                                        wordIndexInText = noAccentIndex;
                                    }
                                }
                                
                                if (wordIndexInText !== -1) {
                                    const start = Math.max(0, wordIndexInText - 30);
                                    const end = Math.min(fieldValue.length, wordIndexInText + lowerWord.length + 70);
                                    let snippet = fieldValue.substring(start, end);
                                    
                                    if (start > 0) snippet = '...' + snippet;
                                    if (end < fieldValue.length) snippet = snippet + '...';
                                    
                                    const regex = new RegExp(`(${word})`, 'gi');
                                    const highlightedSnippet = snippet.replace(
                                        regex,
                                        '<span class="result-highlight">$1</span>'
                                    );
                                    
                                    snippets.push(highlightedSnippet);
                                }
                            }
                        });
                    }
                });
                
                const shortDateLower = entry.shortDate.toLowerCase();
                const shortDateNoAccents = removeAccents(shortDateLower);
                
                if (shortDateLower.includes(normalizedQuery) || 
                    shortDateNoAccents.includes(normalizedQueryNoAccents)) {
                    score += 50;
                    matches.push('date');
                }
                
                if (entry.lowerContent.includes(normalizedQuery) ||
                    (entry.lowerContentNoAccents && entry.lowerContentNoAccents.includes(normalizedQueryNoAccents))) {
                    score += 20;
                    matches.push('phrase exacte');
                }
                
                return {
                    score,
                    entry: journalData[index],
                    formattedDate: entry.formattedDate,
                    shortDate: entry.shortDate,
                    matches: [...new Set(matches)].slice(0, 5),
                    snippets: [...new Set(snippets)].slice(0, 3)
                };
            }).filter(result => result.score > 0)
              .sort((a, b) => b.score - a.score)
              .slice(0, 20);
            
            return results;
        }
        
        // Générer des suggestions
        function generateSuggestions(query) {
            if (!query || query.trim() === '') return [];
            
            const normalizedQuery = query.toLowerCase().trim();
            const suggestions = [];
            
            allWordsSet.forEach(word => {
                if (word.toLowerCase().startsWith(normalizedQuery) && word.toLowerCase() !== normalizedQuery) {
                    suggestions.push({
                        type: 'mot',
                        text: word,
                        display: word
                    });
                }
            });
            
            searchIndex.forEach(entry => {
                if (entry.shortDate.toLowerCase().includes(normalizedQuery)) {
                    suggestions.push({
                        type: 'date',
                        text: entry.shortDate,
                        display: `📅 ${entry.shortDate}`,
                        date: entry.date
                    });
                }
            });
            
            return suggestions.slice(0, 10);
        }
        
        // Afficher les suggestions
        function showSuggestions(suggestions) {
            const dropdown = document.getElementById('suggestions-dropdown');
            
            if (!suggestions || suggestions.length === 0) {
                dropdown.style.display = 'none';
                return;
            }
            
            let html = '';
            
            suggestions.forEach(suggestion => {
                let icon = '🔍';
                if (suggestion.type === 'date') icon = '📅';
                if (suggestion.type === 'mot') icon = '📝';
                
                html += `
                    <div class="suggestion-item" data-suggestion="${suggestion.text}">
                        <i class="fas fa-${suggestion.type === 'date' ? 'calendar' : 'search'}"></i>
                        <div class="suggestion-text">${suggestion.display}</div>
                        ${suggestion.type === 'date' ? `<div class="suggestion-date">${suggestion.text}</div>` : ''}
                    </div>
                `;
            });
            
            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
            
            document.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', function() {
                    const suggestion = this.getAttribute('data-suggestion');
                    document.getElementById('search-input').value = suggestion;
                    performSearch(suggestion);
                    dropdown.style.display = 'none';
                });
            });
        }
        
        // Effectuer une recherche
        function performSearch(query) {
            const results = searchInJournal(query);
            displaySearchResults(results, query);
        }
        
        // Afficher les résultats
        function displaySearchResults(results, query) {
            const resultsList = document.getElementById('results-list');
            const searchResults = document.getElementById('search-results');
            
            if (results.length === 0) {
                resultsList.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <p>Aucun résultat trouvé pour "<strong>${query}</strong>"</p>
                        <p style="margin-top: 10px; font-size: 14px; color: #888;">
                            Essayez avec d'autres mots-clés ou vérifiez l'orthographe.
                        </p>
                    </div>
                `;
            } else {
                let html = '';
                
                results.forEach(result => {
                    html += `
                        <div class="result-item" data-date="${getDateKey(result.entry.date)}">
                            <div class="result-date">
                                <i class="fas fa-calendar-day"></i>
                                ${result.formattedDate}
                            </div>
                            ${result.snippets.length > 0 ? `
                                <div class="result-snippet">
                                    ${result.snippets.join('<br>')}
                                </div>
                            ` : ''}
                            <div class="result-matches">
                                <i class="fas fa-bullseye"></i>
                                ${result.matches.length} correspondance${result.matches.length > 1 ? 's' : ''}
                            </div>
                        </div>
                    `;
                });
                
                resultsList.innerHTML = html;
                
                document.querySelectorAll('.result-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const dateKey = this.getAttribute('data-date');
                        const [year, month, day] = dateKey.split('-').map(Number);
                        const date = new Date(Date.UTC(year, month - 1, day));
                        
                        currentDate = date;
                        
                        const normalizedDate = normalizeDate(date);
                        const dateObj = new Date(Date.UTC(year, month - 1, day));
                        currentMonth = dateObj.getMonth();
                        currentYear = dateObj.getFullYear();
                        renderCalendar(currentMonth, currentYear);
                        
                        showEntryForDate(normalizedDate);
                        
                        searchResults.style.display = 'none';
                        
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                });
            }
            
            searchResults.style.display = 'block';
        }
        
        // Interface d'accueil pour afficher des données par période/champ
        function showHomeInterface() {
            const journalDisplay = document.getElementById('journal-display');
            
            const homeHTML = `
                <div class="home-interface">
                    <h2 class="home-section-title"><i class="fas fa-home"></i> Vue d'ensemble</h2>
                    
                    <div class="home-section">
                        <h3 class="home-section-title"><i class="fas fa-filter"></i> Sélection des champs</h3>
                        <div class="field-selector" id="field-selector">
                            <div class="field-checkbox" data-field="spirituel">
                                <i class="fas fa-pray"></i> Spirituel
                            </div>
                            <div class="field-checkbox" data-field="bilan">
                                <i class="fas fa-chart-line"></i> Bilan personnel
                            </div>
                            <div class="field-checkbox" data-field="finance">
                                <i class="fas fa-money-bill-wave"></i> Finance
                            </div>
                            <div class="field-checkbox" data-field="poids">
                                <i class="fas fa-weight-scale"></i> Poids & Mensurations
                            </div>
                            <div class="field-checkbox" data-field="sante">
                                <i class="fas fa-heartbeat"></i> Santé
                            </div>
                            <div class="field-checkbox" data-field="alimentation">
                                <i class="fas fa-utensils"></i> Alimentation
                            </div>
                            <div class="field-checkbox" data-field="relation">
                                <i class="fas fa-comments"></i> Relation
                            </div>
                            <div class="field-checkbox" data-field="periodique">
                                <i class="fas fa-calendar-day"></i> Périodique
                            </div>
                        </div>
                    </div>
                    
                    <div class="home-section">
                        <h3 class="home-section-title"><i class="fas fa-calendar-alt"></i> Période</h3>
                        <div class="date-selector">
                            <div class="date-option">
                                <input type="radio" id="today" name="period" value="today" checked>
                                <label for="today">Aujourd'hui</label>
                            </div>
                            <div class="date-option">
                                <input type="radio" id="week" name="period" value="week">
                                <label for="week">Cette semaine</label>
                            </div>
                            <div class="date-option">
                                <input type="radio" id="month" name="period" value="month">
                                <label for="month">Ce mois</label>
                            </div>
                            <div class="date-option">
                                <input type="radio" id="custom" name="period" value="custom">
                                <label for="custom">Personnalisée</label>
                            </div>
                        </div>
                        
                        <div id="custom-date-range" style="display: none; margin-top: 10px;">
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <div>
                                    <label style="font-size: 0.9rem; color: #e91e63; margin-bottom: 5px; display: block;">Du :</label>
                                    <input type="date" id="date-start" class="date-input">
                                </div>
                                <div>
                                    <label style="font-size: 0.9rem; color: #e91e63; margin-bottom: 5px; display: block;">Au :</label>
                                    <input type="date" id="date-end" class="date-input">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="action-button" id="show-results-btn">
                        <i class="fas fa-eye"></i> Afficher les résultats
                    </button>
                    
                    <div class="results-container" id="results-container" style="display: none;">
                        <!-- Les résultats seront affichés ici -->
                    </div>
                </div>
            `;
            
            journalDisplay.innerHTML = homeHTML;
            
            // Gestion des boutons de sélection de période
            document.querySelectorAll('input[name="period"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const customRange = document.getElementById('custom-date-range');
                    if (this.value === 'custom') {
                        customRange.style.display = 'block';
                    } else {
                        customRange.style.display = 'none';
                    }
                });
            });
            
            // Gestion des sélections de champ
            document.querySelectorAll('.field-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
            
            // Gestion du bouton d'affichage des résultats
            document.getElementById('show-results-btn').addEventListener('click', function() {
                showHomeResults();
            });
        }
        
        // Afficher les résultats de l'interface d'accueil
        function showHomeResults() {
            const selectedFields = Array.from(document.querySelectorAll('.field-checkbox.selected'))
                .map(checkbox => checkbox.getAttribute('data-field'));
            
            if (selectedFields.length === 0) {
                alert('Veuillez sélectionner au moins un champ à afficher.');
                return;
            }
            
            const period = document.querySelector('input[name="period"]:checked').value;
            let startDate, endDate;
            const today = new Date();
            
            switch (period) {
                case 'today':
                    startDate = new Date(today);
                    endDate = new Date(today);
                    break;
                case 'week':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 7);
                    endDate = new Date(today);
                    break;
                case 'month':
                    startDate = new Date(today);
                    startDate.setMonth(today.getMonth() - 1);
                    endDate = new Date(today);
                    break;
                case 'custom':
                    const startInput = document.getElementById('date-start').value;
                    const endInput = document.getElementById('date-end').value;
                    
                    if (!startInput || !endInput) {
                        alert('Veuillez sélectionner une période personnalisée.');
                        return;
                    }
                    
                    startDate = new Date(startInput);
                    endDate = new Date(endInput);
                    break;
            }
            
            // Filtrer les entrées par date
            const filteredEntries = journalData.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate >= startDate && entryDate <= endDate;
            }).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredEntries.length === 0) {
                document.getElementById('results-container').innerHTML = `
                    <div class="no-results-home">
                        <i class="fas fa-search"></i>
                        <p>Aucune entrée trouvée pour la période sélectionnée.</p>
                    </div>
                `;
                document.getElementById('results-container').style.display = 'block';
                return;
            }
            
            // Générer les résultats
            let resultsHTML = '';
            
            filteredEntries.forEach(entry => {
                const formattedDate = entry.date.toLocaleDateString('fr-FR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                resultsHTML += `<div class="result-item-home">`;
                resultsHTML += `<div class="result-date-home">${formattedDate}</div>`;
                
                selectedFields.forEach(field => {
                    let fieldContent = '';
                    let fieldLabel = '';
                    
                    switch (field) {
                        case 'spirituel':
                            fieldLabel = 'SPIRITUEL';
                            const spirituelFields = [
                                {key: "Texte medité", label: "Texte médité"},
                                {key: "Ce que j'ai retenu aujourd'hui dans la méditation", label: "Retenu de la méditation"},
                                {key: "Résolution du jour/décision", label: "Résolution du jour/décision"},
                                {key: "Fampianarana biblique du jour", label: "Fampianarana biblique du jour"},
                                {key: "Autres méditation du jour", label: "Autres méditation du jour"},
                                {key: "Leçon spirituelle du jour", label: "Leçon spirituelle du jour"},
                                {key: "Partage spirituel", label: "Partage spirituel"},
                                {key: "Sujet de Louange,reconnaissance", label: "Sujet de Louange,reconnaissance"},
                                {key: "Intercession", label: "Intercession"},
                                {key: "Détails intercession", label: "Détails intercession"}
                            ];
                            
                            spirituelFields.forEach(subField => {
                                const key = normalizeKey(subField.key);
                                if (entry.rawData[key]) {
                                    const valueClass = subField.key.includes("Texte medité") || subField.key.includes("retenu") ? 
                                        (subField.key.includes("Texte medité") ? "texte-medite" : "retenu-meditation") : "";
                                    fieldContent += `<div><strong>${subField.label}:</strong> <span class="${valueClass}">${formatValue(entry.rawData[key])}</span></div>`;
                                }
                            });
                            break;
                            
                        case 'bilan':
                            fieldLabel = 'BILAN PERSONNEL';
                            const bilanFields = [
                                {key: "Stress ressenti, pensée dominante, quelque chose de positif aujourd'hui", label: "Stress/positif du jour"},
                                {key: "Difficultés rencontrées", label: "Difficultés rencontrées"},
                                {key: "Erreur à ne pas répéter", label: "Erreur à ne pas répéter"},
                                {key: "Leçons du jour", label: "Leçons du jour"},
                                {key: "Inhabituel", label: "Inhabituel"},
                                {key: "Rêve la veille", label: "Rêve la veille"},
                                {key: "Nuit la veille", label: "Nuit la veille"},
                                {key: "Mes pensées et analyse du jour", label: "Mes pensées et analyse"},
                                {key: "Partage du jour", label: "Partage du jour"},
                                {key: "Ce que j'ai reçu en cadeau aujourd'hui", label: "Cadeau reçu", class: "cadeau-recu"},
                                {key: "Etat mental et emotionnel", label: "État mental et émotionnel"},
                                {key: "Fatigue", label: "Fatigue"},
                                {key: "Photos du jour", label: "Photos du jour"}
                            ];
                            
                            bilanFields.forEach(subField => {
                                const key = normalizeKey(subField.key);
                                if (entry.rawData[key]) {
                                    const valueClass = subField.class || "";
                                    if (subField.key === "Fatigue") {
                                        const fatigueStars = createStars(entry.rawData[key]);
                                        fieldContent += `<div><strong>${subField.label}:</strong> ${fatigueStars || entry.rawData[key]}</div>`;
                                    } else {
                                        fieldContent += `<div><strong>${subField.label}:</strong> <span class="${valueClass}">${formatValue(entry.rawData[key])}</span></div>`;
                                    }
                                }
                            });
                            break;
                            
                        case 'finance':
                            fieldLabel = 'FINANCE';
                            const financeFields = [
                                {key: "Dépenses en nourriture", label: "Dépenses en nourriture"},
                                {key: "Achats autres", label: "Achats autres"},
                                {key: "Achats matériel(+-durable)", label: "Achats matériel"},
                                {key: "Frais divers", label: "Frais divers"},
                                {key: "Frais travail", label: "Frais travail"},
                                {key: "Autres depenses non achat du jour", label: "Autres dépenses"},
                                {key: "Entrée espèce", label: "Entrée espèce"},
                                {key: "Source entrée", label: "Source entrée"}
                            ];
                            
                            financeFields.forEach(subField => {
                                const key = normalizeKey(subField.key);
                                if (entry.rawData[key]) {
                                    fieldContent += `<div><strong>${subField.label}:</strong> ${formatValue(entry.rawData[key])}</div>`;
                                }
                            });
                            break;
                            
                        case 'poids':
                            fieldLabel = 'POIDS & MENSURATIONS';
                            const poidsFields = [
                                {key: "Poids", label: "Poids"},
                                {key: "Tour de hanche", label: "Tour de hanche"},
                                {key: "Tour du haut des cuisse", label: "Tour haut cuisses"},
                                {key: "Tour de jambe", label: "Tour de jambe"},
                                {key: "Tour de taille", label: "Tour de taille"},
                                {key: "Tour de ventre", label: "Tour de ventre"},
                                {key: "Tour de poitrine", label: "Tour de poitrine"},
                                {key: "Tour de bras", label: "Tour de bras"}
                            ];
                            
                            poidsFields.forEach(subField => {
                                const key = normalizeKey(subField.key);
                                if (entry.rawData[key]) {
                                    fieldContent += `<div><strong>${subField.label}:</strong> ${formatValue(entry.rawData[key])}</div>`;
                                }
                            });
                            break;
                            
                        case 'sante':
                            fieldLabel = 'SANTÉ';
                            const santeFields = [
                                {key: "Lavage", label: "Lavage"},
                                {key: "Extra", label: "Extra"},
                                {key: "Bijou inhabituel", label: "Bijou inhabituel"},
                                {key: "Details soin du jour", label: "Détails soin"},
                                {key: "Maladie", label: "Maladie"},
                                {key: "Suivi santé", label: "Suivi santé"},
                                {key: "Santé", label: "Santé"}
                            ];
                            
                            santeFields.forEach(subField => {
                                const key = normalizeKey(subField.key);
                                if (entry.rawData[key]) {
                                    fieldContent += `<div><strong>${subField.label}:</strong> ${formatValue(entry.rawData[key])}</div>`;
                                }
                            });
                            break;
                            
                        case 'alimentation':
                            fieldLabel = 'ALIMENTATION';
                            const alimentationFields = [
                                {key: "Petit déjeuner", label: "Petit déjeuner"},
                                {key: "Déjeuner", label: "Déjeuner"},
                                {key: "Dîner", label: "Dîner"},
                                {key: "Eau bue dans la journee", label: "Eau bue"},
                                {key: "Collation AM", label: "Collation AM"},
                                {key: "Collation PM", label: "Collation PM"}
                            ];
                            
                            alimentationFields.forEach(subField => {
                                const key = normalizeKey(subField.key);
                                if (entry.rawData[key]) {
                                    if (subField.key === "Eau bue dans la journee") {
                                        const waterCalculation = calculateWaterDrunk(entry.rawData[key]);
                                        fieldContent += `<div><strong>${subField.label}:</strong> ${waterCalculation.display || formatValue(entry.rawData[key])}</div>`;
                                    } else {
                                        fieldContent += `<div><strong>${subField.label}:</strong> ${formatValue(entry.rawData[key])}</div>`;
                                    }
                                }
                            });
                            break;
                            
                        case 'relation':
                            fieldLabel = 'RELATION';
                            const relationFields = [
                                {key: "Famille interaction", label: "Interaction famille"},
                                {key: "Rencontre du jour", label: "Rencontre du jour"},
                                {key: "Relation avec mmr", label: "Relation avec mmr"},
                                {key: "Discussion en réseau/sms/mail du jour", label: "Discussions réseau"},
                                {key: "Message", label: "Message"},
                                {key: "Appel", label: "Appel"},
                                {key: "Détails comm", label: "Détails comm"}
                            ];
                            
                            relationFields.forEach(subField => {
                                const key = normalizeKey(subField.key);
                                if (entry.rawData[key]) {
                                    fieldContent += `<div><strong>${subField.label}:</strong> ${formatValue(entry.rawData[key])}</div>`;
                                }
                            });
                            break;
                            
                        case 'periodique':
                            fieldLabel = 'PÉRIODIQUE';
                            const periodiqueFields = [
                                {key: "Lavage oreille", label: "Lavage oreille"},
                                {key: "Detartrage", label: "Détartrage"},
                                {key: "Bilan santé", label: "Bilan santé"},
                                {key: "Nettoyage", label: "Nettoyage"},
                                {key: "Lunette", label: "Lunette"},
                                {key: "Details lunette", label: "Détails lunette"},
                                {key: "Anti parasite", label: "Anti parasite"},
                                {key: "Jirama", label: "Jirama"},
                                {key: "Crédit", label: "Crédit"}
                            ];
                            
                            periodiqueFields.forEach(subField => {
                                const key = normalizeKey(subField.key);
                                if (entry.rawData[key]) {
                                    fieldContent += `<div><strong>${subField.label}:</strong> ${formatValue(entry.rawData[key])}</div>`;
                                }
                            });
                            break;
                    }
                    
                    if (fieldContent) {
                        resultsHTML += `<div class="result-content-home">
                            <div style="font-weight: 600; color: #e91e63; margin-bottom: 3px;">${fieldLabel}:</div>
                            ${fieldContent}
                        </div>`;
                    }
                });
                
                resultsHTML += `</div>`;
            });
            
            document.getElementById('results-container').innerHTML = resultsHTML;
            document.getElementById('results-container').style.display = 'block';
            
            // Faire défiler jusqu'aux résultats
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Initialiser la recherche
        function initializeSearch() {
            setTimeout(() => {
                if (journalData.length > 0) {
                    buildSearchIndex();
                }
            }, 500);
            
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const suggestionsDropdown = document.getElementById('suggestions-dropdown');
            const closeResults = document.getElementById('close-results');
            
            if (!searchInput) return;
            
            searchButton.addEventListener('click', function() {
                const query = searchInput.value.trim();
                if (query) {
                    performSearch(query);
                    suggestionsDropdown.style.display = 'none';
                }
            });
            
            searchInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        performSearch(query);
                        suggestionsDropdown.style.display = 'none';
                    }
                }
            });
            
            let debounceTimer;
            searchInput.addEventListener('input', function() {
                clearTimeout(debounceTimer);
                const query = searchInput.value.trim();
                
                if (query.length > 1) {
                    debounceTimer = setTimeout(() => {
                        const suggestions = generateSuggestions(query);
                        showSuggestions(suggestions);
                    }, 300);
                } else {
                    suggestionsDropdown.style.display = 'none';
                }
            });
            
            document.addEventListener('click', function(event) {
                if (!searchInput.contains(event.target) && !suggestionsDropdown.contains(event.target)) {
                    suggestionsDropdown.style.display = 'none';
                }
            });
            
            if (closeResults) {
                closeResults.addEventListener('click', function() {
                    document.getElementById('search-results').style.display = 'none';
                });
            }
            
            document.addEventListener('keydown', function(event) {
                if ((event.ctrlKey || event.metaKey) && event.key === 'f') {
                    event.preventDefault();
                    searchInput.focus();
                    searchInput.select();
                }
            });
            
            // Initialiser les boutons flottants
            const floatingButtons = document.createElement('div');
            floatingButtons.className = 'floating-buttons';
            floatingButtons.innerHTML = `
                <button class="floating-btn tooltip" id="search-access-btn" data-tooltip="Recherche">
                    <i class="fas fa-search"></i>
                </button>
                <button class="floating-btn tooltip" id="calendar-access-btn" data-tooltip="Calendrier">
                    <i class="fas fa-calendar-alt"></i>
                </button>
                <button class="floating-btn tooltip" id="home-access-btn" data-tooltip="Accueil">
                    <i class="fas fa-home"></i>
                </button>
                <button class="floating-btn tooltip" id="form-btn" data-tooltip="Nouvelle entrée journal">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="floating-btn tooltip" id="sheet-btn" data-tooltip="Voir le Google Sheet">
                    <i class="fas fa-table"></i>
                </button>
            `;
            
            document.body.appendChild(floatingButtons);
            
            // Écouteurs pour les boutons flottants
            document.getElementById('search-access-btn').addEventListener('click', function() {
                document.getElementById('search-input').focus();
                document.getElementById('search-input').select();
            });
            
            document.getElementById('calendar-access-btn').addEventListener('click', function() {
                document.querySelector('.calendar-section').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('home-access-btn').addEventListener('click', function() {
                showHomeInterface();
            });
            
            document.getElementById('form-btn').addEventListener('click', function() {
                window.open('https://docs.google.com/forms/d/e/1FAIpQLSf7RjIpkua5-T-5K-YgrcPPyW_9ujfv3KpVmFZMuFMY72rJ4g/viewform?usp=publish-editor', '_blank');
            });
            
            document.getElementById('sheet-btn').addEventListener('click', function() {
                window.open('https://docs.google.com/spreadsheets/d/1sqFSBaJqghgJdcKcuYfYOtPLA-xmRyAnbp0XMgV6qNU/edit?resourcekey=&pli=1&gid=114511576#gid=114511576', '_blank');
            });
            
            setTimeout(() => {
                floatingButtons.style.display = 'flex';
            }, 1000);
            
            // Rendre le bouton "back-to-top" toujours visible
            const backToTopBtn = document.getElementById('back-to-top-btn');
            backToTopBtn.style.opacity = '1';
            backToTopBtn.style.visibility = 'visible';
        }
        
        // Initialiser le journal après le mot de passe
        function initializeJournal() {
            loadJournalData();
            initializeSearch();
        }
        
        // Charger les données au démarrage (maintenant après le mot de passe)
        passwordInput.focus();
      // Galerie photo globale
let currentPhotos = [];
let currentPhotoIndex = 0;

// Initialiser la galerie
function initPhotoGallery() {
    // Créer le modal s'il n'existe pas
    if (!document.getElementById('photoModal')) {
        const modalHTML = `
            <div id="photoModal" class="photo-modal">
                <button class="close-modal">&times;</button>
                <div class="gallery-controls">
                    <button class="gallery-btn prev-btn" id="prevPhotoBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="gallery-btn next-btn" id="nextPhotoBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <img class="modal-photo" id="modalPhoto" src="" alt="Photo">
                    <div class="modal-caption" id="modalCaption"></div>
                    <div class="gallery-counter" id="galleryCounter"></div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }
    
    const photoModal = document.getElementById('photoModal');
    const closeModal = photoModal.querySelector('.close-modal');
    const prevBtn = document.getElementById('prevPhotoBtn');
    const nextBtn = document.getElementById('nextPhotoBtn');
    
    // Fermer le modal
    closeModal.addEventListener('click', () => {
        photoModal.style.display = 'none';
    });
    
    // Fermer en cliquant à l'extérieur
    photoModal.addEventListener('click', (e) => {
        if (e.target === photoModal) {
            photoModal.style.display = 'none';
        }
    });
    
    // Fermer avec Escape
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && photoModal.style.display === 'flex') {
            photoModal.style.display = 'none';
        }
    });
    
    // Navigation
    prevBtn.addEventListener('click', showPrevPhoto);
    nextBtn.addEventListener('click', showNextPhoto);
    
    // Navigation clavier
    document.addEventListener('keydown', (e) => {
        if (photoModal.style.display === 'flex') {
            if (e.key === 'ArrowLeft') showPrevPhoto();
            if (e.key === 'ArrowRight') showNextPhoto();
        }
    });
    
    // Déléguation d'événements pour les aperçus photo
    document.addEventListener('click', function(e) {
        const thumbnailLink = e.target.closest('.photo-thumbnail-link');
        if (thumbnailLink && thumbnailLink.dataset.url) {
            e.preventDefault();
            
            // Récupérer toutes les photos de la section actuelle
            const section = thumbnailLink.closest('.section-bilan, [class*="section-"]');
            const allLinks = section ? 
                Array.from(section.querySelectorAll('.photo-thumbnail-link[data-url]')) : 
                Array.from(document.querySelectorAll('.photo-thumbnail-link[data-url]'));
            
            currentPhotos = allLinks.map(link => ({
                url: link.dataset.url,
                thumbnail: link.dataset.thumbnail,
                title: link.title || 'Photo'
            }));
            
            const clickedIndex = parseInt(thumbnailLink.dataset.index) || 0;
            openPhotoGallery(clickedIndex);
        }
    });
}

// Ouvrir la galerie
function openPhotoGallery(index) {
    currentPhotoIndex = index;
    const photoModal = document.getElementById('photoModal');
    const modalPhoto = document.getElementById('modalPhoto');
    const modalCaption = document.getElementById('modalCaption');
    const galleryCounter = document.getElementById('galleryCounter');
    
    if (currentPhotos.length === 0) return;
    
    const currentPhoto = currentPhotos[currentPhotoIndex];
    modalPhoto.src = currentPhoto.url;
    modalPhoto.alt = currentPhoto.title;
    modalCaption.textContent = currentPhoto.title;
    galleryCounter.textContent = `${currentPhotoIndex + 1} / ${currentPhotos.length}`;
    
    photoModal.style.display = 'flex';
    
    // Mettre à jour les boutons de navigation
    updateGalleryButtons();
}

// Photo précédente
function showPrevPhoto() {
    if (currentPhotos.length === 0) return;
    currentPhotoIndex = (currentPhotoIndex - 1 + currentPhotos.length) % currentPhotos.length;
    openPhotoGallery(currentPhotoIndex);
}

// Photo suivante
function showNextPhoto() {
    if (currentPhotos.length === 0) return;
    currentPhotoIndex = (currentPhotoIndex + 1) % currentPhotos.length;
    openPhotoGallery(currentPhotoIndex);
}

// Mettre à jour les boutons de la galerie
function updateGalleryButtons() {
    const prevBtn = document.getElementById('prevPhotoBtn');
    const nextBtn = document.getElementById('nextPhotoBtn');
    
    if (currentPhotos.length <= 1) {
        prevBtn.style.display = 'none';
        nextBtn.style.display = 'none';
    } else {
        prevBtn.style.display = 'flex';
        nextBtn.style.display = 'flex';
    }
}

// Initialiser la galerie après le chargement
document.addEventListener('DOMContentLoaded', function() {
    initPhotoGallery();
});  
    </script>
</body>
</html>
